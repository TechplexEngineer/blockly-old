// Do not edit this file; automatically generated by build.py.
"use strict";
var Blockly={pathToBlockly:"./",SVG_NS:"http://www.w3.org/2000/svg",HTML_NS:"http://www.w3.org/1999/xhtml",HSV_SATURATION:0.45,HSV_VALUE:0.65,makeColour:function(a){var a=a%360,b=Blockly.HSV_VALUE,c=Blockly.HSV_VALUE*(1-Blockly.HSV_SATURATION),d=(b-c)*(a%60/60)+c,e=(b-c)*(1-a%60/60)+c,f;0<=a&&60>a?(a=b,f=d,b=c):60<=a&&120>a?(a=e,f=b,b=c):120<=a&&180>a?(a=c,f=b,b=d):180<=a&&240>a?(a=c,f=e):240<=a&&300>a?(a=d,f=c):300<=a&&360>a?(a=b,f=c,b=e):b=f=a=0;a=Math.floor(16*a);f=Math.floor(16*f);b=Math.floor(16*
b);return"#"+"0123456789abcdef".charAt(a)+"0123456789abcdef".charAt(f)+"0123456789abcdef".charAt(b)},INPUT_VALUE:1,OUTPUT_VALUE:2,NEXT_STATEMENT:3,PREVIOUS_STATEMENT:4,DUMMY_INPUT:5,ALIGN_LEFT:-1,ALIGN_CENTRE:0,ALIGN_RIGHT:1,OPPOSITE_TYPE:[]};Blockly.OPPOSITE_TYPE[Blockly.INPUT_VALUE]=Blockly.OUTPUT_VALUE;Blockly.OPPOSITE_TYPE[Blockly.OUTPUT_VALUE]=Blockly.INPUT_VALUE;Blockly.OPPOSITE_TYPE[Blockly.NEXT_STATEMENT]=Blockly.PREVIOUS_STATEMENT;Blockly.OPPOSITE_TYPE[Blockly.PREVIOUS_STATEMENT]=Blockly.NEXT_STATEMENT;
Blockly.SOUNDS_={};Blockly.selected=null;Blockly.editable=!0;Blockly.highlightedConnection_=null;Blockly.localConnection_=null;Blockly.DRAG_RADIUS=5;Blockly.SNAP_RADIUS=12;Blockly.BUMP_DELAY=250;Blockly.svgDoc=null;Blockly.mainWorkspace=null;Blockly.clipboard_=null;Blockly.svgSize=function(){return{width:Blockly.svg.cachedWidth_,height:Blockly.svg.cachedHeight_,top:Blockly.svg.cachedTop_,left:Blockly.svg.cachedLeft_}};
Blockly.svgResize=function(){var a=Blockly.svg.parentNode.offsetWidth,b=Blockly.svg.parentNode.offsetHeight;Blockly.svg.cachedWidth_!=a&&(Blockly.svg.setAttribute("width",a+"px"),Blockly.svg.cachedWidth_=a);Blockly.svg.cachedHeight_!=b&&(Blockly.svg.setAttribute("height",b+"px"),Blockly.svg.cachedHeight_=b);a=Blockly.svg.getBoundingClientRect();Blockly.svg.cachedLeft_=a.left;Blockly.svg.cachedTop_=a.top};
Blockly.onMouseDown_=function(a){Blockly.Block.terminateDrag_();Blockly.hideChaff();if(!(Blockly.isTargetInput_(a)||Blockly.Mutator&&Blockly.Mutator.isOpen))if(Blockly.selected&&"svg"==a.target.nodeName&&Blockly.selected.unselect(),Blockly.isRightButton(a))Blockly.ContextMenu&&Blockly.showContextMenu_(a.clientX,a.clientY);else if("svg"==a.target.nodeName||!Blockly.editable)Blockly.mainWorkspace.dragMode=!0,Blockly.mainWorkspace.startDragMouseX=a.clientX,Blockly.mainWorkspace.startDragMouseY=a.clientY,
Blockly.mainWorkspace.startDragMetrics=Blockly.getMainWorkspaceMetrics(),Blockly.mainWorkspace.startScrollX=Blockly.mainWorkspace.scrollX,Blockly.mainWorkspace.startScrollY=Blockly.mainWorkspace.scrollY};Blockly.onMouseUp_=function(){Blockly.setCursorHand_(!1);Blockly.mainWorkspace.dragMode=!1};
Blockly.onMouseMove_=function(a){if(Blockly.mainWorkspace.dragMode){Blockly.removeAllRanges();var b=Blockly.mainWorkspace.startDragMetrics,c=Blockly.mainWorkspace.startScrollX+(a.clientX-Blockly.mainWorkspace.startDragMouseX),a=Blockly.mainWorkspace.startScrollY+(a.clientY-Blockly.mainWorkspace.startDragMouseY),c=Math.min(c,-b.contentLeft),a=Math.min(a,-b.contentTop),c=Math.max(c,b.viewWidth-b.contentLeft-b.contentWidth),a=Math.max(a,b.viewHeight-b.contentTop-b.contentHeight);Blockly.mainWorkspace.scrollbar.set(-c-
b.contentLeft,-a-b.contentTop)}};
Blockly.onKeyDown_=function(a){if(!Blockly.isTargetInput_(a))if(27==a.keyCode)Blockly.hideChaff(),Blockly.Mutator&&Blockly.Mutator.isOpen&&Blockly.Mutator.closeDialog();else if(8==a.keyCode||46==a.keyCode){if(Blockly.selected&&Blockly.selected.editable&&(!Blockly.Mutator||!Blockly.Mutator.isOpen))Blockly.hideChaff(),Blockly.selected.destroy(!0,!0);a.preventDefault()}else if(a.altKey||a.ctrlKey||a.metaKey)Blockly.selected&&(Blockly.selected.editable&&Blockly.selected.workspace==Blockly.mainWorkspace)&&
(Blockly.hideChaff(),67==a.keyCode?Blockly.copy_(Blockly.selected):88==a.keyCode&&(Blockly.copy_(Blockly.selected),Blockly.selected.destroy(!0,!0))),86==a.keyCode&&Blockly.clipboard_&&Blockly.mainWorkspace.paste(Blockly.clipboard_)};Blockly.copy_=function(a){var b=Blockly.Xml.blockToDom_(a);Blockly.Xml.deleteNext(b);a=a.getRelativeToSurfaceXY();b.setAttribute("x",Blockly.RTL?-a.x:a.x);b.setAttribute("y",a.y);Blockly.clipboard_=b};
Blockly.showContextMenu_=function(a,b){var c=[],d={enabled:!1};d.text=Blockly.MSG_HELP;d.callback=function(){};c.push(d);Blockly.ContextMenu.show(a,b,c)};Blockly.onContextMenu_=function(a){!Blockly.isTargetInput_(a)&&Blockly.ContextMenu&&a.preventDefault()};Blockly.hideChaff=function(a){Blockly.Tooltip&&Blockly.Tooltip.hide();Blockly.ContextMenu&&Blockly.ContextMenu.hide();Blockly.FieldDropdown.hideMenu();Blockly.Toolbox&&(!a&&Blockly.Toolbox.flyout_.autoClose)&&Blockly.Toolbox.clearSelection()};
Blockly.removeAllRanges=function(){if(window.getSelection){var a=window.getSelection();a&&a.removeAllRanges&&(a.removeAllRanges(),window.setTimeout(function(){window.getSelection().removeAllRanges()},0))}};Blockly.isTargetInput_=function(a){return"textarea"==a.target.type||"text"==a.target.type};Blockly.loadAudio_=function(a){if(Audio){var b=new Audio(Blockly.pathToBlockly+"media/"+a+".wav");b&&b.play&&(b.play(),b.pause(),Blockly.SOUNDS_[a]=b)}};
Blockly.playAudio=function(a){(a=Blockly.SOUNDS_[a])&&a.play()};Blockly.setCursorHand_=function(a){if(Blockly.editable){var b="";a&&(b="url("+Blockly.pathToBlockly+"media/handclosed.cur) 7 3, auto");Blockly.selected&&(Blockly.selected.getSvgRoot().style.cursor=b);Blockly.svgDoc.getElementsByTagName("svg")[0].style.cursor=b}};
Blockly.getMainWorkspaceMetrics=function(){var a=Blockly.svgSize();Blockly.Toolbox&&(a.width-=Blockly.Toolbox.width);var b=a.width-Blockly.Scrollbar.scrollbarThickness,c=a.height-Blockly.Scrollbar.scrollbarThickness;try{var d=Blockly.mainWorkspace.getCanvas().getBBox()}catch(e){return null}-Infinity==d.width&&-Infinity==d.height&&(d={width:0,height:0,x:0,y:0});var f=Math.min(d.x-b/2,d.x+d.width-b),b=Math.max(d.x+d.width+b/2,d.x+b),h=Math.min(d.y-c/2,d.y+d.height-c),c=Math.max(d.y+d.height+c/2,d.y+
c),d=0;Blockly.Toolbox&&!Blockly.RTL&&(d=Blockly.Toolbox.width);return{viewHeight:a.height,viewWidth:a.width,contentHeight:c-h,contentWidth:b-f,viewTop:-Blockly.mainWorkspace.scrollY,viewLeft:-Blockly.mainWorkspace.scrollX,contentTop:h,contentLeft:f,absoluteTop:0,absoluteLeft:d}};
Blockly.setMainWorkspaceMetrics=function(a){var b=Blockly.getMainWorkspaceMetrics();"number"==typeof a.x&&(Blockly.mainWorkspace.scrollX=-b.contentWidth*a.x-b.contentLeft);"number"==typeof a.y&&(Blockly.mainWorkspace.scrollY=-b.contentHeight*a.y-b.contentTop);a="translate("+(Blockly.mainWorkspace.scrollX+b.absoluteLeft)+","+(Blockly.mainWorkspace.scrollY+b.absoluteTop)+")";Blockly.mainWorkspace.getCanvas().setAttribute("transform",a);Blockly.mainWorkspace.getBubbleCanvas().setAttribute("transform",
a)};Blockly.cssLoaded=function(){Blockly.Toolbox&&Blockly.Toolbox.redraw()};Blockly.Block=function(a,b){this.id=Blockly.uniqueId();this.previousConnection=this.nextConnection=this.outputConnection=null;this.inputList=[];this.disabled=this.collapsed=this.rendered=this.inputsInline=!1;this.editable=a.editable;this.tooltip="";this.contextMenu=!0;this.parentBlock_=null;this.childBlocks_=[];this.isInFlyout=!1;this.workspace=a;a.addTopBlock(this);if(b){this.type=b;var c=Blockly.Language[b];if(!c)throw'Error: "'+b+'" is an unknown language block.';for(var d in c)this[d]=c[d]}"function"==
typeof this.init&&this.init();this.editable&&"function"==typeof this.onchange&&Blockly.bindEvent_(a.getCanvas(),"blocklyWorkspaceChange",this,this.onchange)};Blockly.Block.prototype.svg_=null;Blockly.Block.prototype.mutator=null;Blockly.Block.prototype.comment=null;Blockly.Block.prototype.warning=null;Blockly.Block.prototype.initSvg=function(){this.svg_=new Blockly.BlockSvg(this);this.svg_.init();Blockly.bindEvent_(this.svg_.getRootNode(),"mousedown",this,this.onMouseDown_);this.workspace.getCanvas().appendChild(this.svg_.getRootNode())};
Blockly.Block.prototype.getSvgRoot=function(){return this.svg_&&this.svg_.getRootNode()};Blockly.Block.dragMode_=0;Blockly.Block.onMouseUpWrapper_=null;Blockly.Block.onMouseMoveWrapper_=null;
Blockly.Block.terminateDrag_=function(){Blockly.Block.onMouseUpWrapper_&&(Blockly.unbindEvent_(Blockly.Block.onMouseUpWrapper_),Blockly.Block.onMouseUpWrapper_=null);Blockly.Block.onMouseMoveWrapper_&&(Blockly.unbindEvent_(Blockly.Block.onMouseMoveWrapper_),Blockly.Block.onMouseMoveWrapper_=null);if(2==Blockly.Block.dragMode_&&Blockly.selected){var a=Blockly.selected,b=a.getRelativeToSurfaceXY();a.moveConnections_(b.x-a.startDragX,b.y-a.startDragY);delete a.draggedBubbles_;a.setDragging_(!1);a.render();
window.setTimeout(function(){a.bumpNeighbours_()},Blockly.BUMP_DELAY);Blockly.fireUiEvent(window,"resize");a.workspace.fireChangeEvent()}Blockly.Block.dragMode_=0};Blockly.Block.prototype.select=function(){Blockly.selected&&Blockly.selected.unselect();Blockly.selected=this;this.svg_.addSelect();Blockly.fireUiEvent(this.workspace.getCanvas(),"blocklySelectChange")};
Blockly.Block.prototype.unselect=function(){Blockly.selected=null;this.svg_.removeSelect();Blockly.fireUiEvent(this.workspace.getCanvas(),"blocklySelectChange")};
Blockly.Block.prototype.destroy=function(a,b){if(this.outputConnection)this.setParent(null);else{var c=null;this.previousConnection&&this.previousConnection.targetConnection&&(c=this.previousConnection.targetConnection,this.setParent(null));if(a&&this.nextConnection&&this.nextConnection.targetConnection){var d=this.nextConnection.targetConnection,e=this.nextConnection.targetBlock();this.nextConnection.disconnect();e.setParent(null);c&&c.connect(d)}}b&&this.svg_&&this.svg_.destroyUiEffect();this.workspace.removeTopBlock(this);
this.workspace=null;this.rendered=!1;Blockly.selected==this&&(Blockly.selected=null,Blockly.Block.terminateDrag_());for(c=this.childBlocks_.length-1;0<=c;c--)this.childBlocks_[c].destroy(!1);this.mutator&&this.mutator.destroy();this.comment&&this.comment.destroy();this.warning&&this.warning.destroy();for(c=0;d=this.inputList[c];c++)d.destroy();this.inputList=[];d=this.getConnections_(!0);for(c=0;c<d.length;c++)e=d[c],e.targetConnection&&e.disconnect(),d[c].destroy();this.svg_&&(this.svg_.destroy(),
this.svg_=null)};Blockly.Block.prototype.getRelativeToSurfaceXY=function(){var a=0,b=0;if(this.svg_){var c=this.svg_.getRootNode();do var d=Blockly.getRelativeXY_(c),a=a+d.x,b=b+d.y,c=c.parentNode;while(c&&c!=this.workspace.getCanvas())}return{x:a,y:b}};Blockly.Block.prototype.moveBy=function(a,b){var c=this.getRelativeToSurfaceXY();this.svg_.getRootNode().setAttribute("transform","translate("+(c.x+a)+", "+(c.y+b)+")");this.moveConnections_(a,b)};
Blockly.Block.prototype.onMouseDown_=function(a){Blockly.svgResize();Blockly.Block.terminateDrag_();this.select();Blockly.hideChaff(this.isInFlyout);if(Blockly.isRightButton(a))Blockly.ContextMenu&&this.showContextMenu_(a.clientX,a.clientY);else if(this.editable){Blockly.removeAllRanges();Blockly.setCursorHand_(!0);var b=this.getRelativeToSurfaceXY();this.startDragX=b.x;this.startDragY=b.y;this.startDragMouseX=a.clientX;this.startDragMouseY=a.clientY;Blockly.Block.dragMode_=1;Blockly.Block.onMouseUpWrapper_=
Blockly.bindEvent_(Blockly.svgDoc,"mouseup",this,this.onMouseUp_);Blockly.Block.onMouseMoveWrapper_=Blockly.bindEvent_(Blockly.svgDoc,"mousemove",this,this.onMouseMove_);this.draggedBubbles_=[];for(var b=this.getDescendants(),c=0,d;d=b[c];c++){if(d.mutator){var e=d.mutator.getIconLocation();e.bubble=d.mutator;this.draggedBubbles_.push(e)}d.comment&&(e=d.comment.getIconLocation(),e.bubble=d.comment,this.draggedBubbles_.push(e));d.warning&&(e=d.warning.getIconLocation(),e.bubble=d.warning,this.draggedBubbles_.push(e))}}else return;
a.stopPropagation()};
Blockly.Block.prototype.onMouseUp_=function(){Blockly.Block.terminateDrag_();if(Blockly.selected&&Blockly.highlightedConnection_)Blockly.localConnection_.connect(Blockly.highlightedConnection_),this.svg_&&(Blockly.localConnection_.isSuperior()?Blockly.highlightedConnection_:Blockly.localConnection_).sourceBlock_.svg_.connectionUiEffect(),this.workspace.trashcan&&this.workspace.trashcan.isOpen&&Blockly.Trashcan.close(this.workspace.trashcan);else if(this.workspace.trashcan&&this.workspace.trashcan.isOpen){var a=this.workspace.trashcan;
window.setTimeout(function(){Blockly.Trashcan.close(a)},100);Blockly.selected.destroy(!1,!0);Blockly.fireUiEvent(window,"resize")}Blockly.highlightedConnection_&&(Blockly.highlightedConnection_.unhighlight(),Blockly.highlightedConnection_=null)};Blockly.Block.prototype.showHelp_=function(){var a="function"==typeof this.helpUrl?this.helpUrl():this.helpUrl;a&&window.open(a)};
Blockly.Block.prototype.duplicate_=function(){var a=Blockly.Xml.blockToDom_(this);Blockly.Xml.deleteNext(a);var a=Blockly.Xml.domToBlock_(this.workspace,a),b=this.getRelativeToSurfaceXY();b.x=Blockly.RTL?b.x-Blockly.SNAP_RADIUS:b.x+Blockly.SNAP_RADIUS;b.y+=2*Blockly.SNAP_RADIUS;a.moveBy(b.x,b.y)};
Blockly.Block.prototype.showContextMenu_=function(a,b){if(this.contextMenu){var c=this,d=[];if(this.editable){d.push({text:Blockly.MSG_DUPLICATE_BLOCK,enabled:!0,callback:function(){c.duplicate_()}});if(Blockly.Comment&&!this.collapsed){var e={enabled:!0};this.comment?(e.text=Blockly.MSG_REMOVE_COMMENT,e.callback=function(){c.setCommentText(null)}):(e.text=Blockly.MSG_ADD_COMMENT,e.callback=function(){c.setCommentText("")});d.push(e)}if(!this.collapsed)for(e=0;e<this.inputList.length;e++)if(this.inputList[e].type==
Blockly.INPUT_VALUE){e={enabled:!0};e.text=this.inputsInline?Blockly.MSG_EXTERNAL_INPUTS:Blockly.MSG_INLINE_INPUTS;e.callback=function(){c.setInputsInline(!c.inputsInline)};d.push(e);break}this.collapsed?(e={enabled:!0},e.text=Blockly.MSG_EXPAND_BLOCK,e.callback=function(){c.setCollapsed(!1)}):(e={enabled:!0},e.text=Blockly.MSG_COLLAPSE_BLOCK,e.callback=function(){c.setCollapsed(!0)});d.push(e);e={text:this.disabled?Blockly.MSG_ENABLE_BLOCK:Blockly.MSG_DISABLE_BLOCK,enabled:!this.getInheritedDisabled(),
callback:function(){c.setDisabled(!c.disabled)}};d.push(e);e=this.getDescendants().length;c.nextConnection&&c.nextConnection.targetConnection&&(e-=this.nextConnection.targetBlock().getDescendants().length);e={text:1==e?Blockly.MSG_DELETE_BLOCK:Blockly.MSG_DELETE_X_BLOCKS.replace("%1",e),enabled:!0,callback:function(){c.destroy(!0,!0)}};d.push(e)}e={enabled:!!("function"==typeof this.helpUrl?this.helpUrl():this.helpUrl)};e.text=Blockly.MSG_HELP;e.callback=function(){c.showHelp_()};d.push(e);this.customContextMenu&&
this.customContextMenu(d);Blockly.ContextMenu.show(a,b,d)}};Blockly.Block.prototype.getConnections_=function(a){var b=[];if(a||this.rendered)if(this.outputConnection&&b.push(this.outputConnection),this.nextConnection&&b.push(this.nextConnection),this.previousConnection&&b.push(this.previousConnection),a||!this.collapsed)for(var a=0,c;c=this.inputList[a];a++)c.connection&&b.push(c.connection);return b};
Blockly.Block.prototype.moveConnections_=function(a,b){if(this.rendered){for(var c=this.getConnections_(!1),d=0;d<c.length;d++)c[d].moveBy(a,b);this.mutator&&this.mutator.computeIconLocation();this.comment&&this.comment.computeIconLocation();this.warning&&this.warning.computeIconLocation();for(d=0;d<this.childBlocks_.length;d++)this.childBlocks_[d].moveConnections_(a,b)}};Blockly.Block.prototype.setDragging_=function(a){a?this.svg_.addDragging():this.svg_.removeDragging();for(var b=0;b<this.childBlocks_.length;b++)this.childBlocks_[b].setDragging_(a)};
Blockly.Block.prototype.onMouseMove_=function(a){if(!("mousemove"==a.type&&1==a.x&&0==a.y&&0==a.button)){Blockly.removeAllRanges();var b=a.clientX-this.startDragMouseX,c=a.clientY-this.startDragMouseY;1==Blockly.Block.dragMode_&&Math.sqrt(Math.pow(b,2)+Math.pow(c,2))>Blockly.DRAG_RADIUS&&(Blockly.Block.dragMode_=2,this.setParent(null),this.setDragging_(!0));if(2==Blockly.Block.dragMode_){var d=this.startDragX+b,e=this.startDragY+c;this.svg_.getRootNode().setAttribute("transform","translate("+d+", "+
e+")");for(d=0;d<this.draggedBubbles_.length;d++)e=this.draggedBubbles_[d],e.bubble.setIconLocation(e.x+b,e.y+c);for(var d=this.getConnections_(!1),f=e=null,h=Blockly.SNAP_RADIUS,g=0;g<d.length;g++){var i=d[g],k=i.closest(h,b,c);k.connection&&(e=k.connection,f=i,h=k.radius)}Blockly.highlightedConnection_&&Blockly.highlightedConnection_!=e&&(Blockly.highlightedConnection_.unhighlight(),Blockly.highlightedConnection_=null,Blockly.localConnection_=null);e&&e!=Blockly.highlightedConnection_&&(e.highlight(),
Blockly.highlightedConnection_=e,Blockly.localConnection_=f);this.workspace.trashcan&&this.workspace.trashcan.onMouseMove(a)}}a.stopPropagation()};
Blockly.Block.prototype.bumpNeighbours_=function(){for(var a=this.getRootBlock(),b=this.getConnections_(!1),c=0;c<b.length;c++){var d=b[c];d.targetConnection&&d.isSuperior()&&d.targetBlock().bumpNeighbours_();for(var e=d.neighbours_(Blockly.SNAP_RADIUS),f=0;f<e.length;f++){var h=e[f];if(!d.targetConnection||!h.targetConnection)h.sourceBlock_.getRootBlock()!=a&&(d.isSuperior()?h.bumpAwayFrom_(d):d.bumpAwayFrom_(h))}}};Blockly.Block.prototype.getParent=function(){return this.parentBlock_};
Blockly.Block.prototype.getSurroundParent=function(){for(var a=this;;){do{var b=a,a=a.getParent();if(!a)return null}while(a.nextConnection&&a.nextConnection.targetBlock()==b);return a}};Blockly.Block.prototype.getRootBlock=function(){var a,b=this;do a=b,b=a.parentBlock_;while(b);return a};Blockly.Block.prototype.getChildren=function(){return this.childBlocks_};
Blockly.Block.prototype.setParent=function(a){if(this.parentBlock_){for(var b=this.parentBlock_.childBlocks_,c,d=0;c=b[d];d++)if(c==this){b.splice(d,1);break}b=this.getRelativeToSurfaceXY();this.workspace.getCanvas().appendChild(this.svg_.getRootNode());this.svg_.getRootNode().setAttribute("transform","translate("+b.x+", "+b.y+")");this.parentBlock_=null;this.previousConnection&&this.previousConnection.targetConnection&&this.previousConnection.disconnect();this.outputConnection&&this.outputConnection.targetConnection&&
this.outputConnection.disconnect()}else this.workspace.removeTopBlock(this);(this.parentBlock_=a)?(a.childBlocks_.push(this),b=this.getRelativeToSurfaceXY(),a.svg_&&this.svg_&&a.svg_.getRootNode().appendChild(this.svg_.getRootNode()),a=this.getRelativeToSurfaceXY(),this.moveConnections_(a.x-b.x,a.y-b.y)):this.workspace.addTopBlock(this)};Blockly.Block.prototype.getDescendants=function(){for(var a=[this],b,c=0;b=this.childBlocks_[c];c++)a=a.concat(b.getDescendants());return a};
Blockly.Block.prototype.getColour=function(){return this.colourHue_};Blockly.Block.prototype.setColour=function(a){this.colourHue_=a;this.svg_&&this.svg_.updateColour();this.mutator&&this.mutator.updateColour();this.comment&&this.comment.updateColour();this.warning&&this.warning.updateColour();this.rendered&&this.render()};Blockly.Block.prototype.getTitle_=function(a){for(var b=0,c;c=this.inputList[b];b++)for(var d=0,e;e=c.titleRow[d];d++)if(e.name===a)return e;return null};
Blockly.Block.prototype.getTitleValue=function(a){return(a=this.getTitle_(a))?a.getValue():null};Blockly.Block.prototype.setTitleValue=function(a,b){var c=this.getTitle_(b);if(c)c.setValue(a);else throw'Title "'+b+'" not found.';};Blockly.Block.prototype.getTitleText=function(a){console.log("Obsolete call to getTitleText.  Please use getTitleValue.");return(a=this.getTitle_(a))?a.getText():null};
Blockly.Block.prototype.setTitleText=function(a,b){console.log("Obsolete call to setTitleText.  Please use setTitleValue.");var c=this.getTitle_(b);if(c)c.setText(a);else throw'Title "'+b+'" not found.';};Blockly.Block.prototype.setTooltip=function(a){this.tooltip=a};
Blockly.Block.prototype.setPreviousStatement=function(a,b){if(this.previousConnection){if(this.previousConnection.targetConnection)throw"Must disconnect previous statement before removing connection.";this.previousConnection.destroy();this.previousConnection=null}if(a){if(this.outputConnection)throw"Remove output connection prior to adding previous connection.";void 0===b&&(b=null);this.previousConnection=new Blockly.Connection(this,Blockly.PREVIOUS_STATEMENT);this.previousConnection.setCheck(b)}this.rendered&&
(this.render(),this.bumpNeighbours_())};Blockly.Block.prototype.setNextStatement=function(a,b){if(this.nextConnection){if(this.nextConnection.targetConnection)throw"Must disconnect next statement before removing connection.";this.nextConnection.destroy();this.nextConnection=null}a&&(void 0===b&&(b=null),this.nextConnection=new Blockly.Connection(this,Blockly.NEXT_STATEMENT),this.nextConnection.setCheck(b));this.rendered&&(this.render(),this.bumpNeighbours_())};
Blockly.Block.prototype.setOutput=function(a,b){if(this.outputConnection){if(this.outputConnection.targetConnection)throw"Must disconnect output value before removing connection.";this.outputConnection.destroy();this.outputConnection=null}if(a){if(this.previousConnection)throw"Remove previous connection prior to adding output connection.";void 0===b&&(b=null);this.outputConnection=new Blockly.Connection(this,Blockly.OUTPUT_VALUE);this.outputConnection.setCheck(b)}this.rendered&&(this.render(),this.bumpNeighbours_())};
Blockly.Block.prototype.setInputsInline=function(a){this.inputsInline=a;this.rendered&&(this.render(),this.bumpNeighbours_())};Blockly.Block.prototype.setDisabled=function(a){this.disabled!=a&&(this.disabled=a,this.svg_.updateDisabled(),this.workspace.fireChangeEvent())};Blockly.Block.prototype.getInheritedDisabled=function(){for(var a=this;;)if(a=a.getSurroundParent()){if(a.disabled)return!0}else return!1};
Blockly.Block.prototype.setCollapsed=function(a){if(this.collapsed!=a){for(var b=(this.collapsed=a)?"none":"block",c=[],d=0,e;e=this.inputList[d];d++){for(var f=0,h;h=e.titleRow[f];f++)(h.getRootElement?h.getRootElement():h).style.display=b;if(e.connection&&(a?e.connection.hideAll():c=c.concat(e.connection.unhideAll()),e=e.connection.targetBlock()))e.svg_.getRootNode().style.display=b,a&&(e.rendered=!1)}a&&this.mutator&&this.mutator.setVisible(!1);a&&this.comment&&this.comment.setVisible(!1);a&&this.warning&&
this.warning.setVisible(!1);0==c.length&&(c[0]=this);if(this.rendered){for(d=0;a=c[d];d++)a.render();this.bumpNeighbours_()}}};Blockly.Block.prototype.appendValueInput=function(a){return this.appendInput_(Blockly.INPUT_VALUE,a)};Blockly.Block.prototype.appendStatementInput=function(a){return this.appendInput_(Blockly.NEXT_STATEMENT,a)};Blockly.Block.prototype.appendDummyInput=function(a){return this.appendInput_(Blockly.DUMMY_INPUT,a||"")};
Blockly.Block.prototype.appendInput_=function(a,b){var c=null;if(a==Blockly.INPUT_VALUE||a==Blockly.NEXT_STATEMENT)c=new Blockly.Connection(this,a);c=new Blockly.Input(a,b,this,c);this.inputList.push(c);this.rendered&&(this.render(),this.bumpNeighbours_());return c};
Blockly.Block.prototype.moveInputBefore=function(a,b){if(a==b)throw"Can't move \""+a+'" to itself.';for(var c=-1,d=-1,e=0,f;f=this.inputList[e];e++)if(f.name==a){if(c=e,-1!=d)break}else if(f.name==b&&(d=e,-1!=c))break;if(-1==c)throw'Named input "'+a+'" not found.';if(-1==d)throw'Reference input "'+a+'" not found.';this.inputList.splice(c,1);c<d&&d--;this.inputList.splice(d,0,f);this.rendered&&(this.render(),this.bumpNeighbours_())};
Blockly.Block.prototype.removeInput=function(a){for(var b=0,c;c=this.inputList[b];b++)if(c.name==a){c.connection&&c.connection.targetConnection&&c.connection.targetBlock().setParent(null);c.destroy();this.inputList.splice(b,1);this.rendered&&(this.render(),this.bumpNeighbours_());return}throw'Input "'+a+'" not found.';};Blockly.Block.prototype.getInput=function(a){for(var b=0,c;c=this.inputList[b];b++)if(c.name==a)return c;return null};
Blockly.Block.prototype.getInputTargetBlock=function(a){return(a=this.getInput(a))&&a.connection&&a.connection.targetBlock()};Blockly.Block.prototype.setMutator=function(a){this.mutator&&this.mutator!==a&&this.mutator.destroy();a&&(a.block_=this,this.mutator=a,this.svg_&&a.createIcon())};Blockly.Block.prototype.getCommentText=function(){return this.comment?this.comment.getText().replace(/\s+$/,"").replace(/ +\n/g,"\n"):""};
Blockly.Block.prototype.setCommentText=function(a){if(!Blockly.Comment)throw"Comments not supported.";var b=!1;"string"==typeof a?(this.comment||(this.comment=new Blockly.Comment(this),b=!0),this.comment.setText(a)):this.comment&&(this.comment.destroy(),b=!0);this.rendered&&(this.render(),b&&this.bumpNeighbours_())};
Blockly.Block.prototype.setWarningText=function(a){if(!Blockly.Warning)throw"Warnings not supported.";var b=!1;"string"==typeof a?(this.warning||(this.warning=new Blockly.Warning(this),b=!0),this.warning.setText(a)):this.warning&&(this.warning.destroy(),b=!0);this.rendered&&(this.render(),b&&this.bumpNeighbours_())};Blockly.Block.prototype.render=function(){this.svg_.render()};Blockly.BlockSvg=function(a){this.block_=a;this.svgGroup_=Blockly.createSvgElement("g",{},null);this.svgPathDark_=Blockly.createSvgElement("path",{"class":"blocklyPathDark",transform:"translate(1, 1)"},this.svgGroup_);this.svgPath_=Blockly.createSvgElement("path",{"class":"blocklyPath"},this.svgGroup_);this.svgPathLight_=Blockly.createSvgElement("path",{"class":"blocklyPathLight"},this.svgGroup_);this.svgPath_.tooltip=this.block_;Blockly.Tooltip&&Blockly.Tooltip.bindMouseEvents(this.svgPath_);a.editable&&
Blockly.addClass_(this.svgGroup_,"blocklyDraggable")};Blockly.BlockSvg.INLINE=-1;Blockly.BlockSvg.prototype.init=function(){var a=this.block_;this.updateColour();for(var b=0,c;c=a.inputList[b];b++)c.init();a.mutator&&a.mutator.createIcon()};Blockly.BlockSvg.prototype.getRootNode=function(){return this.svgGroup_};Blockly.BlockSvg.SEP_SPACE_X=10;Blockly.BlockSvg.SEP_SPACE_Y=5;Blockly.BlockSvg.MIN_BLOCK_Y=25;Blockly.BlockSvg.TAB_HEIGHT=20;Blockly.BlockSvg.TAB_WIDTH=8;Blockly.BlockSvg.NOTCH_WIDTH=30;
Blockly.BlockSvg.CORNER_RADIUS=8;Blockly.BlockSvg.TITLE_HEIGHT=18;Blockly.BlockSvg.DISTANCE_45_INSIDE=(1-Math.SQRT1_2)*(Blockly.BlockSvg.CORNER_RADIUS-1)+1;Blockly.BlockSvg.DISTANCE_45_OUTSIDE=(1-Math.SQRT1_2)*(Blockly.BlockSvg.CORNER_RADIUS+1)-1;Blockly.BlockSvg.NOTCH_PATH_LEFT="l 6,4 3,0 6,-4";Blockly.BlockSvg.NOTCH_PATH_LEFT_HIGHLIGHT="l 6.5,4 2,0 6.5,-4";Blockly.BlockSvg.NOTCH_PATH_RIGHT="l -6,4 -3,0 -6,-4";Blockly.BlockSvg.JAGGED_TEETH="l 8,0 0,4 8,4 -16,8 8,4";
Blockly.BlockSvg.TAB_PATH_DOWN="v 5 c 0,10 -"+Blockly.BlockSvg.TAB_WIDTH+",-8 -"+Blockly.BlockSvg.TAB_WIDTH+",7.5 s "+Blockly.BlockSvg.TAB_WIDTH+",-2.5 "+Blockly.BlockSvg.TAB_WIDTH+",7.5";Blockly.BlockSvg.TAB_PATH_DOWN_HIGHLIGHT_RTL="v 6.5 m -"+0.98*Blockly.BlockSvg.TAB_WIDTH+",2.5 q -"+0.05*Blockly.BlockSvg.TAB_WIDTH+",10 "+0.27*Blockly.BlockSvg.TAB_WIDTH+",10 m "+0.71*Blockly.BlockSvg.TAB_WIDTH+",-2.5 v 1.5";Blockly.BlockSvg.TOP_LEFT_CORNER_START="m 0,"+Blockly.BlockSvg.CORNER_RADIUS;
Blockly.BlockSvg.TOP_LEFT_CORNER_START_HIGHLIGHT_RTL="m "+Blockly.BlockSvg.DISTANCE_45_INSIDE+","+Blockly.BlockSvg.DISTANCE_45_INSIDE;Blockly.BlockSvg.TOP_LEFT_CORNER_START_HIGHLIGHT_LTR="m 1,"+(Blockly.BlockSvg.CORNER_RADIUS-1);Blockly.BlockSvg.TOP_LEFT_CORNER="A "+Blockly.BlockSvg.CORNER_RADIUS+","+Blockly.BlockSvg.CORNER_RADIUS+" 0 0,1 "+Blockly.BlockSvg.CORNER_RADIUS+",0";
Blockly.BlockSvg.TOP_LEFT_CORNER_HIGHLIGHT="A "+(Blockly.BlockSvg.CORNER_RADIUS-1)+","+(Blockly.BlockSvg.CORNER_RADIUS-1)+" 0 0,1 "+Blockly.BlockSvg.CORNER_RADIUS+",1";Blockly.BlockSvg.INNER_TOP_LEFT_CORNER=Blockly.BlockSvg.NOTCH_PATH_RIGHT+" h -"+(Blockly.BlockSvg.NOTCH_WIDTH-15-Blockly.BlockSvg.CORNER_RADIUS)+" a "+Blockly.BlockSvg.CORNER_RADIUS+","+Blockly.BlockSvg.CORNER_RADIUS+" 0 0,0 -"+Blockly.BlockSvg.CORNER_RADIUS+","+Blockly.BlockSvg.CORNER_RADIUS;
Blockly.BlockSvg.INNER_BOTTOM_LEFT_CORNER="a "+Blockly.BlockSvg.CORNER_RADIUS+","+Blockly.BlockSvg.CORNER_RADIUS+" 0 0,0 "+Blockly.BlockSvg.CORNER_RADIUS+","+Blockly.BlockSvg.CORNER_RADIUS;Blockly.BlockSvg.INNER_TOP_LEFT_CORNER_HIGHLIGHT_RTL="a "+(Blockly.BlockSvg.CORNER_RADIUS+1)+","+(Blockly.BlockSvg.CORNER_RADIUS+1)+" 0 0,0 "+(-Blockly.BlockSvg.DISTANCE_45_OUTSIDE-1)+","+(Blockly.BlockSvg.CORNER_RADIUS-Blockly.BlockSvg.DISTANCE_45_OUTSIDE);
Blockly.BlockSvg.INNER_BOTTOM_LEFT_CORNER_HIGHLIGHT_RTL="a "+(Blockly.BlockSvg.CORNER_RADIUS+1)+","+(Blockly.BlockSvg.CORNER_RADIUS+1)+" 0 0,0 "+(Blockly.BlockSvg.CORNER_RADIUS+1)+","+(Blockly.BlockSvg.CORNER_RADIUS+1);Blockly.BlockSvg.INNER_BOTTOM_LEFT_CORNER_HIGHLIGHT_LTR="a "+(Blockly.BlockSvg.CORNER_RADIUS+1)+","+(Blockly.BlockSvg.CORNER_RADIUS+1)+" 0 0,0 "+(Blockly.BlockSvg.CORNER_RADIUS-Blockly.BlockSvg.DISTANCE_45_OUTSIDE)+","+(Blockly.BlockSvg.DISTANCE_45_OUTSIDE+1);
Blockly.BlockSvg.prototype.destroy=function(){this.svgGroup_.parentNode.removeChild(this.svgGroup_);this.block_=this.svgPathDark_=this.svgPathLight_=this.svgPath_=this.svgGroup_=null};
Blockly.BlockSvg.prototype.destroyUiEffect=function(){Blockly.playAudio("delete");var a=Blockly.getAbsoluteXY_(this.svgGroup_),b=this.svgGroup_.cloneNode(!0);b.translateX_=a.x;b.translateY_=a.y;b.setAttribute("transform","translate("+b.translateX_+","+b.translateY_+")");Blockly.svg.appendChild(b);b.bBox_=b.getBBox();b.startDate_=new Date;Blockly.BlockSvg.destroyUiStep_(b)};
Blockly.BlockSvg.destroyUiStep_=function(a){var b=(new Date-a.startDate_)/150;1<b?a.parentNode.removeChild(a):(a.setAttribute("transform","translate("+(a.translateX_+(Blockly.RTL?-1:1)*a.bBox_.width/2*b+", "+(a.translateY_+a.bBox_.height*b))+") scale("+(1-b)+")"),window.setTimeout(function(){Blockly.BlockSvg.destroyUiStep_(a)},10))};
Blockly.BlockSvg.prototype.connectionUiEffect=function(){Blockly.playAudio("click");var a=Blockly.getAbsoluteXY_(this.svgGroup_);this.block_.outputConnection?(a.x+=Blockly.RTL?3:-3,a.y+=13):this.block_.previousConnection&&(a.x+=Blockly.RTL?-23:23,a.y+=3);a=Blockly.createSvgElement("circle",{cx:a.x,cy:a.y,r:0,fill:"none",stroke:"#888","stroke-width":10},Blockly.svg);a.startDate_=new Date;Blockly.BlockSvg.connectionUiStep_(a)};
Blockly.BlockSvg.connectionUiStep_=function(a){var b=(new Date-a.startDate_)/150;1<b?a.parentNode.removeChild(a):(a.setAttribute("r",25*b),a.style.opacity=1-b,window.setTimeout(function(){Blockly.BlockSvg.connectionUiStep_(a)},10))};
Blockly.BlockSvg.prototype.updateColour=function(){var a=Blockly.makeColour(this.block_.getColour()),b=window.parseInt(a.charAt(1),16),c=window.parseInt(a.charAt(2),16),d=window.parseInt(a.charAt(3),16),e="0123456789abcdef".charAt(Math.min(b+3,15)),f="0123456789abcdef".charAt(Math.min(c+2,15)),h="0123456789abcdef".charAt(Math.min(d+2,15)),b="0123456789abcdef".charAt(Math.max(b-4,0)),c="0123456789abcdef".charAt(Math.max(c-4,0)),d="0123456789abcdef".charAt(Math.max(d-4,0));this.svgPathLight_.setAttribute("stroke",
"#"+e+f+h);this.svgPathDark_.setAttribute("fill","#"+b+c+d);this.svgPath_.setAttribute("fill",a)};Blockly.BlockSvg.prototype.updateDisabled=function(){this.block_.disabled||this.block_.getInheritedDisabled()?(Blockly.addClass_(this.svgGroup_,"blocklyDisabled"),this.svgPath_.setAttribute("fill","url(#blocklyDisabledPattern)")):(Blockly.removeClass_(this.svgGroup_,"blocklyDisabled"),this.updateColour());for(var a=this.block_.getChildren(),b=0,c;c=a[b];b++)c.svg_.updateDisabled()};
Blockly.BlockSvg.prototype.addSelect=function(){Blockly.addClass_(this.svgGroup_,"blocklySelected");this.svgGroup_.parentNode.appendChild(this.svgGroup_)};Blockly.BlockSvg.prototype.removeSelect=function(){Blockly.removeClass_(this.svgGroup_,"blocklySelected")};Blockly.BlockSvg.prototype.addDragging=function(){Blockly.addClass_(this.svgGroup_,"blocklyDragging")};Blockly.BlockSvg.prototype.removeDragging=function(){Blockly.removeClass_(this.svgGroup_,"blocklyDragging")};
Blockly.BlockSvg.prototype.render=function(){this.block_.rendered=!0;var a=Blockly.BlockSvg.SEP_SPACE_X;Blockly.RTL&&(a=-a);this.block_.mutator&&(a=this.block_.mutator.renderIcon(a));this.block_.comment&&(a=this.block_.comment.renderIcon(a));this.block_.warning&&(a=this.block_.warning.renderIcon(a));var a=a+(Blockly.RTL?Blockly.BlockSvg.SEP_SPACE_X:-Blockly.BlockSvg.SEP_SPACE_X),b=this.renderCompute_(a);this.renderDraw_(a,b);(a=this.block_.getParent())?a.render():Blockly.fireUiEvent(window,"resize")};
Blockly.BlockSvg.prototype.renderTitles_=function(a,b,c){Blockly.RTL&&(b=-b);for(var d=0,e;e=a[d];d++){var f=e.getSize().width;Blockly.RTL?(b-=f,e.getRootElement().setAttribute("transform","translate("+b+", "+c+")"),f&&(b-=Blockly.BlockSvg.SEP_SPACE_X)):(e.getRootElement().setAttribute("transform","translate("+b+", "+c+")"),f&&(b+=f+Blockly.BlockSvg.SEP_SPACE_X))}return Blockly.RTL?-b:b};
Blockly.BlockSvg.prototype.renderCompute_=function(a){var b=this.block_.inputList,c=[];c.rightEdge=a+2*Blockly.BlockSvg.SEP_SPACE_X;if(this.block_.previousConnection||this.block_.nextConnection)c.rightEdge=Math.max(c.rightEdge,Blockly.BlockSvg.NOTCH_WIDTH+Blockly.BlockSvg.SEP_SPACE_X);if(this.block_.collapsed)return c;for(var d=0,e=0,f=!1,h=!1,g=!1,i=void 0,k=0,j;j=b[k];k++){var l;!this.block_.inputsInline||!i||i==Blockly.NEXT_STATEMENT||j.type==Blockly.NEXT_STATEMENT?(i=j.type,l=[],l.type=this.block_.inputsInline&&
j.type!=Blockly.NEXT_STATEMENT?Blockly.BlockSvg.INLINE:j.type,l.height=0,c.push(l)):l=c[c.length-1];l.push(j);j.renderHeight=Blockly.BlockSvg.MIN_BLOCK_Y;j.renderWidth=this.block_.inputsInline&&j.type==Blockly.INPUT_VALUE?Blockly.BlockSvg.TAB_WIDTH+Blockly.BlockSvg.SEP_SPACE_X:0;if(j.connection&&j.connection.targetConnection){var n=j.connection.targetBlock().getSvgRoot();try{var p=n.getBBox()}catch(m){p={height:0,width:0}}-1!=window.navigator.userAgent.indexOf("AppleWebKit/")&&(p.height-=3);j.renderHeight=
Math.max(j.renderHeight,p.height-1);j.renderWidth=Math.max(j.renderWidth,p.width)}l.height=Math.max(l.height,j.renderHeight);j.titleWidth=0;1==c.length&&(j.titleWidth+=Blockly.RTL?-a:a);for(var n=0,q;q=j.titleRow[n];n++)0!=n&&(j.titleWidth+=Blockly.BlockSvg.SEP_SPACE_X),q=q.getSize(),j.titleWidth+=q.width,l.height=Math.max(l.height,q.height);l.type!=Blockly.BlockSvg.INLINE&&(l.type==Blockly.NEXT_STATEMENT?(h=!0,e=Math.max(e,j.titleWidth)):(l.type==Blockly.INPUT_VALUE?f=!0:l.type==Blockly.DUMMY_INPUT&&
(g=!0),d=Math.max(d,j.titleWidth)))}for(a=0;l=c[a];a++)if(l.thicker=!1,this.block_.inputsInline&&l.type==Blockly.BlockSvg.INLINE)for(b=0;j=l[b];b++)if(j.type==Blockly.INPUT_VALUE){l.height+=2*Blockly.BlockSvg.SEP_SPACE_Y;l.thicker=!0;break}c.statementEdge=2*Blockly.BlockSvg.SEP_SPACE_X+e;h&&(c.rightEdge=Math.max(c.rightEdge,c.statementEdge+Blockly.BlockSvg.NOTCH_WIDTH));f?c.rightEdge=Math.max(c.rightEdge,d+2*Blockly.BlockSvg.SEP_SPACE_X+Blockly.BlockSvg.TAB_WIDTH):g&&(c.rightEdge=Math.max(c.rightEdge,
d+2*Blockly.BlockSvg.SEP_SPACE_X));c.hasValue=f;c.hasStatement=h;c.hasDummy=g;return c};
Blockly.BlockSvg.prototype.renderDraw_=function(a,b){if(this.block_.outputConnection)this.squareBottomLeftCorner_=this.squareTopLeftCorner_=!0;else{this.squareBottomLeftCorner_=this.squareTopLeftCorner_=!1;if(this.block_.previousConnection){var c=this.block_.previousConnection.targetBlock();c&&(c.nextConnection&&c.nextConnection.targetConnection==this.block_.previousConnection)&&(this.squareTopLeftCorner_=!0)}if(this.block_.nextConnection&&(c=this.block_.nextConnection.targetBlock())&&c.previousConnection&&
c.previousConnection.targetConnection==this.block_.nextConnection)this.squareBottomLeftCorner_=!0}var d=this.block_.getRelativeToSurfaceXY(),e=[],f=[],c=[],h=[];this.renderDrawTop_(e,c,d,b.rightEdge);var g=this.renderDrawRight_(e,c,f,h,d,b,a);this.renderDrawBottom_(e,c,d,g);this.renderDrawLeft_(e,c,d,g);d=e.join(" ")+"\n"+f.join(" ");this.svgPath_.setAttribute("d",d);this.svgPathDark_.setAttribute("d",d);d=c.join(" ")+"\n"+h.join(" ");this.svgPathLight_.setAttribute("d",d);Blockly.RTL&&(this.svgPath_.setAttribute("transform",
"scale(-1 1)"),this.svgPathLight_.setAttribute("transform","scale(-1 1)"),this.svgPathDark_.setAttribute("transform","translate(1,1) scale(-1 1)"))};
Blockly.BlockSvg.prototype.renderDrawTop_=function(a,b,c,d){this.squareTopLeftCorner_?(a.push("m 0,0"),b.push("m 1,1")):(a.push(Blockly.BlockSvg.TOP_LEFT_CORNER_START),b.push(Blockly.RTL?Blockly.BlockSvg.TOP_LEFT_CORNER_START_HIGHLIGHT_RTL:Blockly.BlockSvg.TOP_LEFT_CORNER_START_HIGHLIGHT_LTR),a.push(Blockly.BlockSvg.TOP_LEFT_CORNER),b.push(Blockly.BlockSvg.TOP_LEFT_CORNER_HIGHLIGHT));this.block_.previousConnection&&(a.push("H",Blockly.BlockSvg.NOTCH_WIDTH-15),b.push("H",Blockly.BlockSvg.NOTCH_WIDTH-
15),a.push(Blockly.BlockSvg.NOTCH_PATH_LEFT),b.push(Blockly.BlockSvg.NOTCH_PATH_LEFT_HIGHLIGHT),this.block_.previousConnection.moveTo(c.x+(Blockly.RTL?-Blockly.BlockSvg.NOTCH_WIDTH:Blockly.BlockSvg.NOTCH_WIDTH),c.y));a.push("H",d);b.push("H",d+(Blockly.RTL?-1:0))};
Blockly.BlockSvg.prototype.renderDrawRight_=function(a,b,c,d,e,f,h){for(var g,i=0,k,j,l=0,n;n=f[l];l++){g=Blockly.BlockSvg.SEP_SPACE_X;0==l&&(g+=Blockly.RTL?-h:h);b.push("M",f.rightEdge-1+","+(i+1));if(n.type==Blockly.BlockSvg.INLINE){for(var p=0,m;m=n[p];p++)k=i+Blockly.BlockSvg.TITLE_HEIGHT,n.thicker&&(k+=Blockly.BlockSvg.SEP_SPACE_Y),g=this.renderTitles_(m.titleRow,g,k),m.type!=Blockly.DUMMY_INPUT&&(g+=m.renderWidth+Blockly.BlockSvg.SEP_SPACE_X),m.type==Blockly.INPUT_VALUE&&(c.push("M",g-Blockly.BlockSvg.SEP_SPACE_X+
","+(i+Blockly.BlockSvg.SEP_SPACE_Y)),c.push("h",Blockly.BlockSvg.TAB_WIDTH-m.renderWidth),c.push(Blockly.BlockSvg.TAB_PATH_DOWN),c.push("v",m.renderHeight-Blockly.BlockSvg.TAB_HEIGHT),c.push("h",m.renderWidth-Blockly.BlockSvg.TAB_WIDTH),c.push("z"),Blockly.RTL?(d.push("M",g-Blockly.BlockSvg.SEP_SPACE_X+Blockly.BlockSvg.TAB_WIDTH-m.renderWidth-1+","+(i+Blockly.BlockSvg.SEP_SPACE_Y+1)),d.push(Blockly.BlockSvg.TAB_PATH_DOWN_HIGHLIGHT_RTL),d.push("v",m.renderHeight-Blockly.BlockSvg.TAB_HEIGHT+2),d.push("h",
m.renderWidth-Blockly.BlockSvg.TAB_WIDTH)):(d.push("M",g-Blockly.BlockSvg.SEP_SPACE_X+1+","+(i+Blockly.BlockSvg.SEP_SPACE_Y+1)),d.push("v",m.renderHeight),d.push("h",Blockly.BlockSvg.TAB_WIDTH-m.renderWidth),d.push("M",g-m.renderWidth-Blockly.BlockSvg.SEP_SPACE_X+3.8+","+(i+Blockly.BlockSvg.SEP_SPACE_Y+Blockly.BlockSvg.TAB_HEIGHT-0.4)),d.push("l",0.42*Blockly.BlockSvg.TAB_WIDTH+",-1.8")),k=Blockly.RTL?e.x-g-Blockly.BlockSvg.TAB_WIDTH+Blockly.BlockSvg.SEP_SPACE_X+m.renderWidth-1:e.x+g+Blockly.BlockSvg.TAB_WIDTH-
Blockly.BlockSvg.SEP_SPACE_X-m.renderWidth+1,j=e.y+i+Blockly.BlockSvg.SEP_SPACE_Y,m.connection.moveTo(k,j),m.connection.targetConnection&&m.connection.tighten_());g=Math.max(g,f.rightEdge);a.push("H",g);b.push("H",g+(Blockly.RTL?-1:0));a.push("v",n.height);Blockly.RTL&&b.push("v",n.height-2)}else if(n.type==Blockly.INPUT_VALUE)m=n[0],k=i+Blockly.BlockSvg.TITLE_HEIGHT,m.align!=Blockly.ALIGN_LEFT&&(p=f.rightEdge-m.titleWidth-Blockly.BlockSvg.TAB_WIDTH-Blockly.BlockSvg.SEP_SPACE_X,m.align==Blockly.ALIGN_RIGHT?
g=p:m.align==Blockly.ALIGN_CENTRE&&(g=(p+g)/2)),this.renderTitles_(m.titleRow,g,k),a.push(Blockly.BlockSvg.TAB_PATH_DOWN),a.push("v",n.height-Blockly.BlockSvg.TAB_HEIGHT),Blockly.RTL?(b.push(Blockly.BlockSvg.TAB_PATH_DOWN_HIGHLIGHT_RTL),b.push("v",n.height-Blockly.BlockSvg.TAB_HEIGHT)):(b.push("M",f.rightEdge-4.2+","+(i+Blockly.BlockSvg.TAB_HEIGHT-0.4)),b.push("l",0.42*Blockly.BlockSvg.TAB_WIDTH+",-1.8")),k=e.x+(Blockly.RTL?-f.rightEdge-1:f.rightEdge+1),j=e.y+i,m.connection.moveTo(k,j),m.connection.targetConnection&&
m.connection.tighten_();else if(n.type==Blockly.DUMMY_INPUT)m=n[0],k=i+Blockly.BlockSvg.TITLE_HEIGHT,m.align!=Blockly.ALIGN_LEFT&&(p=f.rightEdge-m.titleWidth-Blockly.BlockSvg.SEP_SPACE_X,f.hasValue&&(p-=Blockly.BlockSvg.TAB_WIDTH),m.align==Blockly.ALIGN_RIGHT?g=p:m.align==Blockly.ALIGN_CENTRE&&(g=(p+g)/2)),this.renderTitles_(m.titleRow,g,k),a.push("v",n.height),Blockly.RTL&&b.push("v",n.height-2);else if(n.type==Blockly.NEXT_STATEMENT&&(m=n[0],0==l&&(a.push("v",Blockly.BlockSvg.SEP_SPACE_Y),Blockly.RTL&&
b.push("v",Blockly.BlockSvg.SEP_SPACE_Y-1),i+=Blockly.BlockSvg.SEP_SPACE_Y),k=i+Blockly.BlockSvg.TITLE_HEIGHT,m.align!=Blockly.ALIGN_LEFT&&(p=f.statementEdge-m.titleWidth-Blockly.BlockSvg.SEP_SPACE_X,m.align==Blockly.ALIGN_RIGHT?g=p:m.align==Blockly.ALIGN_CENTRE&&(g=(p+g)/2)),this.renderTitles_(m.titleRow,g,k),g=f.statementEdge+Blockly.BlockSvg.NOTCH_WIDTH,a.push("H",g),a.push(Blockly.BlockSvg.INNER_TOP_LEFT_CORNER),a.push("v",n.height-2*Blockly.BlockSvg.CORNER_RADIUS),a.push(Blockly.BlockSvg.INNER_BOTTOM_LEFT_CORNER),
a.push("H",f.rightEdge),Blockly.RTL?(b.push("M",g-Blockly.BlockSvg.NOTCH_WIDTH+Blockly.BlockSvg.DISTANCE_45_OUTSIDE+","+(i+Blockly.BlockSvg.DISTANCE_45_OUTSIDE)),b.push(Blockly.BlockSvg.INNER_TOP_LEFT_CORNER_HIGHLIGHT_RTL),b.push("v",n.height-2*Blockly.BlockSvg.CORNER_RADIUS),b.push(Blockly.BlockSvg.INNER_BOTTOM_LEFT_CORNER_HIGHLIGHT_RTL),b.push("H",f.rightEdge-1)):(b.push("M",g-Blockly.BlockSvg.NOTCH_WIDTH+Blockly.BlockSvg.DISTANCE_45_OUTSIDE+","+(i+n.height-Blockly.BlockSvg.DISTANCE_45_OUTSIDE)),
b.push(Blockly.BlockSvg.INNER_BOTTOM_LEFT_CORNER_HIGHLIGHT_LTR),b.push("H",f.rightEdge)),k=e.x+(Blockly.RTL?-g:g),j=e.y+i+1,m.connection.moveTo(k,j),m.connection.targetConnection&&m.connection.tighten_(),l==f.length-1||f[l+1].type==Blockly.NEXT_STATEMENT))a.push("v",Blockly.BlockSvg.SEP_SPACE_Y),Blockly.RTL&&b.push("v",Blockly.BlockSvg.SEP_SPACE_Y-1),i+=Blockly.BlockSvg.SEP_SPACE_Y;i+=n.height}f.length||(this.block_.collapsed&&(a.push(Blockly.BlockSvg.JAGGED_TEETH),Blockly.RTL?b.push("l 8,0 0,3.8 7,3.2 m -14.5,9 l 8,4"):
b.push("h 8")),i=Blockly.BlockSvg.MIN_BLOCK_Y,a.push("V",i),Blockly.RTL&&b.push("V",i-1));return i};
Blockly.BlockSvg.prototype.renderDrawBottom_=function(a,b,c,d){this.block_.nextConnection&&(a.push("H",Blockly.BlockSvg.NOTCH_WIDTH+" "+Blockly.BlockSvg.NOTCH_PATH_RIGHT),this.block_.nextConnection.moveTo(Blockly.RTL?c.x-Blockly.BlockSvg.NOTCH_WIDTH:c.x+Blockly.BlockSvg.NOTCH_WIDTH,c.y+d+1),this.block_.nextConnection.targetConnection&&this.block_.nextConnection.tighten_());this.squareBottomLeftCorner_?(a.push("H 0"),Blockly.RTL||b.push("M","1,"+d)):(a.push("H",Blockly.BlockSvg.CORNER_RADIUS),a.push("a",
Blockly.BlockSvg.CORNER_RADIUS+","+Blockly.BlockSvg.CORNER_RADIUS+" 0 0,1 -"+Blockly.BlockSvg.CORNER_RADIUS+",-"+Blockly.BlockSvg.CORNER_RADIUS),Blockly.RTL||(b.push("M",Blockly.BlockSvg.DISTANCE_45_INSIDE+","+(d-Blockly.BlockSvg.DISTANCE_45_INSIDE)),b.push("A",Blockly.BlockSvg.CORNER_RADIUS-1+","+(Blockly.BlockSvg.CORNER_RADIUS-1)+" 0 0,1 1,"+(d-Blockly.BlockSvg.CORNER_RADIUS))))};
Blockly.BlockSvg.prototype.renderDrawLeft_=function(a,b,c){this.block_.outputConnection?(this.block_.outputConnection.moveTo(c.x,c.y),a.push("V",Blockly.BlockSvg.TAB_HEIGHT),a.push("c 0,-10 -"+Blockly.BlockSvg.TAB_WIDTH+",8 -"+Blockly.BlockSvg.TAB_WIDTH+",-7.5 s "+Blockly.BlockSvg.TAB_WIDTH+",2.5 "+Blockly.BlockSvg.TAB_WIDTH+",-7.5"),Blockly.RTL?(b.push("M",-0.3*Blockly.BlockSvg.TAB_WIDTH+",8.9"),b.push("l",-0.45*Blockly.BlockSvg.TAB_WIDTH+",-2.1")):(b.push("V",Blockly.BlockSvg.TAB_HEIGHT-1),b.push("m",
-0.92*Blockly.BlockSvg.TAB_WIDTH+",-1 q "+-0.19*Blockly.BlockSvg.TAB_WIDTH+",-5.5 0,-11"),b.push("m",0.92*Blockly.BlockSvg.TAB_WIDTH+",1 V 1 H 2"))):Blockly.RTL||(this.squareTopLeftCorner_?b.push("V",1):b.push("V",Blockly.BlockSvg.CORNER_RADIUS));a.push("z")};Blockly.Bubble=function(a,b,c,d,e,f,h){var g=Blockly.Bubble.ARROW_ANGLE;Blockly.RTL&&(g=-g);this.arrow_radians_=2*g/360*Math.PI;this.workspace_=a;this.content_=b;this.shape_=c;a.getBubbleCanvas().appendChild(this.createDom_(b,f&&h));this.setAnchorLocation(d,e);if(!f||!h)a=this.content_.getBBox(),f=a.width+2*Blockly.Bubble.BORDER_WIDTH,h=a.height+2*Blockly.Bubble.BORDER_WIDTH;this.setBubbleSize(f,h);this.positionBubble_();this.renderArrow_();this.rendered_=!0;Blockly.bindEvent_(this.bubbleBack_,"mousedown",
this,this.bubbleMouseDown_);this.resizeGroup_&&Blockly.bindEvent_(this.resizeGroup_,"mousedown",this,this.resizeMouseDown_)};Blockly.Bubble.BORDER_WIDTH=6;Blockly.Bubble.ARROW_THICKNESS=10;Blockly.Bubble.ARROW_ANGLE=20;Blockly.Bubble.ARROW_BEND=4;Blockly.Bubble.ANCHOR_RADIUS=8;Blockly.Bubble.onMouseUpWrapper_=null;Blockly.Bubble.onMouseMoveWrapper_=null;
Blockly.Bubble.unbindDragEvents_=function(){Blockly.Bubble.onMouseUpWrapper_&&(Blockly.unbindEvent_(Blockly.Bubble.onMouseUpWrapper_),Blockly.Bubble.onMouseUpWrapper_=null);Blockly.Bubble.onMouseMoveWrapper_&&(Blockly.unbindEvent_(Blockly.Bubble.onMouseMoveWrapper_),Blockly.Bubble.onMouseMoveWrapper_=null)};Blockly.Bubble.prototype.rendered_=!1;Blockly.Bubble.prototype.anchorX_=0;Blockly.Bubble.prototype.anchorY_=0;Blockly.Bubble.prototype.relativeLeft_=0;Blockly.Bubble.prototype.relativeTop_=0;
Blockly.Bubble.prototype.width_=0;Blockly.Bubble.prototype.height_=0;Blockly.Bubble.prototype.autoLayout_=!0;
Blockly.Bubble.prototype.createDom_=function(a,b){this.bubbleGroup_=Blockly.createSvgElement("g",{},null);var c=Blockly.createSvgElement("g",{filter:"url(#blocklyEmboss)"},this.bubbleGroup_);this.bubbleArrow_=Blockly.createSvgElement("path",{},c);this.bubbleBack_=Blockly.createSvgElement("rect",{"class":"blocklyDraggable",x:0,y:0,rx:Blockly.Bubble.BORDER_WIDTH,ry:Blockly.Bubble.BORDER_WIDTH},c);b?(this.resizeGroup_=Blockly.createSvgElement("g",{"class":Blockly.RTL?"blocklyResizeSW":"blocklyResizeSE"},
this.bubbleGroup_),c=2*Blockly.Bubble.BORDER_WIDTH,Blockly.createSvgElement("polygon",{points:"0,x x,x x,0".replace(/x/g,c)},this.resizeGroup_),Blockly.createSvgElement("line",{"class":"blocklyResizeLine",x1:c/3,y1:c-1,x2:c-1,y2:c/3},this.resizeGroup_),Blockly.createSvgElement("line",{"class":"blocklyResizeLine",x1:2*c/3,y1:c-1,x2:c-1,y2:2*c/3},this.resizeGroup_)):this.resizeGroup_=null;this.bubbleGroup_.appendChild(a);return this.bubbleGroup_};
Blockly.Bubble.prototype.bubbleMouseDown_=function(a){this.promote_();Blockly.Bubble.unbindDragEvents_();!Blockly.isRightButton(a)&&!Blockly.isTargetInput_(a)&&(Blockly.setCursorHand_(!0),this.dragDeltaX=Blockly.RTL?this.relativeLeft_+a.clientX:this.relativeLeft_-a.clientX,this.dragDeltaY=this.relativeTop_-a.clientY,Blockly.Bubble.onMouseUpWrapper_=Blockly.bindEvent_(Blockly.svgDoc,"mouseup",this,Blockly.Bubble.unbindDragEvents_),Blockly.Bubble.onMouseMoveWrapper_=Blockly.bindEvent_(Blockly.svgDoc,
"mousemove",this,this.bubbleMouseMove_),Blockly.hideChaff(),a.stopPropagation())};Blockly.Bubble.prototype.bubbleMouseMove_=function(a){this.autoLayout_=!1;this.relativeLeft_=Blockly.RTL?this.dragDeltaX-a.clientX:this.dragDeltaX+a.clientX;this.relativeTop_=this.dragDeltaY+a.clientY;this.positionBubble_();this.renderArrow_()};
Blockly.Bubble.prototype.resizeMouseDown_=function(a){this.promote_();Blockly.Bubble.unbindDragEvents_();Blockly.isRightButton(a)||(Blockly.setCursorHand_(!0),this.resizeDeltaWidth=Blockly.RTL?this.width_+a.clientX:this.width_-a.clientX,this.resizeDeltaHeight=this.height_-a.clientY,Blockly.Bubble.onMouseUpWrapper_=Blockly.bindEvent_(Blockly.svgDoc,"mouseup",this,Blockly.Bubble.unbindDragEvents_),Blockly.Bubble.onMouseMoveWrapper_=Blockly.bindEvent_(Blockly.svgDoc,"mousemove",this,this.resizeMouseMove_),
Blockly.hideChaff(),a.stopPropagation())};Blockly.Bubble.prototype.resizeMouseMove_=function(a){this.autoLayout_=!1;var b=this.resizeDeltaWidth,c=this.resizeDeltaHeight+a.clientY,b=Blockly.RTL?b-a.clientX:b+a.clientX;this.setBubbleSize(b,c);Blockly.RTL&&this.positionBubble_()};Blockly.Bubble.prototype.registerResizeEvent=function(a,b){Blockly.bindEvent_(this.bubbleGroup_,"resize",a,b)};Blockly.Bubble.prototype.promote_=function(){this.bubbleGroup_.parentNode.appendChild(this.bubbleGroup_)};
Blockly.Bubble.prototype.setAnchorLocation=function(a,b){this.anchorX_=a;this.anchorY_=b;this.rendered_&&this.positionBubble_()};
Blockly.Bubble.prototype.layoutBubble_=function(){var a=-this.width_/4,b=-this.height_-Blockly.BlockSvg.MIN_BLOCK_Y;if(this.workspace_.scrollbar){var c=this.workspace_.scrollbar.getMetrics_();this.anchorX_+a<Blockly.BlockSvg.SEP_SPACE_X+c.viewLeft?a=Blockly.BlockSvg.SEP_SPACE_X+c.viewLeft-this.anchorX_:c.viewLeft+c.viewWidth<this.anchorX_+a+this.width_+Blockly.BlockSvg.SEP_SPACE_X+Blockly.Scrollbar.scrollbarThickness&&(a=c.viewLeft+c.viewWidth-this.anchorX_-this.width_-Blockly.BlockSvg.SEP_SPACE_X-
Blockly.Scrollbar.scrollbarThickness);this.anchorY_+b<Blockly.BlockSvg.SEP_SPACE_Y+c.viewTop&&(b=this.shape_.getBBox().height)}this.relativeLeft_=a;this.relativeTop_=b};Blockly.Bubble.prototype.positionBubble_=function(){this.bubbleGroup_.setAttribute("transform","translate("+(Blockly.RTL?this.anchorX_-this.relativeLeft_-this.width_:this.anchorX_+this.relativeLeft_)+", "+(this.relativeTop_+this.anchorY_)+")")};Blockly.Bubble.prototype.getBubbleSize=function(){return{width:this.width_,height:this.height_}};
Blockly.Bubble.prototype.setBubbleSize=function(a,b){var c=2*Blockly.Bubble.BORDER_WIDTH,a=Math.max(a,c+45),b=Math.max(b,c+Blockly.BlockSvg.TITLE_HEIGHT);this.width_=a;this.height_=b;this.bubbleBack_.setAttribute("width",a);this.bubbleBack_.setAttribute("height",b);this.resizeGroup_&&(Blockly.RTL?this.resizeGroup_.setAttribute("transform","translate("+2*Blockly.Bubble.BORDER_WIDTH+", "+(b-c)+") scale(-1 1)"):this.resizeGroup_.setAttribute("transform","translate("+(a-c)+", "+(b-c)+")"));this.rendered_&&
(this.autoLayout_&&this.layoutBubble_(),this.positionBubble_(),this.renderArrow_());Blockly.fireUiEvent(this.bubbleGroup_,"resize")};
Blockly.Bubble.prototype.renderArrow_=function(){var a=[],b=this.width_/2,c=this.height_/2,d=-this.relativeLeft_,e=-this.relativeTop_;if(b==d&&c==e)a.push("M "+b+","+c);else{e-=c;d-=b;Blockly.RTL&&(d*=-1);var f=Math.sqrt(e*e+d*d),h=Math.acos(d/f);0>e&&(h=2*Math.PI-h);var g=h+Math.PI/2;g>2*Math.PI&&(g-=2*Math.PI);var i=Math.sin(g),k=Math.cos(g),j=this.getBubbleSize(),g=(j.width+j.height)/Blockly.Bubble.ARROW_THICKNESS,g=Math.min(g,j.width,j.height)/2,j=1-Blockly.Bubble.ANCHOR_RADIUS/f,d=b+j*d,e=c+
j*e,j=b+g*k,l=c+g*i,b=b-g*k,c=c-g*i,i=h+this.arrow_radians_;i>2*Math.PI&&(i-=2*Math.PI);h=Math.sin(i)*f/Blockly.Bubble.ARROW_BEND;f=Math.cos(i)*f/Blockly.Bubble.ARROW_BEND;a.push("M"+j+","+l);a.push("C"+(j+f)+","+(l+h)+" "+d+","+e+" "+d+","+e);a.push("C"+d+","+e+" "+(b+f)+","+(c+h)+" "+b+","+c)}a.push("z");this.bubbleArrow_.setAttribute("d",a.join(" "))};Blockly.Bubble.prototype.setColour=function(a){this.bubbleBack_.setAttribute("fill",a);this.bubbleArrow_.setAttribute("fill",a)};
Blockly.Bubble.prototype.destroy=function(){Blockly.Bubble.unbindDragEvents_();this.bubbleGroup_.parentNode.removeChild(this.bubbleGroup_);this.shape_=this.content_=this.workspace_=this.bubbleGroup_=null};Blockly.Comment=function(a){this.block_=a;this.createIcon_()};Blockly.Comment.ICON_RADIUS=8;Blockly.Comment.prototype.bubble_=null;Blockly.Comment.prototype.text_="";Blockly.Comment.prototype.iconX_=null;Blockly.Comment.prototype.iconY_=null;Blockly.Comment.prototype.width_=160;Blockly.Comment.prototype.height_=80;
Blockly.Comment.prototype.createIcon_=function(){this.iconGroup_=Blockly.createSvgElement("g",{"class":"blocklyIconGroup"},null);Blockly.createSvgElement("circle",{"class":"blocklyIconShield",r:Blockly.Comment.ICON_RADIUS,cx:Blockly.Comment.ICON_RADIUS,cy:Blockly.Comment.ICON_RADIUS},this.iconGroup_);this.iconMark_=Blockly.createSvgElement("text",{"class":"blocklyIconMark",x:Blockly.Comment.ICON_RADIUS,y:2*Blockly.Comment.ICON_RADIUS-3},this.iconGroup_);this.iconMark_.appendChild(Blockly.svgDoc.createTextNode("?"));
this.block_.getSvgRoot().appendChild(this.iconGroup_);Blockly.bindEvent_(this.iconGroup_,"mouseup",this,this.iconClick_)};
Blockly.Comment.prototype.createEditor_=function(){this.foreignObject_=Blockly.createSvgElement("foreignObject",{x:Blockly.Bubble.BORDER_WIDTH,y:Blockly.Bubble.BORDER_WIDTH},null);var a=Blockly.svgDoc.createElementNS(Blockly.HTML_NS,"body");a.setAttribute("xmlns",Blockly.HTML_NS);a.className="blocklyMinimalBody";this.textarea_=Blockly.svgDoc.createElementNS(Blockly.HTML_NS,"textarea");this.textarea_.className="blocklyCommentTextarea";this.textarea_.setAttribute("dir",Blockly.RTL?"RTL":"LTR");a.appendChild(this.textarea_);
this.foreignObject_.appendChild(a);Blockly.bindEvent_(this.textarea_,"mouseup",this,this.textareaFocus_);return this.foreignObject_};Blockly.Comment.prototype.resizeBubble_=function(){var a=this.bubble_.getBubbleSize(),b=2*Blockly.Bubble.BORDER_WIDTH;this.foreignObject_.setAttribute("width",a.width-b);this.foreignObject_.setAttribute("height",a.height-b);this.textarea_.style.width=a.width-b-4+"px";this.textarea_.style.height=a.height-b-4+"px"};Blockly.Comment.prototype.isVisible=function(){return!!this.bubble_};
Blockly.Comment.prototype.setVisible=function(a){if(a!=this.isVisible()){var b=this.getText(),c=this.getBubbleSize();a?(this.bubble_=new Blockly.Bubble(this.block_.workspace,this.createEditor_(),this.block_.svg_.svgGroup_,this.iconX_,this.iconY_,this.width_,this.height_),this.bubble_.registerResizeEvent(this,this.resizeBubble_),this.updateColour(),this.text_=null):(this.bubble_.destroy(),this.foreignObject_=this.textarea_=this.bubble_=null);this.setText(b);this.setBubbleSize(c.width,c.height)}};
Blockly.Comment.prototype.iconClick_=function(){this.setVisible(!this.isVisible())};Blockly.Comment.prototype.textareaFocus_=function(){this.bubble_.promote_();this.textarea_.focus()};Blockly.Comment.prototype.getBubbleSize=function(){return this.isVisible()?this.bubble_.getBubbleSize():{width:this.width_,height:this.height_}};Blockly.Comment.prototype.setBubbleSize=function(a,b){this.isVisible()?this.bubble_.setBubbleSize(a,b):(this.width_=a,this.height_=b)};
Blockly.Comment.prototype.getText=function(){return this.isVisible()?this.textarea_.value:this.text_};Blockly.Comment.prototype.setText=function(a){this.isVisible()?this.textarea_.value=a:this.text_=a};Blockly.Comment.prototype.updateColour=function(){if(this.isVisible()){var a=Blockly.makeColour(this.block_.getColour());this.bubble_.setColour(a)}};
Blockly.Comment.prototype.destroy=function(){this.iconGroup_.parentNode.removeChild(this.iconGroup_);this.iconGroup_=null;this.setVisible(!1);this.block_=this.block_.comment=null};
Blockly.Comment.prototype.renderIcon=function(a){if(this.block_.collapsed)return this.iconGroup_.setAttribute("display","none"),a;this.iconGroup_.setAttribute("display","block");var b=2*Blockly.Comment.ICON_RADIUS;Blockly.RTL&&(a-=b);this.iconGroup_.setAttribute("transform","translate("+a+", 5)");this.computeIconLocation();return a=Blockly.RTL?a-Blockly.BlockSvg.SEP_SPACE_X:a+(b+Blockly.BlockSvg.SEP_SPACE_X)};
Blockly.Comment.prototype.setIconLocation=function(a,b){this.iconX_=a;this.iconY_=b;this.isVisible()&&this.bubble_.setAnchorLocation(a,b)};Blockly.Comment.prototype.computeIconLocation=function(){var a=this.block_.getRelativeToSurfaceXY(),b=Blockly.getRelativeXY_(this.iconGroup_),c=a.x+b.x+Blockly.Comment.ICON_RADIUS,a=a.y+b.y+Blockly.Comment.ICON_RADIUS;(c!==this.iconX_||a!==this.iconY_)&&this.setIconLocation(c,a)};Blockly.Comment.prototype.getIconLocation=function(){return{x:this.iconX_,y:this.iconY_}};Blockly.Connection=function(a,b){this.sourceBlock_=a;this.targetConnection=null;this.type=b;this.y_=this.x_=0;this.inDB_=!1;this.dbList_=this.sourceBlock_.workspace.connectionDBList};
Blockly.Connection.prototype.destroy=function(){if(this.targetConnection)throw"Disconnect connection before destroying it.";this.inDB_&&this.dbList_[this.type].removeConnection_(this);this.inDB_=!1;Blockly.highlightedConnection_==this&&(Blockly.highlightedConnection_=null);Blockly.localConnection_==this&&(Blockly.localConnection_=null)};Blockly.Connection.prototype.isSuperior=function(){return this.type==Blockly.INPUT_VALUE||this.type==Blockly.NEXT_STATEMENT};
Blockly.Connection.prototype.connect=function(a){if(this.sourceBlock_==a.sourceBlock_)throw"Attempted to connect a block to itself.";if(this.sourceBlock_.workspace!==a.sourceBlock_.workspace)throw"Blocks are on different workspaces.";if(Blockly.OPPOSITE_TYPE[this.type]!=a.type)throw"Attempt to connect incompatible types.";if(this.type==Blockly.INPUT_VALUE||this.type==Blockly.OUTPUT_VALUE){if(this.targetConnection)throw"Source connection already connected (value).";if(a.targetConnection){var b=a.targetBlock();
b.setParent(null);for(var c=this.sourceBlock_;c=Blockly.Connection.singleConnection_(c,b);)if(c.targetBlock())c=c.targetBlock();else{c.connect(b.outputConnection);b=null;break}b&&window.setTimeout(function(){b.outputConnection.bumpAwayFrom_(a)},Blockly.BUMP_DELAY)}}else{if(this.targetConnection)throw"Source connection already connected (block).";if(a.targetConnection){if(this.type!=Blockly.PREVIOUS_STATEMENT)throw"Can only do a mid-stack connection with the top of a block.";b=a.targetBlock();b.setParent(null);
for(c=this.sourceBlock_;c.nextConnection;)if(c.nextConnection.targetConnection)c=c.nextConnection.targetBlock();else{c.nextConnection.connect(b.previousConnection);b=null;break}b&&window.setTimeout(function(){b.previousConnection.bumpAwayFrom_(a)},Blockly.BUMP_DELAY)}}var d;this.isSuperior()?(c=this.sourceBlock_,d=a.sourceBlock_):(c=a.sourceBlock_,d=this.sourceBlock_);this.targetConnection=a;a.targetConnection=this;d.setParent(c);c.rendered&&c.svg_.updateDisabled();d.rendered&&(d.svg_.updateDisabled(),
d.render())};Blockly.Connection.singleConnection_=function(a,b){for(var c=!1,d=0;d<a.inputList.length;d++){var e=a.inputList[d].connection;if(e&&e.type==Blockly.INPUT_VALUE&&b.outputConnection.checkType_(e)){if(c)return null;c=e}}return c};
Blockly.Connection.prototype.disconnect=function(){var a=this.targetConnection;if(a){if(a.targetConnection!=this)throw"Target connection not connected to source connection.";}else throw"Source connection not connected.";this.targetConnection=a.targetConnection=null;var b;this.isSuperior()?(b=this.sourceBlock_,a=a.sourceBlock_):(b=a.sourceBlock_,a=this.sourceBlock_);b.rendered&&b.render();a.rendered&&(a.svg_.updateDisabled(),a.render())};
Blockly.Connection.prototype.targetBlock=function(){return this.targetConnection?this.targetConnection.sourceBlock_:null};
Blockly.Connection.prototype.bumpAwayFrom_=function(a){if(0==Blockly.Block.dragMode_){var b=this.sourceBlock_.getRootBlock(),c=!1;if(!b.editable){b=a.sourceBlock_.getRootBlock();if(!b.editable)return;a=this;c=!0}b.getSvgRoot().parentNode.appendChild(b.getSvgRoot());var d=a.x_+Blockly.SNAP_RADIUS-this.x_,a=a.y_+2*Blockly.SNAP_RADIUS-this.y_;c&&(a=-a);Blockly.RTL&&(d=-d);b.moveBy(d,a)}};
Blockly.Connection.prototype.moveTo=function(a,b){this.inDB_&&this.dbList_[this.type].removeConnection_(this);this.x_=a;this.y_=b;this.dbList_[this.type].addConnection_(this)};Blockly.Connection.prototype.moveBy=function(a,b){this.moveTo(this.x_+a,this.y_+b)};
Blockly.Connection.prototype.highlight=function(){var a;this.type==Blockly.INPUT_VALUE||this.type==Blockly.OUTPUT_VALUE?(a=Blockly.RTL?-Blockly.BlockSvg.TAB_WIDTH:Blockly.BlockSvg.TAB_WIDTH,a="m 0,0 v 5 c 0,10 "+-a+",-8 "+-a+",7.5 s "+a+",-2.5 "+a+",7.5 v 5"):a=Blockly.RTL?"m 20,0 h -5 l -6,4 -3,0 -6,-4 h -5":"m -20,0 h 5 l 6,4 3,0 6,-4 h 5";var b=this.sourceBlock_.getRelativeToSurfaceXY();Blockly.Connection.highlightedPath_=Blockly.createSvgElement("path",{"class":"blocklyHighlightedConnectionPath",
d:a,transform:"translate("+(this.x_-b.x)+", "+(this.y_-b.y)+")"},this.sourceBlock_.getSvgRoot())};Blockly.Connection.prototype.unhighlight=function(){var a=Blockly.Connection.highlightedPath_;a.parentNode.removeChild(a);delete Blockly.Connection.highlightedPath_};
Blockly.Connection.prototype.tighten_=function(){var a=Math.round(this.targetConnection.x_-this.x_),b=Math.round(this.targetConnection.y_-this.y_);if(0!=a||0!=b){var c=this.targetBlock(),d=Blockly.getRelativeXY_(c.getSvgRoot());c.getSvgRoot().setAttribute("transform","translate("+(d.x-a)+", "+(d.y-b)+")");c.moveConnections_(-a,-b)}};
Blockly.Connection.prototype.closest=function(a,b,c){function d(b){var c=e[b];if((c.type==Blockly.OUTPUT_VALUE||c.type==Blockly.PREVIOUS_STATEMENT)&&c.targetConnection||!j.checkType_(c))return!0;c=c.sourceBlock_;do{if(k==c)return!0;c=c.getParent()}while(c);var d=f-e[b].x_,c=h-e[b].y_,d=Math.sqrt(d*d+c*c);d<=a&&(i=e[b],a=d);return c<a}if(this.targetConnection)return{connection:null,radius:a};for(var e=this.dbList_[Blockly.OPPOSITE_TYPE[this.type]],f=this.x_+b,h=this.y_+c,b=0,g=c=e.length-2;b<g;)e[g].y_<
h?b=g:c=g,g=Math.floor((b+c)/2);var c=b=g,i=null,k=this.sourceBlock_,j=this;if(e.length){for(;0<=b&&d(b);)b--;do c++;while(c<e.length&&d(c))}return{connection:i,radius:a}};Blockly.Connection.prototype.checkType_=function(a){if(!this.check_||!a.check_)return!0;for(var b=0;b<this.check_.length;b++)if(-1!=a.check_.indexOf(this.check_[b]))return!0;return!1};
Blockly.Connection.prototype.setCheck=function(a){a?(a instanceof Array||(a=[a]),this.check_=a,this.targetConnection&&!this.checkType_(this.targetConnection)&&(this.isSuperior()?this.targetBlock().setParent(null):this.sourceBlock_.setParent(null),this.sourceBlock_.bumpNeighbours_())):this.check_=null;return this};
Blockly.Connection.prototype.neighbours_=function(a){function b(b){var f=d-c[b].x_,g=e-c[b].y_;Math.sqrt(f*f+g*g)<=a&&i.push(c[b]);return g<a}for(var c=this.dbList_[Blockly.OPPOSITE_TYPE[this.type]],d=this.x_,e=this.y_,f=0,h=c.length-2,g=h;f<g;)c[g].y_<e?f=g:h=g,g=Math.floor((f+h)/2);var h=f=g,i=[];if(c.length){for(;0<=f&&b(f);)f--;do h++;while(h<c.length&&b(h))}return i};
Blockly.Connection.prototype.hideAll=function(){this.inDB_&&this.dbList_[this.type].removeConnection_(this);if(this.targetConnection)for(var a=this.targetBlock().getDescendants(),b=0;b<a.length;b++){for(var c=a[b],d=c.getConnections_(!0),e=0;e<d.length;e++){var f=d[e];f.inDB_&&this.dbList_[f.type].removeConnection_(f)}c.comment&&c.comment.setVisible_(!1)}};
Blockly.Connection.prototype.unhideAll=function(){this.inDB_||this.dbList_[this.type].addConnection_(this);var a=[];if(this.type!=Blockly.INPUT_VALUE&&this.type!=Blockly.NEXT_STATEMENT)return a;var b=this.targetBlock();if(b){var c;b.collapsed?(c=[],b.outputConnection&&c.push(b.outputConnection),b.nextConnection&&c.push(b.nextConnection),b.previousConnection&&c.push(b.previousConnection)):c=b.getConnections_(!0);for(var d=0;d<c.length;d++)a=a.concat(c[d].unhideAll());0==a.length&&(a[0]=b);b.comment&&
b.comment.isPinned()&&b.comment.setVisible_(!0)}return a};Blockly.ConnectionDB=function(){};Blockly.ConnectionDB.prototype=[];Blockly.ConnectionDB.constructor=Blockly.ConnectionDB;Blockly.ConnectionDB.prototype.addConnection_=function(a){if(a.inDB_)throw"Connection already in database.";for(var b=0,c=this.length;b<c;){var d=Math.floor((b+c)/2);if(this[d].y_<a.y_)b=d+1;else if(this[d].y_>a.y_)c=d;else{b=d;break}}this.splice(b,0,a);a.inDB_=!0};
Blockly.ConnectionDB.prototype.removeConnection_=function(a){if(!a.inDB_)throw"Connection not in database.";a.inDB_=!1;for(var b=0,c=this.length-2,d=c;b<d;)this[d].y_<a.y_?b=d:c=d,d=Math.floor((b+c)/2);for(c=b=d;0<=b&&this[b].y_==a.y_;){if(this[b]==a){this.splice(b,1);return}b--}do{if(this[c]==a){this.splice(c,1);return}c++}while(c<this.length&&this[c].y_==a.y_);throw"Unable to find connection in connectionDB.";};
Blockly.ConnectionDB.init=function(a){var b=[];b[Blockly.INPUT_VALUE]=new Blockly.ConnectionDB;b[Blockly.OUTPUT_VALUE]=new Blockly.ConnectionDB;b[Blockly.NEXT_STATEMENT]=new Blockly.ConnectionDB;b[Blockly.PREVIOUS_STATEMENT]=new Blockly.ConnectionDB;a.connectionDBList=b};Blockly.ContextMenu={};Blockly.ContextMenu.X_PADDING=20;Blockly.ContextMenu.Y_HEIGHT=20;Blockly.ContextMenu.visible=!1;
Blockly.ContextMenu.createDom=function(){var a=Blockly.createSvgElement("g",{"class":"blocklyHidden"},null);Blockly.ContextMenu.svgGroup=a;Blockly.ContextMenu.svgShadow=Blockly.createSvgElement("rect",{"class":"blocklyContextMenuShadow",x:2,y:-2,rx:4,ry:4},a);Blockly.ContextMenu.svgBackground=Blockly.createSvgElement("rect",{"class":"blocklyContextMenuBackground",y:-4,rx:4,ry:4},a);Blockly.ContextMenu.svgOptions=Blockly.createSvgElement("g",{"class":"blocklyContextMenuOptions"},a);return a};
Blockly.ContextMenu.show=function(a,b,c){if(0==c.length)Blockly.ContextMenu.hide();else{Blockly.removeChildren_(Blockly.ContextMenu.svgOptions);Blockly.ContextMenu.svgGroup.style.display="block";for(var d=0,e=[Blockly.ContextMenu.svgBackground,Blockly.ContextMenu.svgShadow],f=0,h;h=c[f];f++){var g=Blockly.ContextMenu.optionToDom(h.text),i=g.firstChild,k=g.lastChild;Blockly.ContextMenu.svgOptions.appendChild(g);g.setAttribute("transform","translate(0, "+f*Blockly.ContextMenu.Y_HEIGHT+")");e.push(i);
Blockly.bindEvent_(g,"mousedown",null,Blockly.noEvent);h.enabled?(Blockly.bindEvent_(g,"mouseup",null,h.callback),Blockly.bindEvent_(g,"mouseup",null,Blockly.ContextMenu.hide)):g.setAttribute("class","blocklyMenuDivDisabled");d=Math.max(d,k.getComputedTextLength())}d+=2*Blockly.ContextMenu.X_PADDING;for(f=0;f<e.length;f++)e[f].setAttribute("width",d);if(Blockly.RTL)for(f=0;g=Blockly.ContextMenu.svgOptions.childNodes[f];f++)k=g.lastChild,k.setAttribute("text-anchor","end"),k.setAttribute("x",d-Blockly.ContextMenu.X_PADDING);
Blockly.ContextMenu.svgBackground.setAttribute("height",c.length*Blockly.ContextMenu.Y_HEIGHT+8);Blockly.ContextMenu.svgShadow.setAttribute("height",c.length*Blockly.ContextMenu.Y_HEIGHT+10);b=Blockly.mouseToSvg(a,b);a=b.x;b=b.y;c=Blockly.ContextMenu.svgGroup.getBBox();d=Blockly.svgSize();b+c.height>d.height&&(b-=c.height-10);Blockly.RTL?0>=a-c.width?a++:a-=c.width:a+c.width>d.width?a-=c.width:a++;Blockly.ContextMenu.svgGroup.setAttribute("transform","translate("+a+", "+b+")");Blockly.ContextMenu.visible=
!0}};Blockly.ContextMenu.optionToDom=function(a){var b=Blockly.createSvgElement("g",{"class":"blocklyMenuDiv"},null);Blockly.createSvgElement("rect",{height:Blockly.ContextMenu.Y_HEIGHT},b);var c=Blockly.createSvgElement("text",{"class":"blocklyMenuText",x:Blockly.ContextMenu.X_PADDING,y:15},b),a=Blockly.svgDoc.createTextNode(a);c.appendChild(a);return b};
Blockly.ContextMenu.hide=function(){Blockly.ContextMenu.visible&&(Blockly.ContextMenu.svgGroup.style.display="none",Blockly.ContextMenu.visible=!1)};Blockly.Field=function(a){null!==a&&(this.sourceBlock_=null,this.group_=Blockly.createSvgElement("g",{},null),this.borderRect_=Blockly.createSvgElement("rect",{rx:4,ry:4,x:-Blockly.BlockSvg.SEP_SPACE_X/2,y:-12,height:16},this.group_),this.textElement_=Blockly.createSvgElement("text",{"class":"blocklyText"},this.group_),this.CURSOR&&(this.group_.style.cursor=this.CURSOR),this.size_={height:25,width:0},this.setText(a))};Blockly.Field.NBSP="\u00a0";Blockly.Field.prototype.EDITABLE=!0;
Blockly.Field.prototype.init=function(a){if(this.sourceBlock_)throw"Field has already been initialized once.";this.sourceBlock_=a;this.group_.setAttribute("class",a.editable?"blocklyEditableText":"blocklyNonEditableText");a.getSvgRoot().appendChild(this.group_);a.editable&&(this.mouseUpWrapper_=Blockly.bindEvent_(this.group_,"mouseup",this,this.onMouseUp_))};
Blockly.Field.prototype.destroy=function(){this.mouseUpWrapper_&&(Blockly.unbindEvent_(this.mouseUpWrapper_),this.mouseUpWrapper_=null);this.sourceBlock_=null;this.group_.parentNode.removeChild(this.group_);this.borderRect_=this.textElement_=this.group_=null};Blockly.Field.prototype.setVisible=function(a){this.getRootElement().style.display=a?"block":"none"};Blockly.Field.prototype.getRootElement=function(){return this.group_};Blockly.Field.textLengthCache={};
Blockly.Field.prototype.render_=function(){if(Blockly.Field.textLengthCache.hasOwnProperty(this.text_))var a=Blockly.Field.textLengthCache[this.text_];else a=this.textElement_.getComputedTextLength(),Blockly.Field.textLengthCache[this.text_]=a;this.borderRect_&&this.borderRect_.setAttribute("width",a+Blockly.BlockSvg.SEP_SPACE_X);this.size_.width=a};Blockly.Field.prototype.getSize=function(){this.size_.width||this.render_();return this.size_};Blockly.Field.prototype.getText=function(){return this.text_};
Blockly.Field.prototype.setText=function(a){this.text_=a;Blockly.removeChildren_(this.textElement_);a=a.replace(/\s/g,Blockly.Field.NBSP);a||(a=Blockly.Field.NBSP);a=Blockly.svgDoc.createTextNode(a);this.textElement_.appendChild(a);this.size_.width=0;this.sourceBlock_&&this.sourceBlock_.rendered&&(this.sourceBlock_.render(),this.sourceBlock_.bumpNeighbours_(),this.sourceBlock_.workspace.fireChangeEvent())};Blockly.Field.prototype.getValue=function(){return this.getText()};
Blockly.Field.prototype.setValue=function(a){this.setText(a)};Blockly.Field.prototype.onMouseUp_=function(a){Blockly.isRightButton(a)||2!=Blockly.Block.dragMode_&&this.showEditor_()};Blockly.Field.prototype.setTooltip=function(){};Blockly.FieldDropdown=function(a,b){this.menuGenerator_=a;this.changeHandler_=b;var c=this.getOptions_()[0][0];Blockly.Field.call(this,c)};Blockly.FieldDropdown.prototype=new Blockly.Field(null);Blockly.FieldDropdown.constructor=Blockly.FieldDropdown;
Blockly.FieldDropdown.createDom=function(){var a=Blockly.createSvgElement("g",{"class":"blocklyHidden"},null);Blockly.FieldDropdown.svgGroup_=a;Blockly.FieldDropdown.svgShadow_=Blockly.createSvgElement("rect",{"class":"blocklyDropdownMenuShadow",x:0,y:1,rx:2,ry:2},a);Blockly.FieldDropdown.svgBackground_=Blockly.createSvgElement("rect",{x:-2,y:-1,rx:2,ry:2,filter:"url(#blocklyEmboss)"},a);Blockly.FieldDropdown.svgOptions_=Blockly.createSvgElement("g",{"class":"blocklyDropdownMenuOptions"},a);return a};
Blockly.FieldDropdown.prototype.destroy=function(){Blockly.FieldDropdown.openDropdown_==this&&Blockly.FieldDropdown.hideMenu();Blockly.Field.prototype.destroy.call(this)};Blockly.FieldDropdown.CORNER_RADIUS=2;Blockly.FieldDropdown.prototype.CURSOR="default";Blockly.FieldDropdown.openDropdown_=null;
Blockly.FieldDropdown.prototype.showEditor_=function(){function a(a){return function(b){this.changeHandler_?this.changeHandler_(a):this.setText(a);b.stopPropagation()}}var b=Blockly.FieldDropdown.svgGroup_,c=Blockly.FieldDropdown.svgOptions_,d=Blockly.FieldDropdown.svgBackground_,e=Blockly.FieldDropdown.svgShadow_;Blockly.removeChildren_(c);b.style.display="block";Blockly.FieldDropdown.openDropdown_=this;for(var f=0,h=[],g=null,i=this.getOptions_(),k=0;k<i.length;k++){var j=i[k][0],l=Blockly.ContextMenu.optionToDom(j),
n=l.firstChild,p=l.lastChild;c.appendChild(l);!g&&j==this.text_&&(g=Blockly.createSvgElement("text",{"class":"blocklyMenuText",y:15},null),l.insertBefore(g,p),g.appendChild(Blockly.svgDoc.createTextNode("\u2713")));l.setAttribute("transform","translate(0, "+k*Blockly.ContextMenu.Y_HEIGHT+")");h.push(n);Blockly.bindEvent_(l,"mousedown",null,Blockly.noEvent);Blockly.bindEvent_(l,"mouseup",this,a(j));Blockly.bindEvent_(l,"mouseup",null,Blockly.FieldDropdown.hideMenu);f=Math.max(f,p.getComputedTextLength())}f+=
2*Blockly.ContextMenu.X_PADDING;for(k=0;k<h.length;k++)h[k].setAttribute("width",f);if(Blockly.RTL)for(k=0;l=c.childNodes[k];k++)p=l.lastChild,p.setAttribute("text-anchor","end"),p.setAttribute("x",f-Blockly.ContextMenu.X_PADDING);g&&(Blockly.RTL?(g.setAttribute("text-anchor","end"),g.setAttribute("x",f-5)):g.setAttribute("x",5));k=f+2*Blockly.FieldDropdown.CORNER_RADIUS;i=i.length*Blockly.ContextMenu.Y_HEIGHT+Blockly.FieldDropdown.CORNER_RADIUS+1;e.setAttribute("width",k);e.setAttribute("height",
i);d.setAttribute("width",k);d.setAttribute("height",i);e=Blockly.makeColour(this.sourceBlock_.getColour());d.setAttribute("fill",e);d=Blockly.getAbsoluteXY_(this.borderRect_);e=this.borderRect_.getBBox();k=Blockly.RTL?d.x-f+Blockly.ContextMenu.X_PADDING+e.width-Blockly.BlockSvg.SEP_SPACE_X/2:d.x-Blockly.ContextMenu.X_PADDING+Blockly.BlockSvg.SEP_SPACE_X/2;b.setAttribute("transform","translate("+k+", "+(d.y+e.height)+")")};
Blockly.FieldDropdown.prototype.getOptions_=function(){return"function"==typeof this.menuGenerator_?this.menuGenerator_.call(this):this.menuGenerator_};Blockly.FieldDropdown.prototype.getValue=function(){for(var a=this.text_,b=this.getOptions_(),c=0;c<b.length;c++)if(b[c][0]==a)return b[c][1];throw'"'+a+'" not valid in dropdown.';};Blockly.FieldDropdown.prototype.setValue=function(a){for(var b=this.getOptions_(),c=0;c<b.length;c++)if(b[c][1]==a){this.setText(b[c][0]);return}this.setText(a)};
Blockly.FieldDropdown.hideMenu=function(){Blockly.FieldDropdown.svgGroup_.style.display="none";Blockly.FieldDropdown.openDropdown_=null};Blockly.FieldImage=function(a,b,c){this.sourceBlock_=null;c=Number(c);b=Number(b);this.size_={height:c+10,width:b};var d=6-Blockly.BlockSvg.TITLE_HEIGHT;this.group_=Blockly.createSvgElement("g",{},null);this.imageElement_=Blockly.createSvgElement("image",{height:c+"px",width:b+"px",y:d},this.group_);this.setText(a);-1!=window.navigator.userAgent.indexOf("Gecko/")&&(this.rectElement_=Blockly.createSvgElement("rect",{height:c+"px",width:b+"px",y:d,"fill-opacity":0},this.group_))};
Blockly.FieldImage.prototype=new Blockly.Field(null);Blockly.FieldImage.constructor=Blockly.FieldImage;Blockly.FieldImage.prototype.rectElement_=null;Blockly.FieldImage.prototype.EDITABLE=!1;Blockly.FieldImage.prototype.init=function(a){if(this.sourceBlock_)throw"Image has already been initialized once.";this.sourceBlock_=a;a.getSvgRoot().appendChild(this.group_);a=this.rectElement_||this.imageElement_;a.tooltip=this.sourceBlock_;Blockly.Tooltip&&Blockly.Tooltip.bindMouseEvents(a)};
Blockly.FieldImage.prototype.destroy=function(){this.group_.parentNode.removeChild(this.group_);this.rectElement_=this.imageElement_=this.group_=null};Blockly.FieldImage.prototype.setTooltip=function(a){topElement_.tooltip=a};Blockly.FieldImage.prototype.getText=function(){return this.src_};Blockly.FieldImage.prototype.setText=function(a){this.src_=a;this.imageElement_.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a)};Blockly.FieldLabel=function(a){this.sourceBlock_=null;this.textElement_=Blockly.createSvgElement("text",{"class":"blocklyText"},null);this.size_={height:25,width:0};this.setText(a)};Blockly.FieldLabel.prototype=new Blockly.Field(null);Blockly.FieldLabel.constructor=Blockly.FieldLabel;Blockly.FieldLabel.prototype.EDITABLE=!1;
Blockly.FieldLabel.prototype.init=function(a){if(this.sourceBlock_)throw"Text has already been initialized once.";this.sourceBlock_=a;a.getSvgRoot().appendChild(this.textElement_);this.textElement_.tooltip=this.sourceBlock_;Blockly.Tooltip&&Blockly.Tooltip.bindMouseEvents(this.textElement_)};Blockly.FieldLabel.prototype.destroy=function(){this.textElement_.parentNode.removeChild(this.textElement_);this.textElement_=null};Blockly.FieldLabel.prototype.getRootElement=function(){return this.textElement_};
Blockly.FieldLabel.prototype.setTooltip=function(a){this.textElement_.tooltip=a};Blockly.FieldTextInput=function(a,b){Blockly.Field.call(this,a);this.validationFunc_=b};Blockly.FieldTextInput.prototype=new Blockly.Field(null);Blockly.FieldTextInput.constructor=Blockly.FieldTextInput;Blockly.FieldTextInput.prototype.setText=function(a){if(this.validationFunc_){var b=this.validationFunc_(a);null!==b&&(a=b)}Blockly.Field.prototype.setText.call(this,a)};
Blockly.FieldTextInput.injectDom_=function(a){a=Blockly.createSvgElement("foreignObject",{height:22},a);Blockly.FieldTextInput.svgForeignObject_=a;var b=Blockly.svgDoc.createElement("body");b.className="blocklyMinimalBody";var c=Blockly.svgDoc.createElement("input");c.className="blocklyHtmlInput";c.style.border="none";c.style.outline="none";Blockly.FieldTextInput.htmlInput_=c;b.appendChild(c);a.appendChild(b)};
Blockly.FieldTextInput.destroyDom_=function(){var a=Blockly.FieldTextInput.svgForeignObject_;a.parentNode.removeChild(a);Blockly.FieldTextInput.svgForeignObject_=null;Blockly.FieldTextInput.htmlInput_=null};Blockly.FieldTextInput.prototype.CURSOR="text";
Blockly.FieldTextInput.prototype.showEditor_=function(){if(window.opera){var a=window.prompt(Blockly.MSG_CHANGE_VALUE_TITLE,this.text_);this.validationFunc_&&(a=this.validationFunc_(a));null!==a&&this.setText(a)}else{a=this.sourceBlock_.workspace.getCanvas();Blockly.FieldTextInput.injectDom_(a);var b=Blockly.FieldTextInput.htmlInput_;b.value=b.defaultValue=this.text_;b.oldValue_=null;var c=Blockly.FieldTextInput.svgForeignObject_,d=Blockly.getAbsoluteXY_(this.borderRect_),e=Blockly.getAbsoluteXY_(a);
d.x-=e.x;d.y-=e.y;Blockly.RTL||c.setAttribute("x",d.x+1);-1!=window.navigator.userAgent.indexOf("Gecko/")?c.setAttribute("y",d.y-1):c.setAttribute("y",d.y-3);b.focus();b.select();b.onBlurWrapper_=Blockly.bindEvent_(b,"blur",this,this.onHtmlInputBlur_);b.onKeyUpWrapper_=Blockly.bindEvent_(b,"keyup",this,this.onHtmlInputChange_);b.onKeyPressWrapper_=Blockly.bindEvent_(b,"keypress",this,this.onHtmlInputChange_);b.onWorkspaceChangeWrapper_=Blockly.bindEvent_(a,"blocklyWorkspaceChange",this,this.resizeEditor_);
this.validate_();this.resizeEditor_()}};Blockly.FieldTextInput.prototype.onHtmlInputBlur_=function(){this.closeEditor_(!0)};Blockly.FieldTextInput.prototype.onHtmlInputChange_=function(a){if(13==a.keyCode)this.closeEditor_(!0);else if(27==a.keyCode)this.closeEditor_(!1);else{var a=Blockly.FieldTextInput.htmlInput_,b=a.value;b!==a.oldValue_&&(a.oldValue_=b,this.setText(b),this.validate_())}};
Blockly.FieldTextInput.prototype.validate_=function(){var a=!0,b=Blockly.FieldTextInput.htmlInput_;this.validationFunc_&&(a=this.validationFunc_(b.value));a?Blockly.removeClass_(b,"blocklyInvalidInput"):Blockly.addClass_(b,"blocklyInvalidInput")};
Blockly.FieldTextInput.prototype.resizeEditor_=function(){var a=Blockly.FieldTextInput.htmlInput_,b=this.group_.getBBox(),c=Blockly.FieldTextInput.svgForeignObject_;c.setAttribute("width",b.width);a.style.width=b.width-2+"px";a=Blockly.getAbsoluteXY_(this.group_);b=this.sourceBlock_.workspace.getCanvas();b=Blockly.getAbsoluteXY_(b);a.x-=b.x;c.setAttribute("x",a.x-4)};
Blockly.FieldTextInput.prototype.closeEditor_=function(a){var b=Blockly.FieldTextInput.htmlInput_;Blockly.unbindEvent_(b.onBlurWrapper_);Blockly.unbindEvent_(b.onKeyUpWrapper_);Blockly.unbindEvent_(b.onKeyPressWrapper_);Blockly.unbindEvent_(b.onWorkspaceChangeWrapper_);a?(a=b.value,this.validationFunc_&&(a=this.validationFunc_(a),null===a&&(a=b.defaultValue))):a=b.defaultValue;this.setText(a);Blockly.FieldTextInput.destroyDom_();this.sourceBlock_.render()};Blockly.FieldVariable=function(a){Blockly.FieldDropdown.call(this,Blockly.FieldVariable.dropdownCreate,Blockly.FieldVariable.dropdownChange);a?this.setText(a):this.setText(Blockly.Variables.generateUniqueName())};Blockly.FieldVariable.prototype=new Blockly.FieldDropdown([[null]]);Blockly.FieldVariable.constructor=Blockly.FieldVariable;Blockly.FieldVariable.prototype.getValue=function(){return this.getText()};Blockly.FieldVariable.prototype.setValue=function(a){this.setText(a)};
Blockly.FieldVariable.dropdownCreate=function(){var a=Blockly.Variables.allVariables(),b=this.getText();b&&-1==a.indexOf(b)&&a.push(b);a.sort(Blockly.caseInsensitiveComparator);a.push(Blockly.MSG_RENAME_VARIABLE);a.push(Blockly.MSG_NEW_VARIABLE);for(var b=[],c=0;c<a.length;c++)b[c]=[a[c],a[c]];return b};
Blockly.FieldVariable.dropdownChange=function(a){function b(a,b){Blockly.hideChaff();var c=window.prompt(a,b);return c&&c.replace(/[\s\xa0]+/g," ").replace(/^ | $/g,"")}if(a==Blockly.MSG_RENAME_VARIABLE){var c=this.getText();(a=b(Blockly.MSG_RENAME_VARIABLE_TITLE.replace("%1",c),c))&&Blockly.Variables.renameVariable(c,a)}else a==Blockly.MSG_NEW_VARIABLE&&(a=b(Blockly.MSG_NEW_VARIABLE_TITLE,""),Blockly.Variables.renameVariable(a,a)),a&&this.setText(a);window.setTimeout(Blockly.Variables.refreshFlyoutCategory,
1)};Blockly.Flyout=function(){this.workspace_=new Blockly.Workspace(!1)};Blockly.Flyout.prototype.autoClose=!0;Blockly.Flyout.prototype.CORNER_RADIUS=8;Blockly.Flyout.prototype.onResizeWrapper_=null;
Blockly.Flyout.prototype.createDom=function(){this.svgGroup_=Blockly.createSvgElement("g",{},null);this.svgBackground_=Blockly.createSvgElement("path",{"class":"blocklyFlyoutBackground"},this.svgGroup_);this.svgOptions_=Blockly.createSvgElement("g",{},this.svgGroup_);this.svgOptions_.appendChild(this.workspace_.createDom());return this.svgGroup_};
Blockly.Flyout.prototype.destroy=function(){this.onResizeWrapper_&&(Blockly.unbindEvent_(this.onResizeWrapper_),this.onResizeWrapper_=null);this.scrollbar_&&(this.scrollbar_.destroy(),this.scrollbar_=null);this.workspace_=null;this.svgGroup_&&(this.svgGroup_.parentNode.removeChild(this.svgGroup_),this.svgGroup_=null);this.buttons_=this.targetWorkspaceMetrics_=this.targetWorkspace_=this.svgOptions_=this.svgBackground_=null};
Blockly.Flyout.prototype.getMetrics=function(){if(!this.isVisible())return null;var a=this.height_-2*this.CORNER_RADIUS,b=this.width_;try{var c=this.svgOptions_.getBBox()}catch(d){c={height:0,y:0}}return{viewHeight:a,viewWidth:b,contentHeight:c.height+c.y,viewTop:-this.svgOptions_.scrollY,contentTop:0,absoluteTop:this.CORNER_RADIUS,absoluteLeft:0}};
Blockly.Flyout.prototype.setMetrics=function(a){var b=this.getMetrics();"number"==typeof a.y&&(this.svgOptions_.scrollY=-b.contentHeight*a.y-b.contentTop);this.svgOptions_.setAttribute("transform","translate(0,"+(this.svgOptions_.scrollY+b.absoluteTop)+")")};
Blockly.Flyout.prototype.init=function(a,b,c){this.targetWorkspace_=a;this.targetWorkspaceMetrics_=b;this.height_=this.width_=0;var d=this;c&&(this.scrollbar_=new Blockly.Scrollbar(this.svgOptions_,function(){return d.getMetrics()},function(a){return d.setMetrics(a)},!1,!1));this.buttons_=[];this.position_();this.hide();this.onResizeWrapper_=Blockly.bindEvent_(window,"resize",this,this.position_)};
Blockly.Flyout.prototype.position_=function(){var a=this.targetWorkspaceMetrics_();if(a){var b=this.width_-this.CORNER_RADIUS;Blockly.RTL&&(b*=-1);var c=["M "+(Blockly.RTL?this.width_:0)+",0"];c.push("h",b);c.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,Blockly.RTL?0:1,Blockly.RTL?-this.CORNER_RADIUS:this.CORNER_RADIUS,this.CORNER_RADIUS);c.push("v",Math.max(0,a.viewHeight-2*this.CORNER_RADIUS));c.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,Blockly.RTL?0:1,Blockly.RTL?this.CORNER_RADIUS:
-this.CORNER_RADIUS,this.CORNER_RADIUS);c.push("h",-b);c.push("z");this.svgBackground_.setAttribute("d",c.join(" "));b=a.absoluteLeft;Blockly.RTL&&(b-=this.width_);this.svgGroup_.setAttribute("transform","translate("+b+","+a.absoluteTop+")");this.height_=a.viewHeight}};Blockly.Flyout.prototype.isVisible=function(){return"none"!=this.svgGroup_.style.display};
Blockly.Flyout.prototype.hide=function(){this.svgGroup_.style.display="none";for(var a=this.workspace_.getTopBlocks(!1),b=0,c;c=a[b];b++)c.destroy(!1,!1);for(b=0;a=this.buttons_[b];b++)Blockly.unbindEvent_(a.wrapper_),a.parentNode.removeChild(a);this.buttons_=[]};
Blockly.Flyout.prototype.show=function(a){var b=this.CORNER_RADIUS;this.svgGroup_.style.display="block";var c=[],d=[];if(a==Blockly.MSG_VARIABLE_CATEGORY)Blockly.Variables.flyoutCategory(c,d,b,this.workspace_);else if(a==Blockly.MSG_PROCEDURE_CATEGORY)Blockly.Procedures.flyoutCategory(c,d,b,this.workspace_);else for(var e=0,f;f=a[e];e++)f=new Blockly.Block(this.workspace_,f),f.initSvg(),c[e]=f,d[e]=2*b;for(var a=0,h=b,e=0;f=c[e];e++){f.isInFlyout=!0;Blockly.Comment&&f.setCommentText(null);f.render();
var g=f.getSvgRoot().getBBox();f.moveBy(Blockly.RTL?0:b+Blockly.BlockSvg.TAB_WIDTH,h);a=Math.max(a,g.width);h+=g.height+d[e];Blockly.bindEvent_(f.getSvgRoot(),"mousedown",null,Blockly.Flyout.createBlockFunc_(this,f))}a+=b+Blockly.BlockSvg.TAB_WIDTH+b/2+Blockly.Scrollbar.scrollbarThickness;for(e=0;f=c[e];e++)Blockly.RTL&&f.moveBy(a-b-Blockly.BlockSvg.TAB_WIDTH,0),g=f.getSvgRoot().getBBox(),d=f.getRelativeToSurfaceXY(),d=Blockly.createSvgElement("rect",{width:g.width,height:g.height,x:d.x+g.x,y:d.y+
g.y,"fill-opacity":0},null),this.svgOptions_.insertBefore(d,this.svgOptions_.firstChild),d.wrapper_=Blockly.bindEvent_(d,"mousedown",null,Blockly.Flyout.createBlockFunc_(this,f)),this.buttons_[e]=d;this.width_=a;Blockly.fireUiEvent(window,"resize")};
Blockly.Flyout.createBlockFunc_=function(a,b){return function(c){if(!Blockly.isRightButton(c)){var d=Blockly.Xml.blockToDom_(b),d=Blockly.Xml.domToBlock_(a.targetWorkspace_,d),e=Blockly.getAbsoluteXY_(b.getSvgRoot()),f=Blockly.getAbsoluteXY_(a.targetWorkspace_.getCanvas());d.moveBy(e.x-f.x,e.y-f.y);d.render();a.autoClose&&a.hide();d.onMouseDown_(c)}}};Blockly.Generator={};Blockly.Generator.NAME_TYPE="generated_function";Blockly.Generator.languages={};Blockly.Generator.get=function(a){if(!(a in Blockly.Generator.languages)){var b=new Blockly.CodeGenerator;Blockly.Generator.languages[a]=b}return Blockly.Generator.languages[a]};
Blockly.Generator.workspaceToCode=function(a){var b=[],a=Blockly.Generator.get(a);a.init();for(var c=Blockly.mainWorkspace.getTopBlocks(!0),d=0,e;e=c[d];d++){var f=a.blockToCode(e,!0);f instanceof Array&&(f=f[0]);f&&(e.outputConnection&&a.scrubNakedValue&&(f=a.scrubNakedValue(f)),b.push(f))}b=b.join("\n");b=a.finish(b);b=b.replace(/^\s+\n/,"");b=b.replace(/\n\s+$/,"\n");return b=b.replace(/[ \t]+\n/g,"\n")};Blockly.Generator.prefixLines=function(a,b){return b+a.replace(/\n(.)/g,"\n"+b+"$1")};
Blockly.Generator.allNestedComments=function(a){for(var b=[],a=a.getDescendants(),c=0;c<a.length;c++){var d=a[c].getCommentText();d&&b.push(d)}b.length&&b.push("");return b.join("\n")};Blockly.CodeGenerator=function(){};Blockly.CodeGenerator.prototype.blockToCode=function(a){if(!a||a.disabled)return"";var b=this[a.type];if(!b)throw'Language "'+name+'" does not know how to generate code for block type "'+a.type+'".';b=b.call(a);return b instanceof Array?[this.scrub_(a,b[0]),b[1]]:this.scrub_(a,b)};
Blockly.CodeGenerator.prototype.valueToCode=function(a,b,c){b=a.getInputTargetBlock(b);if(!b)return"";a=this.blockToCode(b);if(""===a)return"";if(!(a instanceof Array))throw'Expecting tuple from value block "'+b.type+'".';b=a[0];a=a[1];b&&c<=a&&(b="("+b+")");return b};
Blockly.CodeGenerator.prototype.statementToCode=function(a,b){var c=a.getInputTargetBlock(b),d=this.blockToCode(c);if("string"!=typeof d)throw'Expecting code from statement block "'+c.type+'".';d&&(d=Blockly.Generator.prefixLines(d,"  "));return d};Blockly.inject=function(a,b){b&&Blockly.parseOptions_(b);Blockly.createDom_(a);Blockly.init_()};Blockly.parseOptions_=function(a){Blockly.RTL=!!a.rtl;Blockly.editable=!a.readOnly;Blockly.pathToBlockly=a.path||"./"};
Blockly.createDom_=function(a){for(var b=a;b.parentNode;)b=b.parentNode;Blockly.svgDoc=b;var c=b.createElement("link");c.setAttribute("href",Blockly.pathToBlockly+"media/blockly.css");c.setAttribute("rel","stylesheet");c.setAttribute("type","text/css");c.setAttribute("onload","Blockly.cssLoaded()");b=b.head||b.getElementsByTagName("head")[0];if(!b)throw"No head in document.";b.appendChild(c);var c=Blockly.createSvgElement("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:html":"http://www.w3.org/1999/xhtml",
"xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1","class":"blocklySvg"},null),b=Blockly.createSvgElement("defs",{},c),d,e;d=Blockly.createSvgElement("filter",{id:"blocklyEmboss"},b);Blockly.createSvgElement("feGaussianBlur",{"in":"SourceAlpha",stdDeviation:1,result:"blur"},d);e=Blockly.createSvgElement("feSpecularLighting",{"in":"blur",surfaceScale:1,specularConstant:0.5,specularExponent:10,"lighting-color":"white",result:"specOut"},d);Blockly.createSvgElement("fePointLight",{x:-5E3,y:-1E4,
z:2E4},e);Blockly.createSvgElement("feComposite",{"in":"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"},d);Blockly.createSvgElement("feComposite",{"in":"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:0,k2:1,k3:1,k4:0},d);d=Blockly.createSvgElement("filter",{id:"blocklyTrashcanShadowFilter"},b);Blockly.createSvgElement("feGaussianBlur",{"in":"SourceAlpha",stdDeviation:2,result:"blur"},d);Blockly.createSvgElement("feOffset",{"in":"blur",dx:1,dy:1,result:"offsetBlur"},d);d=Blockly.createSvgElement("feMerge",
{},d);Blockly.createSvgElement("feMergeNode",{"in":"offsetBlur"},d);Blockly.createSvgElement("feMergeNode",{"in":"SourceGraphic"},d);d=Blockly.createSvgElement("filter",{id:"blocklyShadowFilter"},b);Blockly.createSvgElement("feGaussianBlur",{stdDeviation:2},d);b=Blockly.createSvgElement("pattern",{id:"blocklyDisabledPattern",patternUnits:"userSpaceOnUse",width:10,height:10},b);Blockly.createSvgElement("rect",{width:10,height:10,fill:"#aaa"},b);Blockly.createSvgElement("path",{d:"M 0 0 L 10 10 M 10 0 L 0 10",
stroke:"#cc0"},b);Blockly.mainWorkspace=new Blockly.Workspace(Blockly.editable);c.appendChild(Blockly.mainWorkspace.createDom());Blockly.Toolbox&&Blockly.editable&&c.appendChild(Blockly.Toolbox.createDom());Blockly.Tooltip&&c.appendChild(Blockly.Tooltip.createDom());Blockly.editable&&c.appendChild(Blockly.FieldDropdown.createDom());Blockly.ContextMenu&&c.appendChild(Blockly.ContextMenu.createDom());a.appendChild(c);Blockly.svg=c;Blockly.svgResize()};
Blockly.init_=function(){var a=Blockly.svgDoc;Blockly.bindEvent_(window,"resize",a,Blockly.svgResize);Blockly.bindEvent_(Blockly.svg,"mousedown",null,Blockly.onMouseDown_);Blockly.bindEvent_(a,"mouseup",null,Blockly.onMouseUp_);Blockly.bindEvent_(Blockly.svg,"mousemove",null,Blockly.onMouseMove_);Blockly.bindEvent_(Blockly.svg,"contextmenu",null,Blockly.onContextMenu_);Blockly.bindEvent_(a,"keydown",null,Blockly.onKeyDown_);Blockly.editable&&Blockly.Toolbox&&Blockly.Toolbox.init();Blockly.mainWorkspace.addTrashcan(Blockly.getMainWorkspaceMetrics);
Blockly.mainWorkspace.scrollbar=new Blockly.ScrollbarPair(Blockly.mainWorkspace.getBubbleCanvas(),Blockly.getMainWorkspaceMetrics,Blockly.setMainWorkspaceMetrics);Blockly.loadAudio_("click");Blockly.loadAudio_("delete")};Blockly.Input=function(a,b,c,d){this.type=a;this.name=b;this.sourceBlock_=c;this.connection=d;this.titleRow=[];this.align=Blockly.ALIGN_LEFT};Blockly.Input.prototype.appendTitle=function(a,b){"string"==typeof a&&(a=new Blockly.FieldLabel(a));this.sourceBlock_.svg_&&a.init(this.sourceBlock_);a.name=b;this.titleRow.push(a);this.sourceBlock_.rendered&&(this.sourceBlock_.render(),this.sourceBlock_.bumpNeighbours_());return this};
Blockly.Input.prototype.setCheck=function(a){if(!this.connection)throw"This input does not have a connection.";this.connection.setCheck(a);return this};Blockly.Input.prototype.setAlign=function(a){this.align=a;this.sourceBlock_.rendered&&this.sourceBlock_.render();return this};Blockly.Input.prototype.init=function(){for(var a=0;a<this.titleRow.length;a++)this.titleRow[a].init(this.sourceBlock_)};
Blockly.Input.prototype.destroy=function(){for(var a=0,b;b=this.titleRow[a];a++)b.destroy();this.connection&&this.connection.destroy();this.sourceBlock_=null};Blockly.Mutator=function(a){this.block_=null;this.quarkNames_=a};Blockly.Mutator.ICON_SIZE=16;Blockly.Mutator.prototype.bubble_=null;Blockly.Mutator.prototype.iconX_=null;Blockly.Mutator.prototype.iconY_=null;Blockly.Mutator.prototype.workspaceWidth_=0;Blockly.Mutator.prototype.workspaceHeight_=0;
Blockly.Mutator.prototype.createIcon=function(){var a=Blockly.Mutator.ICON_SIZE/8;this.iconGroup_=Blockly.createSvgElement("g",{},null);this.block_.editable&&this.iconGroup_.setAttribute("class","blocklyIconGroup");Blockly.createSvgElement("rect",{"class":"blocklyIconShield",width:8*a,height:8*a,rx:2*a,ry:2*a},this.iconGroup_);if(!Blockly.Mutator.crossPath_){var b=[];b.push("M",3.5*a+","+3.5*a);b.push("v",-2*a,"h",a);b.push("v",2*a,"h",2*a);b.push("v",a,"h",-2*a);b.push("v",2*a,"h",-a);b.push("v",
-2*a,"h",-2*a);b.push("v",-a,"z");Blockly.Mutator.crossPath_=b.join(" ")}this.iconMark_=Blockly.createSvgElement("path",{"class":"blocklyIconMark",d:Blockly.Mutator.crossPath_},this.iconGroup_);this.block_.getSvgRoot().appendChild(this.iconGroup_);this.block_.editable&&Blockly.bindEvent_(this.iconGroup_,"mouseup",this,this.iconClick_)};
Blockly.Mutator.prototype.createEditor_=function(){this.svgDialog_=Blockly.createSvgElement("svg",{x:Blockly.Bubble.BORDER_WIDTH,y:Blockly.Bubble.BORDER_WIDTH},null);this.svgBackground_=Blockly.createSvgElement("rect",{"class":"blocklyMutatorBackground",height:"100%",width:"100%"},this.svgDialog_);this.workspace_=new Blockly.Workspace(!0);this.flyout_=new Blockly.Flyout;this.flyout_.autoClose=!1;this.svgDialog_.appendChild(this.flyout_.createDom());this.svgDialog_.appendChild(this.workspace_.createDom());
return this.svgDialog_};
Blockly.Mutator.prototype.resizeBubble_=function(){var a=2*Blockly.Bubble.BORDER_WIDTH,b=this.workspace_.getCanvas().getBBox(),c=this.flyout_.getMetrics(),d;d=Blockly.RTL?-b.x:b.width+b.x;b=Math.max(b.height+3*a,c.contentHeight+20);d+=3*a;if(Math.abs(this.workspaceWidth_-d)>a||Math.abs(this.workspaceHeight_-b)>a)this.workspaceWidth_=d,this.workspaceHeight_=b,this.bubble_.setBubbleSize(d+a,b+a),this.svgDialog_.setAttribute("width",this.workspaceWidth_),this.svgDialog_.setAttribute("height",this.workspaceHeight_);
Blockly.RTL&&(a="translate("+this.workspaceWidth_+",0)",this.workspace_.getCanvas().setAttribute("transform",a))};Blockly.Mutator.prototype.isVisible=function(){return!!this.bubble_};
Blockly.Mutator.prototype.setVisible=function(a){if(a!=this.isVisible())if(a){this.bubble_=new Blockly.Bubble(this.block_.workspace,this.createEditor_(),this.block_.svg_.svgGroup_,this.iconX_,this.iconY_,null,null);var b=this;this.flyout_.init(this.workspace_,function(){return b.getFlyoutMetrics_()},!1);this.flyout_.show(this.quarkNames_);this.rootBlock_=this.block_.decompose(this.workspace_);for(var a=this.rootBlock_.getDescendants(),c=0,d;d=a[c];c++)d.render();this.rootBlock_.editable=!1;a=2*this.flyout_.CORNER_RADIUS;
c=this.flyout_.width_+a;Blockly.RTL&&(c=-c);this.rootBlock_.moveBy(c,a);this.block_.saveConnections&&(this.block_.saveConnections(this.rootBlock_),this.sourceListener_=Blockly.bindEvent_(this.block_.workspace.getCanvas(),"blocklyWorkspaceChange",this.block_,function(){b.block_.saveConnections(b.rootBlock_)}));this.resizeBubble_();Blockly.bindEvent_(this.workspace_.getCanvas(),"blocklyWorkspaceChange",this.block_,function(){b.workspaceChanged_()});this.updateColour()}else this.svgBackground_=this.svgDialog_=
null,this.flyout_.destroy(),this.flyout_=null,this.workspace_.destroy(),this.rootBlock_=this.workspace_=null,this.bubble_.destroy(),this.bubble_=null,this.workspaceHeight_=this.workspaceWidth_=0,this.sourceListener_&&(Blockly.unbindEvent_(this.sourceListener_),this.sourceListener_=null)};
Blockly.Mutator.prototype.workspaceChanged_=function(){if(0==Blockly.Block.dragMode_)for(var a=this.workspace_.getTopBlocks(!1),b=0,c;c=a[b];b++){var d=c.getRelativeToSurfaceXY();(0>d.y||(Blockly.RTL?d.x>-this.flyout_.width_:d.x<this.flyout_.width_))&&c.destroy(!1,!1)}this.rootBlock_.workspace==this.workspace_&&(a=this.block_.rendered,this.block_.rendered=!1,this.block_.compose(this.rootBlock_),this.block_.rendered=a,this.block_.rendered&&this.block_.render(),this.resizeBubble_(),this.block_.workspace.fireChangeEvent())};
Blockly.Mutator.prototype.getFlyoutMetrics_=function(){var a=0;Blockly.RTL&&(a+=this.workspaceWidth_);return{viewHeight:this.workspaceHeight_,absoluteTop:0,absoluteLeft:a}};Blockly.Mutator.prototype.iconClick_=function(){this.setVisible(!this.isVisible())};Blockly.Mutator.prototype.updateColour=function(){if(this.isVisible()){var a=Blockly.makeColour(this.block_.getColour());this.bubble_.setColour(a)}};
Blockly.Mutator.prototype.destroy=function(){this.iconGroup_.parentNode.removeChild(this.iconGroup_);this.iconGroup_=null;this.setVisible(!1);this.block_=this.block_.mutator=null};
Blockly.Mutator.prototype.renderIcon=function(a){if(this.block_.collapsed)return this.iconGroup_.setAttribute("display","none"),a;this.iconGroup_.setAttribute("display","block");Blockly.RTL&&(a-=Blockly.Mutator.ICON_SIZE);this.iconGroup_.setAttribute("transform","translate("+a+", 5)");this.computeIconLocation();return a=Blockly.RTL?a-Blockly.BlockSvg.SEP_SPACE_X:a+(Blockly.Mutator.ICON_SIZE+Blockly.BlockSvg.SEP_SPACE_X)};
Blockly.Mutator.prototype.setIconLocation=function(a,b){this.iconX_=a;this.iconY_=b;this.isVisible()&&this.bubble_.setAnchorLocation(a,b)};Blockly.Mutator.prototype.computeIconLocation=function(){var a=this.block_.getRelativeToSurfaceXY(),b=Blockly.getRelativeXY_(this.iconGroup_),c=a.x+b.x+Blockly.Mutator.ICON_SIZE/2,a=a.y+b.y+Blockly.Mutator.ICON_SIZE/2;(c!==this.iconX_||a!==this.iconY_)&&this.setIconLocation(c,a)};Blockly.Mutator.prototype.getIconLocation=function(){return{x:this.iconX_,y:this.iconY_}};Blockly.Names=function(a){this.reservedDict_={};if(a)for(var a=a.split(","),b=0;b<a.length;b++)this.reservedDict_[Blockly.Names.PREFIX_+a[b]]=!0;this.reset()};Blockly.Names.PREFIX_="v_";Blockly.Names.prototype.reset=function(){this.db_={};this.dbReverse_={}};Blockly.Names.prototype.getName=function(a,b){var c=Blockly.Names.PREFIX_+a.toLowerCase()+"X"+b;return c in this.db_?this.db_[c]:this.getDistinctName(a,b)};
Blockly.Names.prototype.getDistinctName=function(a,b){for(var c=this.safeName_(a),d="";this.dbReverse_[Blockly.Names.PREFIX_+c+d]||Blockly.Names.PREFIX_+c+d in this.reservedDict_;)d=d?d+1:2;c+=d;this.db_[Blockly.Names.PREFIX_+a.toLowerCase()+"X"+b]=c;this.dbReverse_[Blockly.Names.PREFIX_+c]=!0;return c};Blockly.Names.prototype.safeName_=function(a){a?(a=encodeURI(a.replace(/ /g,"_")).replace(/[^\w]/g,"_"),-1!="0123456789".indexOf(a.charAt(0))&&(a="my_"+a)):a="unnamed";return a};
Blockly.Names.equals=function(a,b){return a.toLowerCase()==b.toLowerCase()};Blockly.Procedures={};Blockly.Procedures.NAME_TYPE="procedure";Blockly.Procedures.allProcedures=function(){for(var a=Blockly.mainWorkspace.getAllBlocks(!1),b=[],c=[],d=0;d<a.length;d++){var e=a[d].getProcedureDef;e&&(e=e.call(a[d]))&&(e[2]?b.push(e):c.push(e))}c.sort(Blockly.Procedures.procTupleComparator_);b.sort(Blockly.Procedures.procTupleComparator_);return[c,b]};Blockly.Procedures.procTupleComparator_=function(a,b){var c=a[0].toLowerCase(),d=b[0].toLowerCase();return c>d?1:c<d?-1:0};
Blockly.Procedures.findLegalName=function(a,b){if(!b.workspace.editable)return a;for(;!Blockly.Procedures.isLegalName(a,b.workspace,b);)var c=a.match(/^(.*?)(\d+)$/),a=c?c[1]+(parseInt(c[2],10)+1):a+"2";return a};Blockly.Procedures.isLegalName=function(a,b,c){for(var b=b.getAllBlocks(!1),d=0;d<b.length;d++)if(b[d]!=c){var e=b[d].getProcedureDef;if(e&&(e=e.call(b[d]),Blockly.Names.equals(e[0],a)))return!1}return!0};
Blockly.Procedures.rename=function(a){if(!this.sourceBlock_.editable)return a;a=a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"");if(!a)return null;for(var a=Blockly.Procedures.findLegalName(a,this.sourceBlock_),b=this.sourceBlock_.workspace.getAllBlocks(!1),c=0;c<b.length;c++){var d=b[c].renameProcedure;d&&d.call(b[c],this.text_,a)}window.setTimeout(Blockly.Procedures.refreshFlyoutCategory,1);return a};
Blockly.Procedures.flyoutCategory=function(a,b,c,d){function e(e,f){for(var i=0;i<e.length;i++){var k=new Blockly.Block(d,f);k.setTitleValue(e[i][0],"NAME");for(var j=[],l=0;l<e[i][1].length;l++)j[l]="ARG"+l;k.setProcedureParameters(e[i][1],j);k.initSvg();a.push(k);b.push(2*c)}}if(Blockly.Language.procedures_defnoreturn){var f=new Blockly.Block(d,"procedures_defnoreturn");f.initSvg();a.push(f);b.push(2*c)}Blockly.Language.procedures_defreturn&&(f=new Blockly.Block(d,"procedures_defreturn"),f.initSvg(),
a.push(f),b.push(2*c));f=Blockly.Procedures.allProcedures();e(f[0],"procedures_callnoreturn");e(f[1],"procedures_callreturn")};Blockly.Procedures.refreshFlyoutCategory=function(){Blockly.Toolbox&&(Blockly.Toolbox.flyout_.isVisible()&&Blockly.Toolbox.selectedOption_.cat==Blockly.MSG_PROCEDURE_CATEGORY)&&(Blockly.Toolbox.flyout_.hide(),Blockly.Toolbox.flyout_.show(Blockly.MSG_PROCEDURE_CATEGORY))};
Blockly.Procedures.getCallers=function(a,b){for(var c=[],d=b.getAllBlocks(!1),e=0;e<d.length;e++){var f=d[e].getProcedureCall;f&&(f=f.call(d[e]))&&Blockly.Names.equals(f,a)&&c.push(d[e])}return c};Blockly.Procedures.destroyCallers=function(a,b){for(var c=Blockly.Procedures.getCallers(a,b),d=0;d<c.length;d++)c[d].destroy(!0,!1);window.setTimeout(Blockly.Procedures.refreshFlyoutCategory,1)};
Blockly.Procedures.mutateCallers=function(a,b,c,d){a=Blockly.Procedures.getCallers(a,b);for(b=0;b<a.length;b++)a[b].setProcedureParameters(c,d)};Blockly.Procedures.getDefinition=function(a,b){for(var c=b.getAllBlocks(!1),d=0;d<c.length;d++){var e=c[d].getProcedureDef;if(e&&(e=e.call(c[d]))&&Blockly.Names.equals(e[0],a))return c[d]}return null};Blockly.ScrollbarPair=function(a,b,c){this.element_=a;this.getMetrics_=b;this.setMetrics_=c;this.oldHostMetrics_={};this.hScroll=new Blockly.Scrollbar(a,b,c,!0,!0);this.vScroll=new Blockly.Scrollbar(a,b,c,!1,!0);this.corner_=this.addCorner_(a);this.resize();var d=this;this.onResizeWrapper_=Blockly.bindEvent_(window,"resize",d,function(){d.resize()})};
Blockly.ScrollbarPair.prototype.destroy=function(){Blockly.unbindEvent_(this.onResizeWrapper_);this.onResizeWrapper_=null;this.corner_.parentNode.removeChild(this.corner_);this.oldHostMetrics_=this.setMetrics_=this.getMetrics_=this.element_=this.corner_=null;this.hScroll.destroy();this.hScroll=null;this.vScroll.destroy();this.vScroll=null};
Blockly.ScrollbarPair.prototype.addCorner_=function(a){var b=Blockly.createSvgElement("rect",{height:Blockly.Scrollbar.scrollbarThickness,width:Blockly.Scrollbar.scrollbarThickness,style:"fill: #fff"},null);Blockly.Scrollbar.insertAfter_(b,a);return b};
Blockly.ScrollbarPair.prototype.resize=function(){var a=this.getMetrics_();if(a){var b=!1,c=!1;if(this.oldHostMetrics_.viewWidth!=a.viewWidth||this.oldHostMetrics_.viewHeight!=a.viewHeight||this.oldHostMetrics_.absoluteTop!=a.absoluteTop||this.oldHostMetrics_.absoluteLeft!=a.absoluteLeft)c=b=!0;else{if(this.oldHostMetrics_.contentWidth!=a.contentWidth||this.oldHostMetrics_.viewLeft!=a.viewLeft||this.oldHostMetrics_.contentLeft!=a.contentLeft)b=!0;if(this.oldHostMetrics_.contentHeight!=a.contentHeight||
this.oldHostMetrics_.viewTop!=a.viewTop||this.oldHostMetrics_.contentTop!=a.contentTop)c=!0}b&&this.hScroll.resize(a);c&&this.vScroll.resize(a);(this.oldHostMetrics_.viewWidth!=a.viewWidth||this.oldHostMetrics_.absoluteLeft!=a.absoluteLeft)&&this.corner_.setAttribute("x",this.vScroll.xCoordinate);(this.oldHostMetrics_.viewHeight!=a.viewHeight||this.oldHostMetrics_.absoluteTop!=a.absoluteTop)&&this.corner_.setAttribute("y",this.hScroll.yCoordinate);this.oldHostMetrics_=a}};
Blockly.ScrollbarPair.prototype.set=function(a,b){if(Blockly.Scrollbar===Blockly.ScrollbarNative){this.hScroll.set(a,!1);this.vScroll.set(b,!1);var c={};c.x=this.hScroll.outerDiv_.scrollLeft/this.hScroll.innerImg_.offsetWidth||0;c.y=this.vScroll.outerDiv_.scrollTop/this.vScroll.innerImg_.offsetHeight||0;this.setMetrics_(c)}else this.hScroll.set(a,!0),this.vScroll.set(b,!0)};
Blockly.ScrollbarNative=function(a,b,c,d,e){this.element_=a;this.getMetrics_=b;this.setMetrics_=c;this.pair_=e||!1;this.horizontal_=d;this.createDom_(a);if(null!==d){Blockly.ScrollbarNative.scrollbarThickness||Blockly.ScrollbarNative.measureScrollbarThickness_(a);d?(this.foreignObject_.setAttribute("height",Blockly.ScrollbarNative.scrollbarThickness),this.outerDiv_.style.height=Blockly.ScrollbarNative.scrollbarThickness+"px",this.outerDiv_.style.overflowX="scroll",this.outerDiv_.style.overflowY="hidden",
this.innerImg_.style.height="1px"):(this.foreignObject_.setAttribute("width",Blockly.ScrollbarNative.scrollbarThickness),this.outerDiv_.style.width=Blockly.ScrollbarNative.scrollbarThickness+"px",this.outerDiv_.style.overflowX="hidden",this.outerDiv_.style.overflowY="scroll",this.innerImg_.style.width="1px");var f=this;this.onScrollWrapper_=Blockly.bindEvent_(this.outerDiv_,"scroll",f,function(){f.onScroll_()});Blockly.bindEvent_(this.foreignObject_,"mousedown",null,Blockly.noEvent);this.pair_||(this.resize(),
this.onResizeWrapper_=Blockly.bindEvent_(window,"resize",f,function(){f.resize()}))}};Blockly.ScrollbarNative.prototype.destroy=function(){Blockly.unbindEvent_(this.onResizeWrapper_);this.onResizeWrapper_=null;Blockly.unbindEvent_(this.onScrollWrapper_);this.onScrollWrapper_=null;this.foreignObject_.parentNode.removeChild(this.foreignObject_);this.innerImg_=this.outerDiv_=this.setMetrics_=this.getMetrics_=this.element_=this.foreignObject_=null};
Blockly.ScrollbarNative.prototype.resize=function(a){if(!a&&(a=this.getMetrics_(),!a))return;if(this.horizontal_){var b=a.viewWidth;this.pair_?b-=Blockly.ScrollbarNative.scrollbarThickness:this.setVisible(b<a.contentHeight);this.ratio_=b/a.viewWidth;var c=this.ratio_*a.contentWidth,d=(a.viewLeft-a.contentLeft)*this.ratio_;this.outerDiv_.style.width=b+"px";this.innerImg_.style.width=c+"px";this.xCoordinate=a.absoluteLeft;this.pair_&&Blockly.RTL&&(this.xCoordinate+=Blockly.ScrollbarNative.scrollbarThickness);
this.yCoordinate=a.absoluteTop+a.viewHeight-Blockly.ScrollbarNative.scrollbarThickness;this.foreignObject_.setAttribute("x",this.xCoordinate);this.foreignObject_.setAttribute("y",this.yCoordinate);this.foreignObject_.setAttribute("width",Math.max(0,b));this.outerDiv_.scrollLeft=Math.round(d)}else b=a.viewHeight,this.pair_?b-=Blockly.ScrollbarNative.scrollbarThickness:this.setVisible(b<a.contentHeight),this.ratio_=b/a.viewHeight,c=this.ratio_*a.contentHeight,d=(a.viewTop-a.contentTop)*this.ratio_,
this.outerDiv_.style.height=b+"px",this.innerImg_.style.height=c+"px",this.xCoordinate=a.absoluteLeft,Blockly.RTL||(this.xCoordinate+=a.viewWidth-Blockly.ScrollbarNative.scrollbarThickness),this.yCoordinate=a.absoluteTop,this.foreignObject_.setAttribute("x",this.xCoordinate),this.foreignObject_.setAttribute("y",this.yCoordinate),this.foreignObject_.setAttribute("height",Math.max(0,b)),this.outerDiv_.scrollTop=Math.round(d)};
Blockly.ScrollbarNative.prototype.createDom_=function(a){this.foreignObject_=Blockly.createSvgElement("foreignObject",{},null);var b=Blockly.svgDoc.createElementNS(Blockly.HTML_NS,"body");b.setAttribute("xmlns",Blockly.HTML_NS);b.setAttribute("class","blocklyMinimalBody");var c=Blockly.svgDoc.createElementNS(Blockly.HTML_NS,"div");this.outerDiv_=c;var d=Blockly.svgDoc.createElementNS(Blockly.HTML_NS,"img");d.setAttribute("src",Blockly.pathToBlockly+"media/1x1.gif");this.innerImg_=d;c.appendChild(d);
b.appendChild(c);this.foreignObject_.appendChild(b);Blockly.Scrollbar.insertAfter_(this.foreignObject_,a)};Blockly.ScrollbarNative.prototype.isVisible=function(){return"none"!=this.foreignObject_.style.display};Blockly.ScrollbarNative.prototype.setVisible=function(a){if(a!=this.isVisible()){if(this.pair_)throw"Unable to toggle visibility of paired scrollbars.";a?(this.foreignObject_.style.display="block",this.getMetrics_()):(this.setMetrics_({x:0,y:0}),this.foreignObject_.style.display="none")}};
Blockly.ScrollbarNative.prototype.onScroll_=function(){var a={};this.horizontal_?a.x=this.outerDiv_.scrollLeft/this.innerImg_.offsetWidth||0:a.y=this.outerDiv_.scrollTop/this.innerImg_.offsetHeight||0;this.setMetrics_(a)};Blockly.ScrollbarNative.prototype.set=function(a,b){if(!b)var c=Blockly.unbindEvent_(this.onScrollWrapper_);this.horizontal_?this.outerDiv_.scrollLeft=a*this.ratio_:this.outerDiv_.scrollTop=a*this.ratio_;b||(this.onScrollWrapper_=Blockly.bindEvent_(this.outerDiv_,"scroll",this,c))};
Blockly.ScrollbarNative.scrollbarThickness=0;
Blockly.ScrollbarNative.measureScrollbarThickness_=function(a){var b=new Blockly.ScrollbarNative(a,null,null,null,!1);b.outerDiv_.style.width="100px";b.outerDiv_.style.height="100px";b.innerImg_.style.width="100%";b.innerImg_.style.height="200px";b.foreignObject_.setAttribute("width",1);b.foreignObject_.setAttribute("height",1);b.outerDiv_.style.overflowY="scroll";var c=b.innerImg_.offsetWidth;b.outerDiv_.style.overflowY="hidden";var d=b.innerImg_.offsetWidth;a.parentNode.removeChild(b.foreignObject_);
a=d-c;0>=a&&(a=15);Blockly.ScrollbarNative.scrollbarThickness=a};
Blockly.ScrollbarSvg=function(a,b,c,d,e){this.element_=a;this.getMetrics_=b;this.setMetrics_=c;this.pair_=e||!1;this.horizontal_=d;this.createDom_(a);d?(this.svgBackground_.setAttribute("height",Blockly.ScrollbarSvg.scrollbarThickness),this.svgKnob_.setAttribute("height",Blockly.ScrollbarSvg.scrollbarThickness-6),this.svgKnob_.setAttribute("y",3)):(this.svgBackground_.setAttribute("width",Blockly.ScrollbarSvg.scrollbarThickness),this.svgKnob_.setAttribute("width",Blockly.ScrollbarSvg.scrollbarThickness-
6),this.svgKnob_.setAttribute("x",3));var f=this;this.pair_||(this.resize(),this.onResizeWrapper_=Blockly.bindEvent_(window,"resize",f,function(){f.resize()}));this.onMouseDownBarWrapper_=Blockly.bindEvent_(this.svgBackground_,"mousedown",f,f.onMouseDownBar_);this.onMouseDownKnobWrapper_=Blockly.bindEvent_(this.svgKnob_,"mousedown",f,f.onMouseDownKnob_)};
Blockly.ScrollbarSvg.prototype.destroy=function(){this.onMouseUpKnob_();this.onResizeWrapper_&&(Blockly.unbindEvent_(this.onResizeWrapper_),this.onResizeWrapper_=null);Blockly.unbindEvent_(this.onMouseDownBarWrapper_);this.onMouseDownBarWrapper_=null;Blockly.unbindEvent_(this.onMouseDownKnobWrapper_);this.onMouseDownKnobWrapper_=null;this.svgGroup_.parentNode.removeChild(this.svgGroup_);this.setMetrics_=this.getMetrics_=this.element_=this.svgKnob_=this.svgBackground_=this.svgGroup_=null};
Blockly.ScrollbarSvg.prototype.resize=function(a){if(!a&&(a=this.getMetrics_(),!a))return;if(this.horizontal_){var b=a.viewWidth;this.pair_?b-=Blockly.ScrollbarSvg.scrollbarThickness:this.setVisible(b<a.contentHeight);this.ratio_=b/a.contentWidth;if(-Infinity===this.ratio_||Infinity===this.ratio_||isNaN(this.ratio_))this.ratio_=0;var c=a.viewWidth*this.ratio_,d=(a.viewLeft-a.contentLeft)*this.ratio_;this.svgKnob_.setAttribute("width",Math.max(0,c));this.xCoordinate=a.absoluteLeft;this.pair_&&Blockly.RTL&&
(this.xCoordinate+=a.absoluteLeft+Blockly.ScrollbarSvg.scrollbarThickness);this.yCoordinate=a.absoluteTop+a.viewHeight-Blockly.ScrollbarSvg.scrollbarThickness;this.svgGroup_.setAttribute("transform","translate("+this.xCoordinate+", "+this.yCoordinate+")");this.svgBackground_.setAttribute("width",Math.max(0,b));this.svgKnob_.setAttribute("x",this.constrainKnob_(d))}else{b=a.viewHeight;this.pair_?b-=Blockly.ScrollbarSvg.scrollbarThickness:this.setVisible(b<a.contentHeight);this.ratio_=b/a.contentHeight;
if(-Infinity===this.ratio_||Infinity===this.ratio_||isNaN(this.ratio_))this.ratio_=0;c=a.viewHeight*this.ratio_;d=(a.viewTop-a.contentTop)*this.ratio_;this.svgKnob_.setAttribute("height",Math.max(0,c));this.xCoordinate=a.absoluteLeft;Blockly.RTL||(this.xCoordinate+=a.viewWidth-Blockly.ScrollbarSvg.scrollbarThickness);this.yCoordinate=a.absoluteTop;this.svgGroup_.setAttribute("transform","translate("+this.xCoordinate+", "+this.yCoordinate+")");this.svgBackground_.setAttribute("height",Math.max(0,b));
this.svgKnob_.setAttribute("y",this.constrainKnob_(d))}this.onScroll_()};
Blockly.ScrollbarSvg.prototype.createDom_=function(a){this.svgGroup_=Blockly.createSvgElement("g",{},null);this.svgBackground_=Blockly.createSvgElement("rect",{"class":"blocklyScrollbarBackground"},this.svgGroup_);var b=Math.floor((Blockly.ScrollbarSvg.scrollbarThickness-6)/2);this.svgKnob_=Blockly.createSvgElement("rect",{"class":"blocklyScrollbarKnob",rx:b,ry:b},this.svgGroup_);Blockly.Scrollbar.insertAfter_(this.svgGroup_,a)};Blockly.ScrollbarSvg.prototype.isVisible=function(){return"none"!=this.svgGroup_.getAttribute("display")};
Blockly.ScrollbarSvg.prototype.setVisible=function(a){if(a!=this.isVisible()){if(this.pair_)throw"Unable to toggle visibility of paired scrollbars.";a?this.svgGroup_.setAttribute("display","block"):(this.setMetrics_({x:0,y:0}),this.svgGroup_.setAttribute("display","none"))}};
Blockly.ScrollbarSvg.prototype.onMouseDownBar_=function(a){Blockly.hideChaff(!0);if(!Blockly.isRightButton(a)){Blockly.svgResize();var b=Blockly.svgSize(),b=this.horizontal_?a.x-b.left:a.y-b.top,c=Blockly.getAbsoluteXY_(this.svgKnob_),c=this.horizontal_?c.x:c.y,d=parseFloat(this.svgKnob_.getAttribute(this.horizontal_?"width":"height")),e=parseFloat(this.svgKnob_.getAttribute(this.horizontal_?"x":"y")),f=0.95*d;b<=c?e-=f:b>=c+d&&(e+=f);this.svgKnob_.setAttribute(this.horizontal_?"x":"y",this.constrainKnob_(e));
this.onScroll_()}a.stopPropagation()};
Blockly.ScrollbarSvg.prototype.onMouseDownKnob_=function(a){Blockly.hideChaff(!0);this.onMouseUpKnob_();Blockly.isRightButton(a)||(this.startDragKnob=parseFloat(this.svgKnob_.getAttribute(this.horizontal_?"x":"y")),this.startDragMouse=this.horizontal_?a.clientX:a.clientY,Blockly.ScrollbarSvg.onMouseUpWrapper_=Blockly.bindEvent_(Blockly.svgDoc,"mouseup",this,this.onMouseUpKnob_),Blockly.ScrollbarSvg.onMouseMoveWrapper_=Blockly.bindEvent_(Blockly.svgDoc,"mousemove",this,this.onMouseMoveKnob_));a.stopPropagation()};
Blockly.ScrollbarSvg.prototype.onMouseMoveKnob_=function(a){this.svgKnob_.setAttribute(this.horizontal_?"x":"y",this.constrainKnob_(this.startDragKnob+((this.horizontal_?a.clientX:a.clientY)-this.startDragMouse)));this.onScroll_()};
Blockly.ScrollbarSvg.prototype.onMouseUpKnob_=function(){Blockly.ScrollbarSvg.onMouseUpWrapper_&&(Blockly.unbindEvent_(Blockly.ScrollbarSvg.onMouseUpWrapper_),Blockly.ScrollbarSvg.onMouseUpWrapper_=null);Blockly.ScrollbarSvg.onMouseMoveWrapper_&&(Blockly.unbindEvent_(Blockly.ScrollbarSvg.onMouseMoveWrapper_),Blockly.ScrollbarSvg.onMouseMoveWrapper_=null)};
Blockly.ScrollbarSvg.prototype.constrainKnob_=function(a){if(0>=a||isNaN(a))a=0;else var b=this.horizontal_?"width":"height",c=parseFloat(this.svgBackground_.getAttribute(b)),b=parseFloat(this.svgKnob_.getAttribute(b)),a=Math.min(a,c-b);return a};
Blockly.ScrollbarSvg.prototype.onScroll_=function(){var a=parseFloat(this.svgKnob_.getAttribute(this.horizontal_?"x":"y")),b=parseFloat(this.svgBackground_.getAttribute(this.horizontal_?"width":"height")),a=a/b;isNaN(a)&&(a=0);b={};this.horizontal_?b.x=a:b.y=a;this.setMetrics_(b)};Blockly.ScrollbarSvg.prototype.set=function(a,b){this.svgKnob_.setAttribute(this.horizontal_?"x":"y",a*this.ratio_);if(b)this.onScroll_()};Blockly.ScrollbarSvg.scrollbarThickness=15;Blockly.Scrollbar={};
(function(){var a=!1,b=-1!=window.navigator.userAgent.indexOf("Gecko/"),c="MacIntel"==window.navigator.platform,d=-1!=window.navigator.platform.indexOf("Linux");if(b&&(c||d))a=!0;Blockly.Scrollbar=a?Blockly.ScrollbarNative:Blockly.ScrollbarSvg})();Blockly.Scrollbar.insertAfter_=function(a,b){var c=b.nextSibling,d=b.parentNode;if(!d)throw"Reference node has no parent.";c?d.insertBefore(a,c):d.appendChild(a)};Blockly.Toolbox={};Blockly.Toolbox.width=0;Blockly.Toolbox.selectedOption_=null;
Blockly.Toolbox.createDom=function(){Blockly.Toolbox.flyout_=new Blockly.Flyout;var a=Blockly.createSvgElement("g",{},null);Blockly.Toolbox.svgGroup_=a;var b=Blockly.Toolbox.flyout_.createDom();a.appendChild(b);Blockly.Toolbox.svgBackground_=Blockly.createSvgElement("rect",{"class":"blocklyToolboxBackground",height:"100%"},a);Blockly.Toolbox.svgOptions_=Blockly.createSvgElement("g",{"class":"blocklyToolboxOptions"},a);return a};
Blockly.Toolbox.getMetrics=function(){var a=Blockly.svgSize().height,b=Blockly.Toolbox.width;try{var c=Blockly.Toolbox.svgOptions_.getBBox()}catch(d){return null}return{viewHeight:a,viewWidth:b,contentHeight:c.height+c.y,viewTop:-Blockly.Toolbox.svgOptions_.scrollY,contentTop:0,absoluteTop:0,absoluteLeft:Blockly.RTL?-1:1}};
Blockly.Toolbox.setMetrics=function(a){var b=Blockly.Toolbox.getMetrics();"number"==typeof a.y&&(Blockly.Toolbox.svgOptions_.scrollY=-b.contentHeight*a.y-b.contentTop);Blockly.Toolbox.svgOptions_.setAttribute("transform","translate(0,"+(Blockly.Toolbox.svgOptions_.scrollY+b.absoluteTop)+")")};
Blockly.Toolbox.init=function(){Blockly.Toolbox.flyout_.init(Blockly.mainWorkspace,Blockly.getMainWorkspaceMetrics,!0);Blockly.Toolbox.languageTree=Blockly.Toolbox.buildTree_();Blockly.Toolbox.redraw();new Blockly.Scrollbar(Blockly.Toolbox.svgOptions_,Blockly.Toolbox.getMetrics,Blockly.Toolbox.setMetrics,!1,!1);Blockly.Toolbox.position_();Blockly.bindEvent_(window,"resize",null,Blockly.Toolbox.position_)};
Blockly.Toolbox.position_=function(){var a=Blockly.svgSize();Blockly.RTL&&Blockly.Toolbox.svgGroup_.setAttribute("transform","translate("+(a.width-Blockly.Toolbox.width)+",0)")};Blockly.Toolbox.PREFIX_="cat_";Blockly.Toolbox.buildTree_=function(){var a={},b;for(b in Blockly.Language){var c=Blockly.Language[b];c.category&&(c=Blockly.Toolbox.PREFIX_+window.encodeURI(c.category),c in a?a[c].push(b):a[c]=[b])}return a};
Blockly.Toolbox.redraw=function(){function a(a){return function(b){var c=Blockly.Toolbox.selectedOption_;Blockly.hideChaff();c==a?Blockly.Toolbox.clearSelection():Blockly.Toolbox.selectOption_(a);b.stopPropagation()}}var b=[],c;for(c in Blockly.Toolbox.languageTree){var d={};d.text=window.decodeURI(c.substring(Blockly.Toolbox.PREFIX_.length));d.cat=c;b.push(d)}d={};(Blockly.Language.variables_get||Blockly.Language.variables_set)&&b.push({text:Blockly.MSG_VARIABLE_CATEGORY,cat:Blockly.MSG_VARIABLE_CATEGORY});
(Blockly.Language.procedures_defnoreturn||Blockly.Language.procedures_defreturn)&&b.push({text:Blockly.MSG_PROCEDURE_CATEGORY,cat:Blockly.MSG_PROCEDURE_CATEGORY});Blockly.removeChildren_(Blockly.Toolbox.svgOptions_);c=0;for(var e=[Blockly.Toolbox.svgBackground_],f=0;d=b[f];f++){var h=Blockly.ContextMenu.optionToDom(d.text),g=h.firstChild,i=h.lastChild;Blockly.Toolbox.svgOptions_.appendChild(h);h.setAttribute("transform","translate(0, "+(f*Blockly.ContextMenu.Y_HEIGHT+4)+")");h.cat=d.cat;Blockly.bindEvent_(h,
"mousedown",null,a(h));e.push(g);c=Math.max(c,i.getComputedTextLength())}c+=2*Blockly.ContextMenu.X_PADDING;for(f=0;f<e.length;f++)e[f].setAttribute("width",c);if(Blockly.RTL)for(f=0;h=Blockly.Toolbox.svgOptions_.childNodes[f];f++)i=h.lastChild,i.setAttribute("text-anchor","end"),i.setAttribute("x",c-Blockly.ContextMenu.X_PADDING);Blockly.Toolbox.width=c;Blockly.bindEvent_(Blockly.Toolbox.svgGroup_,"mousedown",null,function(a){Blockly.isRightButton(a)&&(Blockly.hideChaff(!0),a.stopPropagation())});
Blockly.fireUiEvent(window,"resize")};Blockly.Toolbox.selectOption_=function(a){Blockly.Toolbox.clearSelection();if(Blockly.Toolbox.selectedOption_=a)Blockly.addClass_(a,"blocklyMenuSelected"),a=a.cat,Blockly.Toolbox.flyout_.show(Blockly.Toolbox.languageTree[a]||a)};Blockly.Toolbox.clearSelection=function(){var a=Blockly.Toolbox.selectedOption_;a&&(Blockly.removeClass_(a,"blocklyMenuSelected"),Blockly.Toolbox.selectedOption_=null);Blockly.Toolbox.flyout_.hide()};Blockly.Tooltip={};Blockly.Tooltip.visible=!1;Blockly.Tooltip.mouseOutPid_=0;Blockly.Tooltip.showPid_=0;Blockly.Tooltip.lastX_=0;Blockly.Tooltip.lastY_=0;Blockly.Tooltip.element_=null;Blockly.Tooltip.poisonedElement_=null;Blockly.Tooltip.svgGroup_=null;Blockly.Tooltip.svgText_=null;Blockly.Tooltip.svgBackground_=null;Blockly.Tooltip.svgShadow_=null;Blockly.Tooltip.OFFSET_X=0;Blockly.Tooltip.OFFSET_Y=10;Blockly.Tooltip.RADIUS_OK=10;Blockly.Tooltip.HOVER_MS=1E3;Blockly.Tooltip.MARGINS=5;
Blockly.Tooltip.createDom=function(){var a=Blockly.createSvgElement("g",{"class":"blocklyHidden"},null);Blockly.Tooltip.svgGroup_=a;Blockly.Tooltip.svgShadow_=Blockly.createSvgElement("rect",{"class":"blocklyTooltipShadow",x:2,y:2},a);Blockly.Tooltip.svgBackground_=Blockly.createSvgElement("rect",{"class":"blocklyTooltipBackground"},a);Blockly.Tooltip.svgText_=Blockly.createSvgElement("text",{"class":"blocklyTooltipText"},a);return a};
Blockly.Tooltip.bindMouseEvents=function(a){Blockly.bindEvent_(a,"mouseover",null,Blockly.Tooltip.onMouseOver_);Blockly.bindEvent_(a,"mouseout",null,Blockly.Tooltip.onMouseOut_);Blockly.bindEvent_(a,"mousemove",null,Blockly.Tooltip.onMouseMove_)};Blockly.Tooltip.onMouseOver_=function(a){for(a=a.target;"object"==typeof a.tooltip;)a=a.tooltip;Blockly.Tooltip.element_!=a&&(Blockly.Tooltip.hide(),Blockly.Tooltip.poisonedElement_=null,Blockly.Tooltip.element_=a);window.clearTimeout(Blockly.Tooltip.mouseOutPid_)};
Blockly.Tooltip.onMouseOut_=function(){Blockly.Tooltip.mouseOutPid_=window.setTimeout(function(){Blockly.Tooltip.element_=null;Blockly.Tooltip.poisonedElement_=null;Blockly.Tooltip.hide()},1);window.clearTimeout(Blockly.Tooltip.showPid_)};
Blockly.Tooltip.onMouseMove_=function(a){if(Blockly.Tooltip.element_&&Blockly.Tooltip.element_.tooltip&&!(Blockly.ContextMenu&&Blockly.ContextMenu.visible||0!=Blockly.Block.dragMode_))if(Blockly.Tooltip.visible){var b=Blockly.Tooltip.lastY_-a.clientY;Math.sqrt(Math.pow(Blockly.Tooltip.lastX_-a.clientX,2)+Math.pow(b,2))>Blockly.Tooltip.RADIUS_OK&&Blockly.Tooltip.hide()}else Blockly.Tooltip.poisonedElement_!=Blockly.Tooltip.element_&&(window.clearTimeout(Blockly.Tooltip.showPid_),Blockly.Tooltip.lastX_=
a.clientX,Blockly.Tooltip.lastY_=a.clientY,Blockly.Tooltip.showPid_=window.setTimeout(Blockly.Tooltip.show_,Blockly.Tooltip.HOVER_MS))};Blockly.Tooltip.hide=function(){Blockly.Tooltip.visible&&(Blockly.Tooltip.visible=!1,Blockly.Tooltip.svgGroup_&&(Blockly.Tooltip.svgGroup_.style.display="none"));window.clearTimeout(Blockly.Tooltip.showPid_)};
Blockly.Tooltip.show_=function(){Blockly.Tooltip.poisonedElement_=Blockly.Tooltip.element_;if(Blockly.Tooltip.svgGroup_){Blockly.removeChildren_(Blockly.Tooltip.svgText_);var a=Blockly.Tooltip.element_.tooltip;"function"==typeof a&&(a=a());for(var a=a.split("\n"),b=0;b<a.length;b++){var c=Blockly.createSvgElement("tspan",{dy:"1em",x:Blockly.Tooltip.MARGINS},Blockly.Tooltip.svgText_),d=Blockly.svgDoc.createTextNode(a[b]);c.appendChild(d)}Blockly.Tooltip.visible=!0;Blockly.Tooltip.svgGroup_.style.display=
"block";a=Blockly.Tooltip.svgText_.getBBox();b=2*Blockly.Tooltip.MARGINS+a.width;c=a.height;Blockly.Tooltip.svgBackground_.setAttribute("width",b);Blockly.Tooltip.svgBackground_.setAttribute("height",c);Blockly.Tooltip.svgShadow_.setAttribute("width",b);Blockly.Tooltip.svgShadow_.setAttribute("height",c);if(Blockly.RTL)for(var c=a.width,d=0,e;e=Blockly.Tooltip.svgText_.childNodes[d];d++)e.setAttribute("text-anchor","end"),e.setAttribute("x",c+Blockly.Tooltip.MARGINS);c=Blockly.Tooltip.lastX_;c=Blockly.RTL?
c-(Blockly.Tooltip.OFFSET_X+b):c+Blockly.Tooltip.OFFSET_X;b=Blockly.Tooltip.lastY_+Blockly.Tooltip.OFFSET_Y;b=Blockly.mouseToSvg(c,b);c=b.x;b=b.y;d=Blockly.svgSize();b+a.height>d.height&&(b-=a.height+2*Blockly.Tooltip.OFFSET_Y);Blockly.RTL?c=Math.max(Blockly.Tooltip.MARGINS,c):c+a.width>d.width-2*Blockly.Tooltip.MARGINS&&(c=d.width-a.width-2*Blockly.Tooltip.MARGINS);Blockly.Tooltip.svgGroup_.setAttribute("transform","translate("+c+","+b+")")}};Blockly.Trashcan=function(a){this.getMetrics_=a};Blockly.Trashcan.prototype.BODY_URL_="media/trashbody.png";Blockly.Trashcan.prototype.LID_URL_="media/trashlid.png";Blockly.Trashcan.prototype.WIDTH_=47;Blockly.Trashcan.prototype.BODY_HEIGHT_=45;Blockly.Trashcan.prototype.LID_HEIGHT_=15;Blockly.Trashcan.prototype.MARGIN_BOTTOM_=35;Blockly.Trashcan.prototype.MARGIN_SIDE_=35;Blockly.Trashcan.prototype.isOpen=!1;Blockly.Trashcan.prototype.svgGroup_=null;Blockly.Trashcan.prototype.svgBody_=null;
Blockly.Trashcan.prototype.svgLid_=null;Blockly.Trashcan.prototype.lidTask_=0;Blockly.Trashcan.prototype.lidAngle_=0;Blockly.Trashcan.prototype.left_=0;Blockly.Trashcan.prototype.top_=0;
Blockly.Trashcan.prototype.createDom=function(){this.svgGroup_=Blockly.createSvgElement("g",{filter:"url(#blocklyTrashcanShadowFilter)"},null);this.svgBody_=Blockly.createSvgElement("image",{width:this.WIDTH_,height:this.BODY_HEIGHT_},this.svgGroup_);this.svgBody_.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",Blockly.pathToBlockly+this.BODY_URL_);this.svgBody_.setAttribute("y",this.LID_HEIGHT_);this.svgLid_=Blockly.createSvgElement("image",{width:this.WIDTH_,height:this.LID_HEIGHT_},
this.svgGroup_);this.svgLid_.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",Blockly.pathToBlockly+this.LID_URL_);return this.svgGroup_};Blockly.Trashcan.prototype.init=function(){this.setOpen_(!1);this.position_();Blockly.bindEvent_(window,"resize",this,this.position_)};Blockly.Trashcan.prototype.destroy=function(){this.svgGroup_&&(this.svgGroup_.parentNode.removeChild(this.svgGroup_),this.svgGroup_=null);this.getMetrics_=this.svgLid_=this.svgBody_=null;window.clearTimeout(this.lidTask_)};
Blockly.Trashcan.prototype.position_=function(){var a=this.getMetrics_();a&&(this.left_=Blockly.RTL?this.MARGIN_SIDE_:a.viewWidth+a.absoluteLeft-this.WIDTH_-this.MARGIN_SIDE_,this.top_=a.viewHeight+a.absoluteTop-(this.BODY_HEIGHT_+this.LID_HEIGHT_)-this.MARGIN_BOTTOM_,this.svgGroup_.setAttribute("transform","translate("+this.left_+","+this.top_+")"))};
Blockly.Trashcan.prototype.onMouseMove=function(a){if(this.svgGroup_){var b=Blockly.getAbsoluteXY_(this.svgGroup_),c=b.x,d=b.y,b=Blockly.mouseToSvg(a.clientX,a.clientY),a=b.x,b=b.y,c=a>c&&a<c+this.WIDTH_&&b>d&&b<d+this.BODY_HEIGHT_+this.LID_HEIGHT_;this.isOpen!=c&&this.setOpen_(c)}};Blockly.Trashcan.prototype.setOpen_=function(a){this.isOpen!=a&&(window.clearTimeout(this.lidTask_),this.isOpen=a,Blockly.Trashcan.animateLid_(this))};
Blockly.Trashcan.animateLid_=function(a){a.lidAngle_+=a.isOpen?10:-10;a.lidAngle_=Math.max(0,a.lidAngle_);a.svgLid_.setAttribute("transform","rotate("+(Blockly.RTL?-a.lidAngle_:a.lidAngle_)+", "+(Blockly.RTL?4:a.WIDTH_-4)+", "+(a.LID_HEIGHT_-2)+")");if(a.isOpen?45>a.lidAngle_:0<a.lidAngle_)a.lidTask_=window.setTimeout(function(){Blockly.Trashcan.animateLid_(a)},5)};Blockly.Trashcan.close=function(a){a.setOpen_(!1)};Blockly.removeChildren_=function(a){for(var b;b=a.firstChild;)a.removeChild(b)};Blockly.addClass_=function(a,b){var c=a.getAttribute("class")||"";-1==(" "+c+" ").indexOf(" "+b+" ")&&(c&&(c+=" "),a.setAttribute("class",c+b))};Blockly.removeClass_=function(a,b){var c=a.getAttribute("class");if(-1!=(" "+c+" ").indexOf(" "+b+" ")){for(var c=c.split(/\s+/),d=0;d<c.length;d++)if(!c[d]||c[d]==b)c.splice(d,1),d--;c.length?a.setAttribute("class",c.join(" ")):a.removeAttribute("class")}};
Blockly.bindEvent_=function(a,b,c,d){var e=[],f;if(a.addEventListener)f=function(a){d.apply(c,arguments)},a.addEventListener(b,f,!1),e.push([a,b,f]),b in Blockly.bindEvent_.TOUCH_MAP&&(f=function(a){if(1==a.changedTouches.length){var b=a.changedTouches[0];a.clientX=b.clientX;a.clientY=b.clientY}d.apply(c,arguments);a.preventDefault()},a.addEventListener(Blockly.bindEvent_.TOUCH_MAP[b],f,!1),e.push([a,Blockly.bindEvent_.TOUCH_MAP[b],f]));else if(a.attachEvent)f=function(a){d.apply(c,arguments);a.stopPropagation()},
a.attachEvent("on"+b,f),e.push([a,b,f]);else throw"Element is not a DOM node.";return e};Blockly.bindEvent_.TOUCH_MAP={};Blockly.bindEvent_.TOUCH_MAP="ontouchstart"in document.documentElement?{mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"}:{};Blockly.unbindEvent_=function(a){for(;a.length;){var b=a.pop(),c=b[0],d=b[1],b=b[2];c.removeEventListener?c.removeEventListener(d,b,!1):c.detachEvent("on"+d,b)}return b};
Blockly.fireUiEvent=function(a,b){var c=Blockly.svgDoc;if(c.createEvent)c=c.createEvent("UIEvents"),c.initEvent(b,!0,!0),a.dispatchEvent(c);else if(c.createEventObject)c=c.createEventObject(),a.fireEvent("on"+b,c);else throw"FireEvent: No event creation mechanism.";};Blockly.noEvent=function(a){a.preventDefault();a.stopPropagation()};
Blockly.getRelativeXY_=function(a){var b={x:0,y:0},c=a.getAttribute("x");c&&(b.x=parseInt(c,10));if(c=a.getAttribute("y"))b.y=parseInt(c,10);if(a=(a=a.getAttribute("transform"))&&a.match(/translate\(\s*([-\d.]+)(,\s*([-\d.]+)\s*\))?/))b.x+=parseInt(a[1],10),a[3]&&(b.y+=parseInt(a[3],10));return b};Blockly.getAbsoluteXY_=function(a){var b=0,c=0;do var d=Blockly.getRelativeXY_(a),b=b+d.x,c=c+d.y,a=a.parentNode;while(a&&a!=Blockly.svgDoc);return{x:b,y:c}};
Blockly.createSvgElement=function(a,b,c){var a=Blockly.svgDoc.createElementNS(Blockly.SVG_NS,a),d;for(d in b)a.setAttribute(d,b[d]);c&&c.appendChild(a);return a};Blockly.caseInsensitiveComparator=function(a,b){a=a.toLowerCase();b=b.toLowerCase();return a>b?1:a<b?-1:0};Blockly.uniqueId=function(){for(var a="abcdefghijklmnopqrstuvwxyz",b=a.charAt(Math.random()*a.length),a=a+"0123456789-_:.",c=1;8>c;c++)b+=a.charAt(Math.random()*a.length);-1!=b.indexOf("--")&&(b=Blockly.uniqueId());return b};
Blockly.isRightButton=function(a){return 2==a.button||a.ctrlKey};Blockly.mouseToSvg=function(a,b){var c=Blockly.svg.createSVGPoint();c.x=a;c.y=b;var d=Blockly.svg.getScreenCTM().inverse();return c.matrixTransform(d)};Blockly.Variables={};Blockly.Variables.NAME_TYPE="variable";Blockly.Variables.allVariables=function(a){var b;b=a?a.getDescendants():Blockly.mainWorkspace.getAllBlocks();for(var a={},c=0;c<b.length;c++){var d=b[c].getVars;if(d)for(var d=d.call(b[c]),e=0;e<d.length;e++){var f=d[e];f&&(a[Blockly.Names.PREFIX_+f.toLowerCase()]=f)}}b=[];for(var h in a)b.push(a[h]);return b};
Blockly.Variables.renameVariable=function(a,b){for(var c=Blockly.mainWorkspace.getAllBlocks(),d=0;d<c.length;d++){var e=c[d].renameVar;e&&e.call(c[d],a,b)}};
Blockly.Variables.flyoutCategory=function(a,b,c,d){var e=Blockly.Variables.allVariables();e.sort(Blockly.caseInsensitiveComparator);e.unshift(null);for(var f=void 0,h=0;h<e.length;h++)if(e[h]!==f){var g=Blockly.Language.variables_get?new Blockly.Block(d,"variables_get"):null;g&&g.initSvg();var i=Blockly.Language.variables_set?new Blockly.Block(d,"variables_set"):null;i&&i.initSvg();null===e[h]?f=(g||i).getVars()[0]:(g&&g.setTitleValue(e[h],"VAR"),i&&i.setTitleValue(e[h],"VAR"));i&&a.push(i);g&&a.push(g);
g&&i?b.push(c,3*c):b.push(2*c)}};Blockly.Variables.refreshFlyoutCategory=function(){Blockly.Toolbox&&(Blockly.Toolbox.flyout_.isVisible()&&Blockly.Toolbox.selectedOption_.cat==Blockly.MSG_VARIABLE_CATEGORY)&&(Blockly.Toolbox.flyout_.hide(),Blockly.Toolbox.flyout_.show(Blockly.MSG_VARIABLE_CATEGORY))};
Blockly.Variables.generateUniqueName=function(){var a=Blockly.Variables.allVariables(),b="";if(a.length){a.sort(Blockly.caseInsensitiveComparator);for(var c=0,d="i",e=0,f=!1;!b;){e=0;for(f=!1;e<a.length&&!f;)a[e].toLowerCase()==d&&(f=!0),e++;f?("z"===d.charAt(0)?(c++,d="a"):(d=String.fromCharCode(d.charCodeAt(0)+1),"l"==d.charAt(0)&&(d=String.fromCharCode(d.charCodeAt(0)+1))),0<c&&(d+=c)):b=d}}else b="i";return b};Blockly.Warning=function(a){this.block_=a;this.createIcon_()};Blockly.Warning.ICON_RADIUS=8;Blockly.Warning.prototype.bubble_=null;Blockly.Warning.prototype.text_="";Blockly.Warning.prototype.iconX_=null;Blockly.Warning.prototype.iconY_=null;
Blockly.Warning.prototype.createIcon_=function(){this.iconGroup_=Blockly.createSvgElement("g",{"class":"blocklyIconGroup"},null);Blockly.createSvgElement("path",{"class":"blocklyIconShield",d:"M 2,15 Q -1,15 0.5,12 L 6.5,1.7 Q 8,-1 9.5,1.7 L 15.5,12 Q 17,15 14,15 z"},this.iconGroup_);this.iconMark_=Blockly.createSvgElement("text",{"class":"blocklyIconMark",x:Blockly.Warning.ICON_RADIUS,y:2*Blockly.Warning.ICON_RADIUS-3},this.iconGroup_);this.iconMark_.appendChild(Blockly.svgDoc.createTextNode("!"));
this.block_.getSvgRoot().appendChild(this.iconGroup_);Blockly.bindEvent_(this.iconGroup_,"mouseup",this,this.iconClick_)};Blockly.Warning.prototype.textToDom_=function(a){for(var b=Blockly.createSvgElement("text",{"class":"blocklyText",y:Blockly.Bubble.BORDER_WIDTH},null),a=a.split("\n"),c=0;c<a.length;c++){var d=Blockly.createSvgElement("tspan",{dy:"1em",x:Blockly.Bubble.BORDER_WIDTH},b),e=Blockly.svgDoc.createTextNode(a[c]);d.appendChild(e)}return b};Blockly.Warning.prototype.isVisible=function(){return!!this.bubble_};
Blockly.Warning.prototype.setVisible=function(a){if(a!=this.isVisible())if(a){a=this.textToDom_(this.text_);this.bubble_=new Blockly.Bubble(this.block_.workspace,a,this.block_.svg_.svgGroup_,this.iconX_,this.iconY_,null,null);if(Blockly.RTL)for(var b=a.getBBox().width,c=0,d;d=a.childNodes[c];c++)d.setAttribute("text-anchor","end"),d.setAttribute("x",b+Blockly.Bubble.BORDER_WIDTH);this.updateColour()}else this.bubble_.destroy(),this.foreignObject_=this.body_=this.bubble_=null};
Blockly.Warning.prototype.iconClick_=function(){this.setVisible(!this.isVisible())};Blockly.Warning.prototype.bodyFocus_=function(){this.bubble_.promote_()};Blockly.Warning.prototype.setText=function(a){this.text_=a;this.isVisible()&&(this.setVisible(!1),this.setVisible(!0))};Blockly.Warning.prototype.updateColour=function(){if(this.isVisible()){var a=Blockly.makeColour(this.block_.getColour());this.bubble_.setColour(a)}};
Blockly.Warning.prototype.destroy=function(){this.iconGroup_.parentNode.removeChild(this.iconGroup_);this.iconGroup_=null;this.setVisible(!1);this.block_=this.block_.warning=null};
Blockly.Warning.prototype.renderIcon=function(a){if(this.block_.collapsed)return this.iconGroup_.setAttribute("display","none"),a;this.iconGroup_.setAttribute("display","block");var b=2*Blockly.Warning.ICON_RADIUS;Blockly.RTL&&(a-=b);this.iconGroup_.setAttribute("transform","translate("+a+", 5)");this.computeIconLocation();return a=Blockly.RTL?a-Blockly.BlockSvg.SEP_SPACE_X:a+(b+Blockly.BlockSvg.SEP_SPACE_X)};
Blockly.Warning.prototype.setIconLocation=function(a,b){this.iconX_=a;this.iconY_=b;this.isVisible()&&this.bubble_.setAnchorLocation(a,b)};Blockly.Warning.prototype.computeIconLocation=function(){var a=this.block_.getRelativeToSurfaceXY(),b=Blockly.getRelativeXY_(this.iconGroup_),c=a.x+b.x+Blockly.Warning.ICON_RADIUS,a=a.y+b.y+Blockly.Warning.ICON_RADIUS;(c!==this.iconX_||a!==this.iconY_)&&this.setIconLocation(c,a)};Blockly.Warning.prototype.getIconLocation=function(){return{x:this.iconX_,y:this.iconY_}};Blockly.Workspace=function(a){this.editable=a;this.topBlocks_=[];Blockly.ConnectionDB.init(this)};Blockly.Workspace.prototype.dragMode=!1;Blockly.Workspace.prototype.scrollX=0;Blockly.Workspace.prototype.scrollY=0;Blockly.Workspace.prototype.trashcan=null;Blockly.Workspace.prototype.fireChangeEventPid_=null;Blockly.Workspace.prototype.scrollbar=null;
Blockly.Workspace.prototype.createDom=function(){this.svgGroup_=Blockly.createSvgElement("g",{},null);this.svgBlockCanvas_=Blockly.createSvgElement("g",{},this.svgGroup_);this.svgBubbleCanvas_=Blockly.createSvgElement("g",{},this.svgGroup_);this.fireChangeEvent();return this.svgGroup_};
Blockly.Workspace.prototype.destroy=function(){this.svgGroup_&&(this.svgGroup_.parentNode.removeChild(this.svgGroup_),this.svgGroup_=null);this.svgBubbleCanvas_=this.svgBlockCanvas_=null;this.trashcan&&(this.trashcan.destroy(),this.trashcan=null)};Blockly.Workspace.prototype.addTrashcan=function(a){Blockly.Trashcan&&this.editable&&(this.trashcan=new Blockly.Trashcan(a),a=this.trashcan.createDom(),this.svgGroup_.insertBefore(a,this.svgBlockCanvas_),this.trashcan.init())};
Blockly.Workspace.prototype.getCanvas=function(){return this.svgBlockCanvas_};Blockly.Workspace.prototype.getBubbleCanvas=function(){return this.svgBubbleCanvas_};Blockly.Workspace.prototype.addTopBlock=function(a){this.topBlocks_.push(a);this.fireChangeEvent()};Blockly.Workspace.prototype.removeTopBlock=function(a){for(var b=!1,c,d=0;c=this.topBlocks_[d];d++)if(c==a){this.topBlocks_.splice(d,1);b=!0;break}if(!b)throw"Block not present in workspace's list of top-most blocks.";this.fireChangeEvent()};
Blockly.Workspace.prototype.getTopBlocks=function(a){var b=[].concat(this.topBlocks_);a&&1<b.length&&b.sort(function(a,b){return a.getRelativeToSurfaceXY().y-b.getRelativeToSurfaceXY().y});return b};Blockly.Workspace.prototype.getAllBlocks=function(){for(var a=this.getTopBlocks(!1),b=0;b<a.length;b++)a=a.concat(a[b].getChildren());return a};Blockly.Workspace.prototype.clear=function(){for(Blockly.hideChaff();this.topBlocks_.length;)this.topBlocks_[0].destroy()};
Blockly.Workspace.prototype.render=function(){for(var a=this.getAllBlocks(),b=0,c;c=a[b];b++)c.getChildren().length||c.render()};Blockly.Workspace.prototype.getBlockById=function(a){for(var b=this.getAllBlocks(),c=0,d;d=b[c];c++)if(d.id==a)return d;return null};
Blockly.Workspace.prototype.traceOn=function(a){this.traceOn_=a;this.traceWrapper_&&(Blockly.unbindEvent_(this.traceWrapper_),this.traceWrapper_=null);a&&(this.traceWrapper_=Blockly.bindEvent_(this.svgBlockCanvas_,"blocklySelectChange",this,function(){this.traceOn_=!1}))};Blockly.Workspace.prototype.highlightBlock=function(a){if(this.traceOn_&&(a=this.getBlockById(a)))this.traceOn(!1),a.select(),this.traceOn(!0)};
Blockly.Workspace.prototype.fireChangeEvent=function(){this.fireChangeEventPid_&&window.clearTimeout(this.fireChangeEventPid_);var a=this.svgBlockCanvas_;a&&(this.fireChangeEventPid_=window.setTimeout(function(){Blockly.fireUiEvent(a,"blocklyWorkspaceChange")},0))};
Blockly.Workspace.prototype.paste=function(a){var b=Blockly.Xml.domToBlock_(this,a),c=parseInt(a.getAttribute("x"),10),a=parseInt(a.getAttribute("y"),10);if(!isNaN(c)&&!isNaN(a)){Blockly.RTL&&(c=-c);do for(var d=!1,e=this.getAllBlocks(),f=0,h;h=e[f];f++)h=h.getRelativeToSurfaceXY(),1>=Math.abs(c-h.x)&&1>=Math.abs(a-h.y)&&(c=Blockly.RTL?c-Blockly.SNAP_RADIUS:c+Blockly.SNAP_RADIUS,a+=2*Blockly.SNAP_RADIUS,d=!0);while(d);b.moveBy(c,a)}b.select()};Blockly.Xml={};Blockly.Xml.workspaceToDom=function(a){for(var b=document.createElement("xml"),a=a.getTopBlocks(!1),c=0,d;d=a[c];c++){var e=Blockly.Xml.blockToDom_(d);d=d.getRelativeToSurfaceXY();e.setAttribute("x",Blockly.RTL?-d.x:d.x);e.setAttribute("y",d.y);b.appendChild(e)}return b};
Blockly.Xml.blockToDom_=function(a){var b=document.createElement("block");b.setAttribute("type",a.type);if(a.mutationToDom){var c=a.mutationToDom();c&&b.appendChild(c)}for(var d=0;c=a.inputList[d];d++)for(var e=0,f;f=c.titleRow[e];e++){var h=f;h.name&&h.EDITABLE&&(f=document.createElement("title"),f.setAttribute("name",h.name),h=document.createTextNode(h.getValue()),f.appendChild(h),b.appendChild(f))}a.comment&&(c=document.createElement("comment"),d=document.createTextNode(a.comment.getText()),c.appendChild(d),
c.setAttribute("pinned",a.comment.isVisible()),d=a.comment.getBubbleSize(),c.setAttribute("h",d.height),c.setAttribute("w",d.width),b.appendChild(c));d=!1;for(e=0;c=a.inputList[e];e++){var g;f=!0;c.type!=Blockly.DUMMY_INPUT&&(h=c.connection.targetBlock(),c.type==Blockly.INPUT_VALUE?(g=document.createElement("value"),d=!0):c.type==Blockly.NEXT_STATEMENT&&(g=document.createElement("statement")),h&&(g.appendChild(Blockly.Xml.blockToDom_(h)),f=!1),g.setAttribute("name",c.name),f||b.appendChild(g))}d&&
b.setAttribute("inline",a.inputsInline);a.collapsed&&b.setAttribute("collapsed",!0);a.disabled&&b.setAttribute("disabled",!0);if(a.nextConnection&&(a=a.nextConnection.targetBlock()))g=document.createElement("next"),g.appendChild(Blockly.Xml.blockToDom_(a)),b.appendChild(g);return b};Blockly.Xml.domToText=function(a){return(new XMLSerializer).serializeToString(a)};
Blockly.Xml.domToPrettyText=function(a){for(var a=Blockly.Xml.domToText(a).split("<"),b="",c=1;c<a.length;c++){var d=a[c][0];"/"==d&&(b=b.substring(2));a[c]=b+"<"+a[c];"/"!=d&&(b+="  ")}a=a.join("\n");a=a.replace(/(<(\w+)[^>]*>[^\n]*)\n *<\/\2>/g,"$1</$2>");return a.replace(/^\n/,"")};
Blockly.Xml.textToDom=function(a){a=(new DOMParser).parseFromString(a,"text/xml");if(!a||!a.firstChild||"xml"!=a.firstChild.tagName||a.firstChild!==a.lastChild)throw"Blockly.Xml.textToDom did not obtain a valid XML tree.";return a.firstChild};
Blockly.Xml.domToWorkspace=function(a,b){for(var c=0,d;d=b.childNodes[c];c++)if(d.nodeName&&"block"==d.nodeName.toLowerCase()){var e=Blockly.Xml.domToBlock_(a,d),f=parseInt(d.getAttribute("x"),10);d=parseInt(d.getAttribute("y"),10);!isNaN(f)&&!isNaN(d)&&e.moveBy(Blockly.RTL?-f:f,d)}};
Blockly.Xml.domToBlock_=function(a,b){var c=b.getAttribute("type"),c=new Blockly.Block(a,c);c.initSvg();for(var d=null,e=0,f;f=b.childNodes[e];e++)if(!(3==f.nodeType&&f.data.match(/^\s*$/))){for(var h=null,g=0,i;i=f.childNodes[g];g++)if(3!=i.nodeType||!i.data.match(/^\s*$/))h=i;g=f.getAttribute("name");switch(f.tagName.toLowerCase()){case "mutation":c.domToMutation&&c.domToMutation(f);break;case "comment":c.setCommentText(f.textContent);(h=f.getAttribute("pinned"))&&c.comment.setVisible("true"==h);
h=parseInt(f.getAttribute("w"),10);f=parseInt(f.getAttribute("h"),10);!isNaN(h)&&!isNaN(f)&&c.comment.setBubbleSize(h,f);break;case "title":c.setTitleValue(f.textContent,g);break;case "variable":console.log("Obsolete variable tag.  Please regenerate XML.");f=f.getAttribute("data");null!==f&&c.setTitleValue(f,g);break;case "value":case "statement":f=c.getInput(g);if(!f)throw"Input does not exist: "+g;if(h&&h.tagName&&"block"==h.tagName.toLowerCase())if(d=Blockly.Xml.domToBlock_(a,h),d.outputConnection)f.connection.connect(d.outputConnection);
else if(d.previousConnection)f.connection.connect(d.previousConnection);else throw"Child block does not have output or previous statement.";break;case "next":if(h&&h.tagName&&"block"==h.tagName.toLowerCase()){if(c.nextConnection){if(c.nextConnection.targetConnection)throw"Next statement is already connected.";}else throw"Next statement does not exist.";d=Blockly.Xml.domToBlock_(a,h);if(!d.previousConnection)throw"Next block does not have previous statement.";c.nextConnection.connect(d.previousConnection)}}}(e=
b.getAttribute("inline"))&&c.setInputsInline("true"==e);(e=b.getAttribute("collapsed"))&&c.setCollapsed("true"==e);(e=b.getAttribute("disabled"))&&c.setDisabled("true"==e);d||c.render();return c};Blockly.Xml.isFirstRealChild_=function(a,b){for(var c=0,d;d=a.childNodes[c];c++)if(3!=d.nodeType||!d.data.match(/^\s*$/))return d.tagName&&d.tagName.toLowerCase()==b;return!1};Blockly.Xml.deleteNext=function(a){for(var b=0,c;c=a.childNodes[b];b++)if("next"==c.tagName.toLowerCase()){a.removeChild(c);break}};