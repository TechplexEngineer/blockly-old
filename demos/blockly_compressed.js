// Do not edit this file; automatically generated by build.py.
var Blockly={pathToBlockly:"./",SVG_NS:"http://www.w3.org/2000/svg",HTML_NS:"http://www.w3.org/1999/xhtml",HSV_SATURATION:0.45,HSV_VALUE:0.65,makeColour:function(c){var c=c%360,d=Blockly.HSV_VALUE,e=Blockly.HSV_VALUE*(1-Blockly.HSV_SATURATION),f=(d-e)*(c%60/60)+e,g=(d-e)*(1-c%60/60)+e,h;0<=c&&60>c?(c=d,h=f,d=e):60<=c&&120>c?(c=g,h=d,d=e):120<=c&&180>c?(c=e,h=d,d=f):180<=c&&240>c?(c=e,h=g):240<=c&&300>c?(c=f,h=e):300<=c&&360>c?(c=d,h=e,d=g):d=h=c=0;c=Math.floor(16*c);h=Math.floor(16*h);d=Math.floor(16*
d);return"#"+"0123456789abcdef".charAt(c)+"0123456789abcdef".charAt(h)+"0123456789abcdef".charAt(d)},INPUT_VALUE:1,OUTPUT_VALUE:2,NEXT_STATEMENT:3,PREVIOUS_STATEMENT:4,DUMMY_INPUT:5,OPPOSITE_TYPE:[]};Blockly.OPPOSITE_TYPE[Blockly.INPUT_VALUE]=Blockly.OUTPUT_VALUE;Blockly.OPPOSITE_TYPE[Blockly.OUTPUT_VALUE]=Blockly.INPUT_VALUE;Blockly.OPPOSITE_TYPE[Blockly.NEXT_STATEMENT]=Blockly.PREVIOUS_STATEMENT;Blockly.OPPOSITE_TYPE[Blockly.PREVIOUS_STATEMENT]=Blockly.NEXT_STATEMENT;Blockly.SOUNDS_={};
Blockly.selected=null;Blockly.editable=!0;Blockly.highlightedConnection_=null;Blockly.localConnection_=null;Blockly.DRAG_RADIUS=5;Blockly.SNAP_RADIUS=12;Blockly.BUMP_DELAY=250;Blockly.svgDoc=null;Blockly.mainWorkspace=null;Blockly.clipboard_=null;Blockly.svgSize=function(){return{width:Blockly.svg.cachedWidth_,height:Blockly.svg.cachedHeight_,top:Blockly.svg.cachedTop_,left:Blockly.svg.cachedLeft_}};
Blockly.svgResize=function(){var c=Blockly.svg.parentNode.offsetWidth,d=Blockly.svg.parentNode.offsetHeight;Blockly.svg.cachedWidth_!=c&&(Blockly.svg.setAttribute("width",c+"px"),Blockly.svg.cachedWidth_=c);Blockly.svg.cachedHeight_!=d&&(Blockly.svg.setAttribute("height",d+"px"),Blockly.svg.cachedHeight_=d);c=Blockly.svg.getBoundingClientRect();Blockly.svg.cachedLeft_=c.left;Blockly.svg.cachedTop_=c.top};
Blockly.onMouseDown_=function(c){Blockly.Block.terminateDrag_();Blockly.hideChaff();if(!(Blockly.isTargetInput_(c)||Blockly.Mutator&&Blockly.Mutator.isOpen))if(Blockly.selected&&"svg"==c.target.nodeName&&Blockly.selected.unselect(),Blockly.isRightButton(c))Blockly.ContextMenu&&Blockly.showContextMenu_(c.clientX,c.clientY);else if("svg"==c.target.nodeName||!Blockly.editable)Blockly.mainWorkspace.dragMode=!0,Blockly.mainWorkspace.startDragMouseX=c.clientX,Blockly.mainWorkspace.startDragMouseY=c.clientY,
Blockly.mainWorkspace.startDragMetrics=Blockly.getMainWorkspaceMetrics(),Blockly.mainWorkspace.startScrollX=Blockly.mainWorkspace.scrollX,Blockly.mainWorkspace.startScrollY=Blockly.mainWorkspace.scrollY};Blockly.onMouseUp_=function(){Blockly.setCursorHand_(!1);Blockly.mainWorkspace.dragMode=!1};
Blockly.onMouseMove_=function(c){if(Blockly.mainWorkspace.dragMode){Blockly.removeAllRanges();var d=Blockly.mainWorkspace.startDragMetrics,e=Blockly.mainWorkspace.startScrollX+(c.clientX-Blockly.mainWorkspace.startDragMouseX),c=Blockly.mainWorkspace.startScrollY+(c.clientY-Blockly.mainWorkspace.startDragMouseY),e=Math.min(e,-d.contentLeft),c=Math.min(c,-d.contentTop),e=Math.max(e,d.viewWidth-d.contentLeft-d.contentWidth),c=Math.max(c,d.viewHeight-d.contentTop-d.contentHeight);Blockly.mainWorkspace.scrollbar.set(-e-
d.contentLeft,-c-d.contentTop)}};
Blockly.onKeyDown_=function(c){if(!Blockly.isTargetInput_(c))if(27==c.keyCode)Blockly.hideChaff(),Blockly.Mutator&&Blockly.Mutator.isOpen&&Blockly.Mutator.closeDialog();else if(8==c.keyCode||46==c.keyCode){if(Blockly.selected&&Blockly.selected.editable&&(!Blockly.Mutator||!Blockly.Mutator.isOpen))Blockly.hideChaff(),Blockly.selected.destroy(!0,!0);c.preventDefault()}else if(c.altKey||c.ctrlKey||c.metaKey)Blockly.selected&&(Blockly.selected.editable&&Blockly.selected.workspace==Blockly.mainWorkspace)&&
(Blockly.hideChaff(),67==c.keyCode?Blockly.copy_(Blockly.selected):88==c.keyCode&&(Blockly.copy_(Blockly.selected),Blockly.selected.destroy(!0,!0))),86==c.keyCode&&Blockly.clipboard_&&Blockly.mainWorkspace.paste(Blockly.clipboard_)};Blockly.copy_=function(c){var d=Blockly.Xml.blockToDom_(c);Blockly.Xml.deleteNext(d);c=c.getRelativeToSurfaceXY();d.setAttribute("x",Blockly.RTL?-c.x:c.x);d.setAttribute("y",c.y);Blockly.clipboard_=d};
Blockly.showContextMenu_=function(c,d){var e=[],f={enabled:!1};f.text=Blockly.MSG_HELP;f.callback=function(){};e.push(f);Blockly.ContextMenu.show(c,d,e)};Blockly.onContextMenu_=function(c){!Blockly.isTargetInput_(c)&&Blockly.ContextMenu&&c.preventDefault()};Blockly.hideChaff=function(c){Blockly.Tooltip&&Blockly.Tooltip.hide();Blockly.ContextMenu&&Blockly.ContextMenu.hide();Blockly.FieldDropdown.hideMenu();Blockly.Toolbox&&(!c&&Blockly.Toolbox.flyout_.autoClose)&&Blockly.Toolbox.clearSelection()};
Blockly.removeAllRanges=function(){if(window.getSelection){var c=window.getSelection();c&&c.removeAllRanges&&(c.removeAllRanges(),window.setTimeout(function(){window.getSelection().removeAllRanges()},0))}};Blockly.isTargetInput_=function(c){return"textarea"==c.target.type||"text"==c.target.type};Blockly.loadAudio_=function(c){if(Audio){var d=new Audio(Blockly.pathToBlockly+"media/"+c+".wav");d&&d.play&&(d.play(),d.pause(),Blockly.SOUNDS_[c]=d)}};
Blockly.playAudio=function(c){(c=Blockly.SOUNDS_[c])&&c.play()};Blockly.setCursorHand_=function(c){if(Blockly.editable){var d="";c&&(d="url("+Blockly.pathToBlockly+"media/handclosed.cur) 7 3, auto");Blockly.selected&&(Blockly.selected.getSvgRoot().style.cursor=d);Blockly.svgDoc.getElementsByTagName("svg")[0].style.cursor=d}};
Blockly.getMainWorkspaceMetrics=function(){var c=Blockly.svgSize();Blockly.Toolbox&&(c.width-=Blockly.Toolbox.width);var d=c.width-Blockly.Scrollbar.scrollbarThickness,e=c.height-Blockly.Scrollbar.scrollbarThickness;try{var f=Blockly.mainWorkspace.getCanvas().getBBox()}catch(g){return null}-Infinity==f.width&&-Infinity==f.height&&(f={width:0,height:0,x:0,y:0});var h=Math.min(f.x-d/2,f.x+f.width-d),d=Math.max(f.x+f.width+d/2,f.x+d),i=Math.min(f.y-e/2,f.y+f.height-e),e=Math.max(f.y+f.height+e/2,f.y+
e),f=0;Blockly.Toolbox&&!Blockly.RTL&&(f=Blockly.Toolbox.width);return{viewHeight:c.height,viewWidth:c.width,contentHeight:e-i,contentWidth:d-h,viewTop:-Blockly.mainWorkspace.scrollY,viewLeft:-Blockly.mainWorkspace.scrollX,contentTop:i,contentLeft:h,absoluteTop:0,absoluteLeft:f}};
Blockly.setMainWorkspaceMetrics=function(c){var d=Blockly.getMainWorkspaceMetrics();"number"==typeof c.x&&(Blockly.mainWorkspace.scrollX=-d.contentWidth*c.x-d.contentLeft);"number"==typeof c.y&&(Blockly.mainWorkspace.scrollY=-d.contentHeight*c.y-d.contentTop);c="translate("+(Blockly.mainWorkspace.scrollX+d.absoluteLeft)+","+(Blockly.mainWorkspace.scrollY+d.absoluteTop)+")";Blockly.mainWorkspace.getCanvas().setAttribute("transform",c);Blockly.mainWorkspace.getBubbleCanvas().setAttribute("transform",
c)};Blockly.cssLoaded=function(){Blockly.Toolbox&&Blockly.Toolbox.redraw()};Blockly.Block=function(c,d){this.id=Blockly.uniqueId();this.titleRow=[];this.previousConnection=this.nextConnection=this.outputConnection=null;this.inputList=[];this.disabled=this.collapsed=this.rendered=this.inputsInline=!1;this.editable=c.editable;this.tooltip="";this.contextMenu=!0;this.parentBlock_=null;this.childBlocks_=[];this.isInFlyout=!1;this.workspace=c;c.addTopBlock(this);if(d){this.type=d;var e=Blockly.Language[d];if(!e)throw'Error: "'+d+'" is an unknown language block.';for(var f in e)this[f]=
e[f]}"function"==typeof this.init&&this.init();this.editable&&"function"==typeof this.onchange&&Blockly.bindEvent_(c.getCanvas(),"blocklyWorkspaceChange",this,this.onchange)};Blockly.Block.prototype.svg_=null;Blockly.Block.prototype.mutator=null;Blockly.Block.prototype.comment=null;Blockly.Block.prototype.warning=null;Blockly.Block.prototype.initSvg=function(){this.svg_=new Blockly.BlockSvg(this);this.svg_.init();Blockly.bindEvent_(this.svg_.getRootNode(),"mousedown",this,this.onMouseDown_);this.workspace.getCanvas().appendChild(this.svg_.getRootNode())};
Blockly.Block.prototype.getSvgRoot=function(){return this.svg_&&this.svg_.getRootNode()};Blockly.Block.dragMode_=0;Blockly.Block.onMouseUpWrapper_=null;Blockly.Block.onMouseMoveWrapper_=null;
Blockly.Block.terminateDrag_=function(){Blockly.Block.onMouseUpWrapper_&&(Blockly.unbindEvent_(Blockly.Block.onMouseUpWrapper_),Blockly.Block.onMouseUpWrapper_=null);Blockly.Block.onMouseMoveWrapper_&&(Blockly.unbindEvent_(Blockly.Block.onMouseMoveWrapper_),Blockly.Block.onMouseMoveWrapper_=null);if(0!=Blockly.Block.dragMode_&&(Blockly.Block.dragMode_=0,Blockly.selected)){var c=Blockly.selected,d=c.getRelativeToSurfaceXY();c.moveConnections_(d.x-c.startDragX,d.y-c.startDragY);delete c.draggedBubbles_;
c.setDragging_(!1);c.render();window.setTimeout(function(){c.bumpNeighbours_()},Blockly.BUMP_DELAY);Blockly.fireUiEvent(window,"resize");c.workspace.fireChangeEvent()}};Blockly.Block.prototype.select=function(){Blockly.selected&&Blockly.selected.unselect();Blockly.selected=this;this.svg_.addSelect();Blockly.fireUiEvent(this.workspace.getCanvas(),"blocklySelectChange")};
Blockly.Block.prototype.unselect=function(){Blockly.selected=null;this.svg_.removeSelect();Blockly.fireUiEvent(this.workspace.getCanvas(),"blocklySelectChange")};
Blockly.Block.prototype.destroy=function(c,d){if(this.outputConnection)this.setParent(null);else{var e=null;this.previousConnection&&this.previousConnection.targetConnection&&(e=this.previousConnection.targetConnection,this.setParent(null));if(c&&this.nextConnection&&this.nextConnection.targetConnection){var f=this.nextConnection.targetConnection,g=this.nextConnection.targetBlock();this.nextConnection.disconnect();g.setParent(null);e&&e.connect(f)}}d&&this.svg_&&this.svg_.destroyUiEffect();this.workspace.removeTopBlock(this);
this.workspace=null;this.rendered=!1;Blockly.selected==this&&(Blockly.selected=null,Blockly.Block.terminateDrag_());for(e=this.childBlocks_.length-1;0<=e;e--)this.childBlocks_[e].destroy(!1);for(e=0;e<this.titleRow.length;e++)this.titleRow[e].destroy();this.mutator&&this.mutator.destroy();this.comment&&this.comment.destroy();this.warning&&this.warning.destroy();for(e=0;f=this.inputList[e];e++)f.destroy();this.inputList=[];f=this.getConnections_(!0);for(e=0;e<f.length;e++)g=f[e],g.targetConnection&&
g.disconnect(),f[e].destroy();this.svg_&&(this.svg_.destroy(),this.svg_=null)};Blockly.Block.prototype.getRelativeToSurfaceXY=function(){var c=0,d=0;if(this.svg_){var e=this.svg_.getRootNode();do var f=Blockly.getRelativeXY_(e),c=c+f.x,d=d+f.y,e=e.parentNode;while(e&&e!=this.workspace.getCanvas())}return{x:c,y:d}};
Blockly.Block.prototype.moveBy=function(c,d){var e=this.getRelativeToSurfaceXY();this.svg_.getRootNode().setAttribute("transform","translate("+(e.x+c)+", "+(e.y+d)+")");this.moveConnections_(c,d)};
Blockly.Block.prototype.onMouseDown_=function(c){Blockly.svgResize();Blockly.Block.terminateDrag_();this.select();Blockly.hideChaff(this.isInFlyout);if(Blockly.isRightButton(c))Blockly.ContextMenu&&this.showContextMenu_(c.clientX,c.clientY);else if(this.editable){Blockly.removeAllRanges();Blockly.setCursorHand_(!0);var d=this.getRelativeToSurfaceXY();this.startDragX=d.x;this.startDragY=d.y;this.startDragMouseX=c.clientX;this.startDragMouseY=c.clientY;Blockly.Block.dragMode_=1;Blockly.Block.onMouseUpWrapper_=
Blockly.bindEvent_(Blockly.svgDoc,"mouseup",this,this.onMouseUp_);Blockly.Block.onMouseMoveWrapper_=Blockly.bindEvent_(Blockly.svgDoc,"mousemove",this,this.onMouseMove_);this.draggedBubbles_=[];for(var d=this.getDescendants(),e=0,f;f=d[e];e++){if(f.mutator){var g=f.mutator.getIconLocation();g.bubble=f.mutator;this.draggedBubbles_.push(g)}f.comment&&(g=f.comment.getIconLocation(),g.bubble=f.comment,this.draggedBubbles_.push(g));f.warning&&(g=f.warning.getIconLocation(),g.bubble=f.warning,this.draggedBubbles_.push(g))}}else return;
c.stopPropagation()};
Blockly.Block.prototype.onMouseUp_=function(){Blockly.Block.terminateDrag_();if(Blockly.selected&&Blockly.highlightedConnection_)Blockly.localConnection_.connect(Blockly.highlightedConnection_),this.svg_&&(Blockly.localConnection_.isSuperior()?Blockly.highlightedConnection_:Blockly.localConnection_).sourceBlock_.svg_.connectionUiEffect(),this.workspace.trashcan&&this.workspace.trashcan.isOpen&&Blockly.Trashcan.close(this.workspace.trashcan);else if(this.workspace.trashcan&&this.workspace.trashcan.isOpen){var c=this.workspace.trashcan;
window.setTimeout(function(){Blockly.Trashcan.close(c)},100);Blockly.selected.destroy(!1,!0);Blockly.fireUiEvent(window,"resize")}Blockly.highlightedConnection_&&(Blockly.highlightedConnection_.unhighlight(),Blockly.highlightedConnection_=null)};Blockly.Block.prototype.showHelp_=function(){var c="function"==typeof this.helpUrl?this.helpUrl():this.helpUrl;c&&window.open(c)};
Blockly.Block.prototype.duplicate_=function(){var c=Blockly.Xml.blockToDom_(this);Blockly.Xml.deleteNext(c);var c=Blockly.Xml.domToBlock_(this.workspace,c),d=this.getRelativeToSurfaceXY();d.x=Blockly.RTL?d.x-Blockly.SNAP_RADIUS:d.x+Blockly.SNAP_RADIUS;d.y+=2*Blockly.SNAP_RADIUS;c.moveBy(d.x,d.y)};
Blockly.Block.prototype.showContextMenu_=function(c,d){if(this.contextMenu){var e=this,f=[];if(this.editable){f.push({text:Blockly.MSG_DUPLICATE_BLOCK,enabled:!0,callback:function(){e.duplicate_()}});if(Blockly.Comment&&!this.collapsed){var g={enabled:!0};this.comment?(g.text=Blockly.MSG_REMOVE_COMMENT,g.callback=function(){e.setCommentText(null)}):(g.text=Blockly.MSG_ADD_COMMENT,g.callback=function(){e.setCommentText("")});f.push(g)}if(!this.collapsed)for(g=0;g<this.inputList.length;g++)if(this.inputList[g].type==
Blockly.INPUT_VALUE){g={enabled:!0};g.text=this.inputsInline?Blockly.MSG_EXTERNAL_INPUTS:Blockly.MSG_INLINE_INPUTS;g.callback=function(){e.setInputsInline(!e.inputsInline)};f.push(g);break}this.collapsed?(g={enabled:!0},g.text=Blockly.MSG_EXPAND_BLOCK,g.callback=function(){e.setCollapsed(!1)},f.push(g)):this.inputList.length&&(g={enabled:!0},g.text=Blockly.MSG_COLLAPSE_BLOCK,g.callback=function(){e.setCollapsed(!0)},f.push(g));g={text:this.disabled?Blockly.MSG_ENABLE_BLOCK:Blockly.MSG_DISABLE_BLOCK,
enabled:!this.getInheritedDisabled(),callback:function(){e.setDisabled(!e.disabled)}};f.push(g);g=this.getDescendants().length;e.nextConnection&&e.nextConnection.targetConnection&&(g-=this.nextConnection.targetBlock().getDescendants().length);g={text:1==g?Blockly.MSG_DELETE_BLOCK:Blockly.MSG_DELETE_X_BLOCKS.replace("%1",g),enabled:!0,callback:function(){e.destroy(!0,!0)}};f.push(g)}g={enabled:!!("function"==typeof this.helpUrl?this.helpUrl():this.helpUrl)};g.text=Blockly.MSG_HELP;g.callback=function(){e.showHelp_()};
f.push(g);this.customContextMenu&&this.customContextMenu(f);Blockly.ContextMenu.show(c,d,f)}};Blockly.Block.prototype.getConnections_=function(c){var d=[];if(c||this.rendered)if(this.outputConnection&&d.push(this.outputConnection),this.nextConnection&&d.push(this.nextConnection),this.previousConnection&&d.push(this.previousConnection),c||!this.collapsed)for(var c=0,e;e=this.inputList[c];c++)e.connection&&d.push(e.connection);return d};
Blockly.Block.prototype.moveConnections_=function(c,d){if(this.rendered){for(var e=this.getConnections_(!1),f=0;f<e.length;f++)e[f].moveBy(c,d);this.mutator&&this.mutator.computeIconLocation();this.comment&&this.comment.computeIconLocation();this.warning&&this.warning.computeIconLocation();for(f=0;f<this.childBlocks_.length;f++)this.childBlocks_[f].moveConnections_(c,d)}};Blockly.Block.prototype.setDragging_=function(c){c?this.svg_.addDragging():this.svg_.removeDragging();for(var d=0;d<this.childBlocks_.length;d++)this.childBlocks_[d].setDragging_(c)};
Blockly.Block.prototype.onMouseMove_=function(c){if(!("mousemove"==c.type&&1==c.x&&0==c.y&&0==c.button)){Blockly.removeAllRanges();var d=c.clientX-this.startDragMouseX,e=c.clientY-this.startDragMouseY;1==Blockly.Block.dragMode_&&Math.sqrt(Math.pow(d,2)+Math.pow(e,2))>Blockly.DRAG_RADIUS&&(Blockly.Block.dragMode_=2,this.setParent(null),this.setDragging_(!0));if(2==Blockly.Block.dragMode_){var f=this.startDragX+d,g=this.startDragY+e;this.svg_.getRootNode().setAttribute("transform","translate("+f+", "+
g+")");for(f=0;f<this.draggedBubbles_.length;f++)g=this.draggedBubbles_[f],g.bubble.setIconLocation(g.x+d,g.y+e);for(var f=this.getConnections_(!1),h=g=null,i=Blockly.SNAP_RADIUS,j=0;j<f.length;j++){var k=f[j],l=k.closest(i,d,e);l.connection&&(g=l.connection,h=k,i=l.radius)}Blockly.highlightedConnection_&&Blockly.highlightedConnection_!=g&&(Blockly.highlightedConnection_.unhighlight(),Blockly.highlightedConnection_=null,Blockly.localConnection_=null);g&&g!=Blockly.highlightedConnection_&&(g.highlight(),
Blockly.highlightedConnection_=g,Blockly.localConnection_=h);this.workspace.trashcan&&this.workspace.trashcan.onMouseMove(c)}}c.stopPropagation()};
Blockly.Block.prototype.bumpNeighbours_=function(){for(var c=this.getRootBlock(),d=this.getConnections_(!1),e=0;e<d.length;e++){var f=d[e];f.targetConnection&&f.isSuperior()&&f.targetBlock().bumpNeighbours_();for(var g=f.neighbours_(Blockly.SNAP_RADIUS),h=0;h<g.length;h++){var i=g[h];if(!f.targetConnection||!i.targetConnection)i.sourceBlock_.getRootBlock()!=c&&(f.isSuperior()?i.bumpAwayFrom_(f):f.bumpAwayFrom_(i))}}};Blockly.Block.prototype.getParent=function(){return this.parentBlock_};
Blockly.Block.prototype.getSurroundParent=function(){for(var c=this;;){do{var d=c,c=c.getParent();if(!c)return null}while(c.nextConnection&&c.nextConnection.targetBlock()==d);return c}};Blockly.Block.prototype.getRootBlock=function(){var c,d=this;do c=d,d=c.parentBlock_;while(d);return c};Blockly.Block.prototype.getChildren=function(){return this.childBlocks_};
Blockly.Block.prototype.setParent=function(c){if(this.parentBlock_){for(var d=this.parentBlock_.childBlocks_,e,f=0;e=d[f];f++)if(e==this){d.splice(f,1);break}d=this.getRelativeToSurfaceXY();this.workspace.getCanvas().appendChild(this.svg_.getRootNode());this.svg_.getRootNode().setAttribute("transform","translate("+d.x+", "+d.y+")");this.parentBlock_=null;this.previousConnection&&this.previousConnection.targetConnection&&this.previousConnection.disconnect();this.outputConnection&&this.outputConnection.targetConnection&&
this.outputConnection.disconnect()}else this.workspace.removeTopBlock(this);(this.parentBlock_=c)?(c.childBlocks_.push(this),d=this.getRelativeToSurfaceXY(),c.svg_&&this.svg_&&c.svg_.getRootNode().appendChild(this.svg_.getRootNode()),c=this.getRelativeToSurfaceXY(),this.moveConnections_(c.x-d.x,c.y-d.y)):this.workspace.addTopBlock(this)};Blockly.Block.prototype.getDescendants=function(){for(var c=[this],d,e=0;d=this.childBlocks_[e];e++)c=c.concat(d.getDescendants());return c};
Blockly.Block.prototype.getColour=function(){return this.colourHue_};Blockly.Block.prototype.setColour=function(c){this.colourHue_=c;this.svg_&&this.svg_.updateColour();this.mutator&&this.mutator.updateColour();this.comment&&this.comment.updateColour();this.warning&&this.warning.updateColour();this.rendered&&this.render()};
Blockly.Block.prototype.appendTitle=function(c,d){"string"==typeof c&&(c=new Blockly.FieldLabel(c));c.name=d;this.titleRow.push(c);this.svg_&&c.init(this);this.rendered&&(this.render(),this.bumpNeighbours_());return c};Blockly.Block.prototype.getTitle_=function(c){for(var d=0,e;e=this.titleRow[d];d++)if(e.name===c)return e;for(var d=0,f;f=this.inputList[d];d++)for(var g=0;e=f.titleRow[g];g++)if(e.name===c)return e;return null};
Blockly.Block.prototype.getTitleValue=function(c){return(c=this.getTitle_(c))?c.getValue():null};Blockly.Block.prototype.setTitleValue=function(c,d){var e=this.getTitle_(d);if(e)e.setValue(c);else throw'Title "'+d+'" not found.';};Blockly.Block.prototype.getTitleText=function(c){console.log("Obsolete call to getTitleText.  Please use getTitleValue.");return(c=this.getTitle_(c))?c.getText():null};
Blockly.Block.prototype.setTitleText=function(c,d){console.log("Obsolete call to setTitleText.  Please use setTitleValue.");var e=this.getTitle_(d);if(e)e.setText(c);else throw'Title "'+d+'" not found.';};Blockly.Block.prototype.setTooltip=function(c){this.tooltip=c};
Blockly.Block.prototype.setPreviousStatement=function(c,d){if(this.previousConnection){if(this.previousConnection.targetConnection)throw"Must disconnect previous statement before removing connection.";this.previousConnection.destroy();this.previousConnection=null}if(c){if(this.outputConnection)throw"Remove output connection prior to adding previous connection.";void 0===d&&(d=null);this.previousConnection=new Blockly.Connection(this,Blockly.PREVIOUS_STATEMENT,d)}this.rendered&&(this.render(),this.bumpNeighbours_())};
Blockly.Block.prototype.setNextStatement=function(c,d){if(this.nextConnection){if(this.nextConnection.targetConnection)throw"Must disconnect next statement before removing connection.";this.nextConnection.destroy();this.nextConnection=null}c&&(void 0===d&&(d=null),this.nextConnection=new Blockly.Connection(this,Blockly.NEXT_STATEMENT,d));this.rendered&&(this.render(),this.bumpNeighbours_())};
Blockly.Block.prototype.setOutput=function(c,d){if(this.outputConnection){if(this.outputConnection.targetConnection)throw"Must disconnect output value before removing connection.";this.outputConnection.destroy();this.outputConnection=null}if(c){if(this.previousConnection)throw"Remove previous connection prior to adding output connection.";void 0===d&&(d=null);this.outputConnection=new Blockly.Connection(this,Blockly.OUTPUT_VALUE,d)}this.rendered&&(this.render(),this.bumpNeighbours_())};
Blockly.Block.prototype.setInputsInline=function(c){this.inputsInline=c;this.rendered&&(this.render(),this.bumpNeighbours_())};Blockly.Block.prototype.setDisabled=function(c){this.disabled!=c&&(this.disabled=c,this.svg_.updateDisabled(),this.workspace.fireChangeEvent())};Blockly.Block.prototype.getInheritedDisabled=function(){for(var c=this;;)if(c=c.getSurroundParent()){if(c.disabled)return!0}else return!1};
Blockly.Block.prototype.setCollapsed=function(c){if(this.collapsed!=c){for(var d=(this.collapsed=c)?"none":"block",e=[],f=0,g;g=this.inputList[f];f++){for(var h=0,i;i=g.titleRow[h];h++)(i.getRootElement?i.getRootElement():i).style.display=d;if(g.targetBlock){if(c?g.hideAll():e=e.concat(g.unhideAll()),g=g.targetBlock())g.svg_.getRootNode().style.display=d,c&&(g.rendered=!1)}else g.getText&&g.setVisible(!c)}c&&this.mutator&&this.mutator.setPinned(!1);c&&this.comment&&this.comment.setPinned(!1);c&&this.warning&&
this.warning.setPinned(!1);0==e.length&&(e[0]=this);if(this.rendered){for(f=0;c=e[f];f++)c.render();this.bumpNeighbours_()}}};Blockly.Block.prototype.appendInput=function(c,d,e){var f=null;if(c==Blockly.INPUT_VALUE||c==Blockly.NEXT_STATEMENT)f=new Blockly.Connection(this,c,e);c=new Blockly.Input(c,d,this,f);this.inputList.push(c);this.rendered&&(this.render(),this.bumpNeighbours_());return c};
Blockly.Block.prototype.moveInputBefore=function(c,d){if(c==d)throw"Can't move \""+c+'" to itself.';for(var e=-1,f=-1,g=0,h;h=this.inputList[g];g++)if(h.name==c){if(e=g,-1!=f)break}else if(h.name==d&&(f=g,-1!=e))break;if(-1==e)throw'Named input "'+c+'" not found.';if(-1==f)throw'Reference input "'+c+'" not found.';this.inputList.splice(e,1);e<f&&f--;this.inputList.splice(f,0,h);this.rendered&&(this.render(),this.bumpNeighbours_())};
Blockly.Block.prototype.removeInput=function(c){for(var d=0,e;e=this.inputList[d];d++)if(e.name==c){e.connection&&e.connection.targetConnection&&e.connection.targetBlock().setParent(null);e.destroy();this.inputList.splice(d,1);this.rendered&&(this.render(),this.bumpNeighbours_());return}throw'Input "'+c+'" not found.';};Blockly.Block.prototype.getInput=function(c){for(var d=0,e;e=this.inputList[d];d++)if(e.name==c)return e;return null};
Blockly.Block.prototype.getInputTargetBlock=function(c){return(c=this.getInput(c))&&c.connection&&c.connection.targetBlock()};Blockly.Block.prototype.setMutator=function(c){this.mutator&&this.mutator!==c&&this.mutator.destroy();c&&(c.block_=this,this.mutator=c,this.svg_&&c.createIcon())};Blockly.Block.prototype.getCommentText=function(){return this.comment?this.comment.getText().replace(/\s+$/,"").replace(/ +\n/g,"\n"):""};
Blockly.Block.prototype.setCommentText=function(c){if(!Blockly.Comment)throw"Comments not supported.";var d=!1;"string"==typeof c?(this.comment||(this.comment=new Blockly.Comment(this),d=!0),this.comment.setText(c)):this.comment&&(this.comment.destroy(),d=!0);this.rendered&&(this.render(),d&&this.bumpNeighbours_())};
Blockly.Block.prototype.setWarningText=function(c){if(!Blockly.Warning)throw"Warnings not supported.";var d=!1;"string"==typeof c?(this.warning||(this.warning=new Blockly.Warning(this),d=!0),this.warning.setText(c)):this.warning&&(this.warning.destroy(),d=!0);this.rendered&&(this.render(),d&&this.bumpNeighbours_())};Blockly.Block.prototype.render=function(){this.svg_.render()};Blockly.BlockSvg=function(c){this.block_=c;this.svgGroup_=Blockly.createSvgElement("g",{},null);this.svgPathDark_=Blockly.createSvgElement("path",{"class":"blocklyPathDark",transform:"translate(1, 1)"},this.svgGroup_);this.svgPath_=Blockly.createSvgElement("path",{"class":"blocklyPath"},this.svgGroup_);this.svgPathLight_=Blockly.createSvgElement("path",{"class":"blocklyPathLight",fill:"none","stroke-width":2,"stroke-linecap":"round"},this.svgGroup_);this.svgPath_.tooltip=this.block_;Blockly.Tooltip&&
Blockly.Tooltip.bindMouseEvents(this.svgPath_);c.editable&&Blockly.addClass_(this.svgGroup_,"blocklyDraggable")};Blockly.BlockSvg.INLINE=-1;Blockly.BlockSvg.prototype.init=function(){var c=this.block_;this.updateColour();for(var d=0;d<c.titleRow.length;d++)c.titleRow[d].init(c);for(var d=0,e;e=c.inputList[d];d++)e.init();c.mutator&&c.mutator.createIcon()};Blockly.BlockSvg.prototype.getRootNode=function(){return this.svgGroup_};Blockly.BlockSvg.SEP_SPACE_X=10;Blockly.BlockSvg.SEP_SPACE_Y=5;
Blockly.BlockSvg.MIN_BLOCK_Y=25;Blockly.BlockSvg.TAB_HEIGHT=20;Blockly.BlockSvg.TAB_WIDTH=8;Blockly.BlockSvg.NOTCH_WIDTH=30;Blockly.BlockSvg.CORNER_RADIUS=8;Blockly.BlockSvg.DISTANCE_45_INSIDE=(1-Math.SQRT1_2)*(Blockly.BlockSvg.CORNER_RADIUS-1)+1;Blockly.BlockSvg.DISTANCE_45_OUTSIDE=(1-Math.SQRT1_2)*(Blockly.BlockSvg.CORNER_RADIUS+1)-1;Blockly.BlockSvg.NOTCH_PATH_LEFT="l 6,4 3,0 6,-4";Blockly.BlockSvg.NOTCH_PATH_LEFT_HIGHLIGHT="l 6.5,4 2,0 6.5,-4";Blockly.BlockSvg.NOTCH_PATH_RIGHT="l -6,4 -3,0 -6,-4";
Blockly.BlockSvg.JAGGED_TEETH="l 8,0 0,4 8,4 -16,8 8,4";Blockly.BlockSvg.TAB_PATH_DOWN="v 5 c 0,10 -"+Blockly.BlockSvg.TAB_WIDTH+",-8 -"+Blockly.BlockSvg.TAB_WIDTH+",7.5 s "+Blockly.BlockSvg.TAB_WIDTH+",-2.5 "+Blockly.BlockSvg.TAB_WIDTH+",7.5";Blockly.BlockSvg.TAB_PATH_DOWN_HIGHLIGHT_RTL="v 6.5 m -"+0.98*Blockly.BlockSvg.TAB_WIDTH+",2.5 q -"+0.05*Blockly.BlockSvg.TAB_WIDTH+",10 "+0.27*Blockly.BlockSvg.TAB_WIDTH+",10 m "+0.71*Blockly.BlockSvg.TAB_WIDTH+",-2.5 v 1.5";
Blockly.BlockSvg.prototype.destroy=function(){this.svgGroup_.parentNode.removeChild(this.svgGroup_);this.block_=this.svgPathDark_=this.svgPathLight_=this.svgPath_=this.svgGroup_=null};
Blockly.BlockSvg.prototype.destroyUiEffect=function(){Blockly.playAudio("delete");var c=Blockly.getAbsoluteXY_(this.svgGroup_);clone=this.svgGroup_.cloneNode(!0);clone.translateX_=c.x;clone.translateY_=c.y;clone.setAttribute("transform","translate("+clone.translateX_+","+clone.translateY_+")");Blockly.svg.appendChild(clone);clone.bBox_=clone.getBBox();clone.startDate_=new Date;Blockly.BlockSvg.destroyUiStep_(clone)};
Blockly.BlockSvg.destroyUiStep_=function(c){var d=(new Date-c.startDate_)/150;1<d?c.parentNode.removeChild(c):(c.setAttribute("transform","translate("+(c.translateX_+(Blockly.RTL?-1:1)*c.bBox_.width/2*d+", "+(c.translateY_+c.bBox_.height*d))+") scale("+(1-d)+")"),window.setTimeout(function(){Blockly.BlockSvg.destroyUiStep_(c)},10))};
Blockly.BlockSvg.prototype.connectionUiEffect=function(){Blockly.playAudio("click");var c=Blockly.getAbsoluteXY_(this.svgGroup_);this.block_.outputConnection?(c.x-=3,c.y+=13):this.block_.previousConnection&&(c.x+=23,c.y+=3);c=Blockly.createSvgElement("circle",{cx:c.x,cy:c.y,r:0,fill:"none",stroke:"#888","stroke-width":10},Blockly.svg);c.startDate_=new Date;Blockly.BlockSvg.connectionUiStep_(c)};
Blockly.BlockSvg.connectionUiStep_=function(c){var d=(new Date-c.startDate_)/150;1<d?c.parentNode.removeChild(c):(c.setAttribute("r",25*d),c.style.opacity=1-d,window.setTimeout(function(){Blockly.BlockSvg.connectionUiStep_(c)},10))};
Blockly.BlockSvg.prototype.updateColour=function(){var c=Blockly.makeColour(this.block_.getColour()),d=window.parseInt(c.charAt(1),16),e=window.parseInt(c.charAt(2),16),f=window.parseInt(c.charAt(3),16),g="0123456789abcdef".charAt(Math.min(d+3,15)),h="0123456789abcdef".charAt(Math.min(e+2,15)),i="0123456789abcdef".charAt(Math.min(f+2,15)),d="0123456789abcdef".charAt(Math.max(d-4,0)),e="0123456789abcdef".charAt(Math.max(e-4,0)),f="0123456789abcdef".charAt(Math.max(f-4,0));this.svgPathLight_.setAttribute("stroke",
"#"+g+h+i);this.svgPathDark_.setAttribute("fill","#"+d+e+f);this.svgPath_.setAttribute("fill",c)};Blockly.BlockSvg.prototype.updateDisabled=function(){this.block_.disabled||this.block_.getInheritedDisabled()?(Blockly.addClass_(this.svgGroup_,"blocklyDisabled"),this.svgPath_.setAttribute("fill","url(#blocklyDisabledPattern)")):(Blockly.removeClass_(this.svgGroup_,"blocklyDisabled"),this.updateColour());for(var c=this.block_.getChildren(),d=0,e;e=c[d];d++)e.svg_.updateDisabled()};
Blockly.BlockSvg.prototype.addSelect=function(){Blockly.addClass_(this.svgGroup_,"blocklySelected");this.svgGroup_.parentNode.appendChild(this.svgGroup_)};Blockly.BlockSvg.prototype.removeSelect=function(){Blockly.removeClass_(this.svgGroup_,"blocklySelected")};Blockly.BlockSvg.prototype.addDragging=function(){Blockly.addClass_(this.svgGroup_,"blocklyDragging")};Blockly.BlockSvg.prototype.removeDragging=function(){Blockly.removeClass_(this.svgGroup_,"blocklyDragging")};
Blockly.BlockSvg.prototype.render=function(){this.block_.rendered=!0;var c=18;if(!this.block_.collapsed&&this.block_.inputsInline)for(var d=0,e;e=this.block_.inputList[d];d++)if(e.type==Blockly.INPUT_VALUE){c+=Blockly.BlockSvg.SEP_SPACE_Y;break}else if(e.type==Blockly.NEXT_STATEMENT)break;c=Blockly.RTL?this.renderTitleRTL_(c):this.renderTitleLTR_(c);d=this.renderCompute_(this.block_.inputList);this.renderDraw_(c,d);(c=this.block_.getParent())?c.render():Blockly.fireUiEvent(window,"resize")};
Blockly.BlockSvg.prototype.renderTitleRTL_=function(c){var d=-Blockly.BlockSvg.SEP_SPACE_X,e;this.block_.mutator&&(e=this.block_.mutator.renderIcon(d))&&(d-=e+Blockly.BlockSvg.SEP_SPACE_X);this.block_.comment&&(e=this.block_.comment.renderIcon(d))&&(d-=e+Blockly.BlockSvg.SEP_SPACE_X);this.block_.warning&&(e=this.block_.warning.renderIcon(d))&&(d-=e+Blockly.BlockSvg.SEP_SPACE_X);d=this.renderTitles_(this.block_.titleRow,d,c);if(this.block_.previousConnection||this.block_.nextConnection)d=Math.min(d,
-Blockly.BlockSvg.NOTCH_WIDTH-Blockly.BlockSvg.SEP_SPACE_X);return-d};
Blockly.BlockSvg.prototype.renderTitleLTR_=function(c){var d=Blockly.BlockSvg.SEP_SPACE_X,e;this.block_.mutator&&(e=this.block_.mutator.renderIcon(d))&&(d+=e+Blockly.BlockSvg.SEP_SPACE_X);this.block_.comment&&(e=this.block_.comment.renderIcon(d))&&(d+=e+Blockly.BlockSvg.SEP_SPACE_X);this.block_.warning&&(e=this.block_.warning.renderIcon(d))&&(d+=e+Blockly.BlockSvg.SEP_SPACE_X);d=this.renderTitles_(this.block_.titleRow,d,c);if(this.block_.previousConnection||this.block_.nextConnection)d=Math.max(d,
Blockly.BlockSvg.NOTCH_WIDTH+Blockly.BlockSvg.SEP_SPACE_X);return d};Blockly.BlockSvg.prototype.renderTitles_=function(c,d,e){for(var f=0,g;g=c[f];f++)if(Blockly.RTL){var h=g.width(),d=d-h;g.getRootElement().setAttribute("transform","translate("+d+", "+e+")");h&&(d-=Blockly.BlockSvg.SEP_SPACE_X)}else g.getRootElement().setAttribute("transform","translate("+d+", "+e+")"),(h=g.width())&&(d+=h+Blockly.BlockSvg.SEP_SPACE_X);return d};
Blockly.BlockSvg.prototype.renderCompute_=function(c){var d=[];d.labelValueWidth=0;d.labelStatementWidth=0;d.hasValue=!1;d.hasStatement=!1;var e=void 0;if(this.block_.collapsed)return d;for(var f=0,g;g=c[f];f++){var h;!this.block_.inputsInline||!(e==Blockly.INPUT_VALUE||e==Blockly.DUMMY_INPUT)||!(g.type==Blockly.INPUT_VALUE||g.type==Blockly.DUMMY_INPUT)?(e=g.type,h=[],h.type=this.block_.inputsInline&&(g.type==Blockly.INPUT_VALUE||g.type==Blockly.DUMMY_INPUT)?Blockly.BlockSvg.INLINE:g.type,h.height=
0,d.push(h)):h=d[d.length-1];h.push(g);g.renderHeight=Blockly.BlockSvg.MIN_BLOCK_Y;g.renderWidth=NaN;this.block_.inputsInline&&(g.type==Blockly.INPUT_VALUE?g.renderWidth=Blockly.BlockSvg.TAB_WIDTH+Blockly.BlockSvg.SEP_SPACE_X:g.type==Blockly.DUMMY_INPUT&&(g.renderWidth=0));if(g.connection&&g.connection.targetConnection){var i=g.connection.targetBlock().getSvgRoot();try{var j=i.getBBox()}catch(k){j={height:0,width:0}}-1!=window.navigator.userAgent.indexOf("AppleWebKit/")&&(j.height-=3);g.renderHeight=
Math.max(g.renderHeight,j.height-1);g.renderWidth=Math.max(g.renderWidth,j.width)}h.height=Math.max(h.height,g.renderHeight);for(var i=g.labelWidth=0,l;l=g.titleRow[i];i++)0!=i&&(g.labelWidth+=Blockly.BlockSvg.SEP_SPACE_X),l.getComputedTextLength?g.labelWidth+=l.getComputedTextLength():(l=l.render(),g.labelWidth+=l?l.width:0);h.type==Blockly.BlockSvg.INLINE?1==h.length&&(d.labelValueWidth=Math.max(d.labelValueWidth,g.labelWidth)):h.type==Blockly.INPUT_VALUE||h.type==Blockly.DUMMY_INPUT?(d.hasValue=
!0,d.labelValueWidth=Math.max(d.labelValueWidth,g.labelWidth)):h.type==Blockly.NEXT_STATEMENT&&(d.hasStatement=!0,d.labelStatementWidth=Math.max(d.labelStatementWidth,g.labelWidth))}for(c=0;h=d[c];c++)if(h.thicker=!1,this.block_.inputsInline&&h.type==Blockly.BlockSvg.INLINE)for(e=0;g=h[e];e++)if(g.type==Blockly.INPUT_VALUE){h.height+=2*Blockly.BlockSvg.SEP_SPACE_Y;h.thicker=!0;break}return d};
Blockly.BlockSvg.prototype.renderDraw_=function(c,d){this.block_.inputsInline&&d.hasStatement&&(c=Math.max(c,Blockly.BlockSvg.NOTCH_WIDTH+Blockly.BlockSvg.SEP_SPACE_X));var e=this.block_.getRelativeToSurfaceXY(),f=c;d.hasStatement&&(f=Math.max(f,Blockly.BlockSvg.SEP_SPACE_X+d.labelStatementWidth+Blockly.BlockSvg.SEP_SPACE_X+Blockly.BlockSvg.NOTCH_WIDTH));d.hasValue&&(f=Math.max(f,c+(d.labelValueWidth?d.labelValueWidth+Blockly.BlockSvg.SEP_SPACE_X:0)+Blockly.BlockSvg.TAB_WIDTH));var g=[],h=[],i=[],
j=[];this.renderDrawTop_(g,i,e,f);f=this.renderDrawRight_(g,i,h,j,e,f,d,c);this.renderDrawBottom_(g,i,e,f);this.renderDrawLeft_(g,i,e,f);e=g.join(" ")+"\n"+h.join(" ");this.svgPath_.setAttribute("d",e);this.svgPathDark_.setAttribute("d",e);e=i.join(" ")+"\n"+j.join(" ");this.svgPathLight_.setAttribute("d",e);Blockly.RTL&&(this.svgPath_.setAttribute("transform","scale(-1 1)"),this.svgPathLight_.setAttribute("transform","scale(-1 1)"),this.svgPathDark_.setAttribute("transform","translate(1,1) scale(-1 1)"))};
Blockly.BlockSvg.prototype.renderDrawTop_=function(c,d,e,f){this.block_.outputConnection?(c.push("m 0,0"),d.push("m 1,1")):(c.push("m 0,"+Blockly.BlockSvg.CORNER_RADIUS),Blockly.RTL?d.push("m "+Blockly.BlockSvg.DISTANCE_45_INSIDE+","+Blockly.BlockSvg.DISTANCE_45_INSIDE):d.push("m 1,"+(Blockly.BlockSvg.CORNER_RADIUS-1)),Blockly.BlockSvg.CORNER_RADIUS&&(c.push("A",Blockly.BlockSvg.CORNER_RADIUS+","+Blockly.BlockSvg.CORNER_RADIUS+" 0 0,1 "+Blockly.BlockSvg.CORNER_RADIUS+",0"),d.push("A",Blockly.BlockSvg.CORNER_RADIUS-
1+","+(Blockly.BlockSvg.CORNER_RADIUS-1)+" 0 0,1 "+Blockly.BlockSvg.CORNER_RADIUS+",1")));this.block_.previousConnection&&(c.push("H",Blockly.BlockSvg.NOTCH_WIDTH-15),d.push("H",Blockly.BlockSvg.NOTCH_WIDTH-15),c.push(Blockly.BlockSvg.NOTCH_PATH_LEFT),d.push(Blockly.BlockSvg.NOTCH_PATH_LEFT_HIGHLIGHT),this.block_.previousConnection.moveTo(e.x+(Blockly.RTL?-Blockly.BlockSvg.NOTCH_WIDTH:Blockly.BlockSvg.NOTCH_WIDTH),e.y));c.push("H",f);d.push("H",f+(Blockly.RTL?-1:0))};
Blockly.BlockSvg.prototype.renderDrawRight_=function(c,d,e,f,g,h,i,j){for(var k=0,l=0,m,q,r=0,p;p=i[r];r++){d.push("M",h-1+","+(l+1));if(p.type==Blockly.BlockSvg.INLINE){for(var k=Math.max(j+i.labelValueWidth,i.labelStatementWidth),k=k-p[0].labelWidth,s=0,n;n=p[s];s++)k=Blockly.RTL?-k:k,m=l+18,p.thicker&&(m+=Blockly.BlockSvg.SEP_SPACE_Y),k=this.renderTitles_(n.titleRow,k,m),n.type!=Blockly.DUMMY_INPUT&&(k+=n.renderWidth+Blockly.BlockSvg.SEP_SPACE_X),n.type==Blockly.INPUT_VALUE&&(e.push("M",k-Blockly.BlockSvg.SEP_SPACE_X+
","+(l+Blockly.BlockSvg.SEP_SPACE_Y)),e.push("h",Blockly.BlockSvg.TAB_WIDTH-n.renderWidth),e.push(Blockly.BlockSvg.TAB_PATH_DOWN),e.push("v",n.renderHeight-Blockly.BlockSvg.TAB_HEIGHT),e.push("h",n.renderWidth-Blockly.BlockSvg.TAB_WIDTH),e.push("z"),Blockly.RTL?(f.push("M",k-Blockly.BlockSvg.SEP_SPACE_X+Blockly.BlockSvg.TAB_WIDTH-n.renderWidth-1+","+(l+Blockly.BlockSvg.SEP_SPACE_Y+1)),f.push(Blockly.BlockSvg.TAB_PATH_DOWN_HIGHLIGHT_RTL),f.push("v",n.renderHeight-Blockly.BlockSvg.TAB_HEIGHT+2),f.push("h",
n.renderWidth-Blockly.BlockSvg.TAB_WIDTH)):(f.push("M",k-Blockly.BlockSvg.SEP_SPACE_X+1+","+(l+Blockly.BlockSvg.SEP_SPACE_Y+1)),f.push("v",n.renderHeight),f.push("h",Blockly.BlockSvg.TAB_WIDTH-n.renderWidth),f.push("M",k-n.renderWidth-Blockly.BlockSvg.SEP_SPACE_X+3.8+","+(l+Blockly.BlockSvg.SEP_SPACE_Y+Blockly.BlockSvg.TAB_HEIGHT-0.4)),f.push("l",0.42*Blockly.BlockSvg.TAB_WIDTH+",-1.8")),m=Blockly.RTL?g.x-k-Blockly.BlockSvg.TAB_WIDTH+Blockly.BlockSvg.SEP_SPACE_X+n.renderWidth-1:g.x+k+Blockly.BlockSvg.TAB_WIDTH-
Blockly.BlockSvg.SEP_SPACE_X-n.renderWidth+1,q=g.y+l+Blockly.BlockSvg.SEP_SPACE_Y,n.connection.moveTo(m,q),n.connection.targetConnection&&n.connection.tighten_());c.push("H",k);d.push("H",k+(Blockly.RTL?-1:0));c.push("v",p.height);Blockly.RTL&&d.push("v",p.height-2)}else if(p.type==Blockly.INPUT_VALUE)n=p[0],k=h-Blockly.BlockSvg.TAB_WIDTH-Blockly.BlockSvg.SEP_SPACE_X-n.labelWidth,Blockly.RTL&&(k=-k),m=l+18,this.renderTitles_(n.titleRow,k,m),c.push(Blockly.BlockSvg.TAB_PATH_DOWN),c.push("v",p.height-
Blockly.BlockSvg.TAB_HEIGHT),Blockly.RTL?(d.push(Blockly.BlockSvg.TAB_PATH_DOWN_HIGHLIGHT_RTL),d.push("v",p.height-Blockly.BlockSvg.TAB_HEIGHT)):(d.push("M",h-4.2+","+(l+Blockly.BlockSvg.TAB_HEIGHT-0.4)),d.push("l",0.42*Blockly.BlockSvg.TAB_WIDTH+",-1.8")),m=g.x+(Blockly.RTL?-h-1:h+1),q=g.y+l,n.connection.moveTo(m,q),n.connection.targetConnection&&n.connection.tighten_();else if(p.type==Blockly.DUMMY_INPUT)n=p[0],k=h-Blockly.BlockSvg.TAB_WIDTH-Blockly.BlockSvg.SEP_SPACE_X-n.labelWidth,Blockly.RTL&&
(k=-k),m=l+18,this.renderTitles_(n.titleRow,k,m),c.push("v",p.height),Blockly.RTL&&d.push("v",p.height-2);else if(p.type==Blockly.NEXT_STATEMENT&&(n=p[0],0==r&&(c.push("v",Blockly.BlockSvg.MIN_BLOCK_Y),Blockly.RTL&&d.push("v",Blockly.BlockSvg.MIN_BLOCK_Y-2),l+=Blockly.BlockSvg.MIN_BLOCK_Y),k=Blockly.BlockSvg.SEP_SPACE_X+i.labelStatementWidth-n.labelWidth,Blockly.RTL&&(k=-k),m=l+18,this.renderTitles_(n.titleRow,k,m),k=Blockly.BlockSvg.SEP_SPACE_X+i.labelStatementWidth+Blockly.BlockSvg.SEP_SPACE_X+
Blockly.BlockSvg.NOTCH_WIDTH,c.push("H",k),c.push(Blockly.BlockSvg.NOTCH_PATH_RIGHT+" h -"+(Blockly.BlockSvg.NOTCH_WIDTH-15-Blockly.BlockSvg.CORNER_RADIUS)),Blockly.BlockSvg.CORNER_RADIUS&&c.push("a",Blockly.BlockSvg.CORNER_RADIUS+","+Blockly.BlockSvg.CORNER_RADIUS+" 0 0,0 -"+Blockly.BlockSvg.CORNER_RADIUS+","+Blockly.BlockSvg.CORNER_RADIUS),c.push("v",p.height-2*Blockly.BlockSvg.CORNER_RADIUS),Blockly.BlockSvg.CORNER_RADIUS&&c.push("a",Blockly.BlockSvg.CORNER_RADIUS+","+Blockly.BlockSvg.CORNER_RADIUS+
" 0 0,0 "+Blockly.BlockSvg.CORNER_RADIUS+","+Blockly.BlockSvg.CORNER_RADIUS),c.push("H",h),Blockly.RTL?(d.push("M",k-Blockly.BlockSvg.NOTCH_WIDTH+Blockly.BlockSvg.DISTANCE_45_OUTSIDE+","+(l+Blockly.BlockSvg.DISTANCE_45_OUTSIDE)),d.push("a",Blockly.BlockSvg.CORNER_RADIUS+1+","+(Blockly.BlockSvg.CORNER_RADIUS+1)+" 0 0,0 "+(-Blockly.BlockSvg.DISTANCE_45_OUTSIDE-1)+","+(Blockly.BlockSvg.CORNER_RADIUS-Blockly.BlockSvg.DISTANCE_45_OUTSIDE)),d.push("v",p.height-2*Blockly.BlockSvg.CORNER_RADIUS),d.push("a",
Blockly.BlockSvg.CORNER_RADIUS+1+","+(Blockly.BlockSvg.CORNER_RADIUS+1)+" 0 0,0 "+(Blockly.BlockSvg.CORNER_RADIUS+1)+","+(Blockly.BlockSvg.CORNER_RADIUS+1)),d.push("H",h-1)):(d.push("M",k-Blockly.BlockSvg.NOTCH_WIDTH+Blockly.BlockSvg.DISTANCE_45_OUTSIDE+","+(l+p.height-Blockly.BlockSvg.DISTANCE_45_OUTSIDE)),d.push("a",Blockly.BlockSvg.CORNER_RADIUS+1+","+(Blockly.BlockSvg.CORNER_RADIUS+1)+" 0 0,0 "+(Blockly.BlockSvg.CORNER_RADIUS-Blockly.BlockSvg.DISTANCE_45_OUTSIDE)+","+(Blockly.BlockSvg.DISTANCE_45_OUTSIDE+
1)),d.push("H",h)),m=g.x+(Blockly.RTL?-k:k),q=g.y+l+1,n.connection.moveTo(m,q),n.connection.targetConnection&&n.connection.tighten_(),r==i.length-1||i[r+1].type==Blockly.NEXT_STATEMENT))c.push("v",Blockly.BlockSvg.SEP_SPACE_Y),Blockly.RTL&&d.push("v",Blockly.BlockSvg.SEP_SPACE_Y-1),l+=Blockly.BlockSvg.SEP_SPACE_Y;l+=p.height}i.length||(this.block_.collapsed&&(c.push(Blockly.BlockSvg.JAGGED_TEETH),Blockly.RTL?d.push("l 8,0 0,3.8 7,3.2 m -14.5,9 l 8,4"):d.push("h 8")),c.push("V",Blockly.BlockSvg.MIN_BLOCK_Y),
Blockly.RTL&&d.push("V",Blockly.BlockSvg.MIN_BLOCK_Y-1),l=Blockly.BlockSvg.MIN_BLOCK_Y);return l};
Blockly.BlockSvg.prototype.renderDrawBottom_=function(c,d,e,f){this.block_.nextConnection&&(c.push("H",Blockly.BlockSvg.NOTCH_WIDTH+" "+Blockly.BlockSvg.NOTCH_PATH_RIGHT),this.block_.nextConnection.moveTo(Blockly.RTL?e.x-Blockly.BlockSvg.NOTCH_WIDTH:e.x+Blockly.BlockSvg.NOTCH_WIDTH,e.y+f+1),this.block_.nextConnection.targetConnection&&this.block_.nextConnection.tighten_());this.block_.outputConnection?c.push("H 0"):(c.push("H",Blockly.BlockSvg.CORNER_RADIUS),Blockly.BlockSvg.CORNER_RADIUS&&(c.push("a",
Blockly.BlockSvg.CORNER_RADIUS+","+Blockly.BlockSvg.CORNER_RADIUS+" 0 0,1 -"+Blockly.BlockSvg.CORNER_RADIUS+",-"+Blockly.BlockSvg.CORNER_RADIUS),Blockly.RTL||(d.push("M",Blockly.BlockSvg.DISTANCE_45_INSIDE+","+(f-Blockly.BlockSvg.DISTANCE_45_INSIDE)),d.push("A",Blockly.BlockSvg.CORNER_RADIUS-1+","+(Blockly.BlockSvg.CORNER_RADIUS-1)+" 0 0,1 1,"+(f-Blockly.BlockSvg.CORNER_RADIUS)))))};
Blockly.BlockSvg.prototype.renderDrawLeft_=function(c,d,e,f){this.block_.outputConnection?(c.push("V",Blockly.BlockSvg.TAB_HEIGHT),c.push("c 0,-10 -"+Blockly.BlockSvg.TAB_WIDTH+",8 -"+Blockly.BlockSvg.TAB_WIDTH+",-7.5 s "+Blockly.BlockSvg.TAB_WIDTH+",2.5 "+Blockly.BlockSvg.TAB_WIDTH+",-7.5"),Blockly.RTL?(d.push("M",-0.3*Blockly.BlockSvg.TAB_WIDTH+",8.9"),d.push("l",-0.45*Blockly.BlockSvg.TAB_WIDTH+",-2.1")):(d.push("M","1,"+f),d.push("V",Blockly.BlockSvg.TAB_HEIGHT-1),d.push("m",-0.92*Blockly.BlockSvg.TAB_WIDTH+
",-1 q "+-0.19*Blockly.BlockSvg.TAB_WIDTH+",-5.5 0,-11"),d.push("m",0.92*Blockly.BlockSvg.TAB_WIDTH+",1 V 1 H 2")),this.block_.outputConnection.moveTo(e.x,e.y)):Blockly.RTL||d.push("V",Blockly.BlockSvg.CORNER_RADIUS);c.push("z")};Blockly.Bubble=function(c,d,e,f,g,h,i,j){var k=Blockly.Bubble.ARROW_ANGLE;Blockly.RTL&&(k=-k);this.arrow_radians_=2*k/360*Math.PI;this.content_=d;c.appendChild(this.createDom_(d,i&&j));this.rendered_=!1;this.setAnchorLocation(e,f);this.setBubbleLocation(g,h);if(!i||!j)c=this.content_.getBBox(),i=c.width+2*Blockly.Bubble.BORDER_WIDTH,j=c.height+2*Blockly.Bubble.BORDER_WIDTH;this.setBubbleSize(i,j);this.positionBubble_();this.renderArrow_();this.rendered_=!0;Blockly.bindEvent_(this.bubbleBack_,"mousedown",
this,this.bubbleMouseDown_);this.resizeGroup_&&Blockly.bindEvent_(this.resizeGroup_,"mousedown",this,this.resizeMouseDown_)};Blockly.Bubble.BORDER_WIDTH=6;Blockly.Bubble.ARROW_THICKNESS=10;Blockly.Bubble.ARROW_ANGLE=20;Blockly.Bubble.ARROW_BEND=4;Blockly.Bubble.ANCHOR_RADIUS=8;Blockly.Bubble.onMouseUpWrapper_=null;Blockly.Bubble.onMouseMoveWrapper_=null;Blockly.Bubble.rendered_=!1;
Blockly.Bubble.unbindDragEvents_=function(){Blockly.Bubble.onMouseUpWrapper_&&(Blockly.unbindEvent_(Blockly.Bubble.onMouseUpWrapper_),Blockly.Bubble.onMouseUpWrapper_=null);Blockly.Bubble.onMouseMoveWrapper_&&(Blockly.unbindEvent_(Blockly.Bubble.onMouseMoveWrapper_),Blockly.Bubble.onMouseMoveWrapper_=null)};Blockly.Bubble.prototype.anchorX_=0;Blockly.Bubble.prototype.anchorY_=0;Blockly.Bubble.prototype.relativeLeft_=0;Blockly.Bubble.prototype.relativeTop_=0;Blockly.Bubble.prototype.width_=0;
Blockly.Bubble.prototype.height_=0;
Blockly.Bubble.prototype.createDom_=function(c,d){this.bubbleGroup_=Blockly.createSvgElement("g",{},null);var e=Blockly.createSvgElement("g",{filter:"url(#blocklyEmboss)"},this.bubbleGroup_);this.bubbleArrow_=Blockly.createSvgElement("path",{},e);this.bubbleBack_=Blockly.createSvgElement("rect",{"class":"blocklyDraggable",x:0,y:0,rx:Blockly.Bubble.BORDER_WIDTH,ry:Blockly.Bubble.BORDER_WIDTH},e);d?(this.resizeGroup_=Blockly.createSvgElement("g",{"class":Blockly.RTL?"blocklyResizeSW":"blocklyResizeSE"},
this.bubbleGroup_),e=2*Blockly.Bubble.BORDER_WIDTH,Blockly.createSvgElement("polygon",{points:"0,x x,x x,0".replace(/x/g,e)},this.resizeGroup_),Blockly.createSvgElement("line",{"class":"blocklyResizeLine",x1:e/3,y1:e-1,x2:e-1,y2:e/3},this.resizeGroup_),Blockly.createSvgElement("line",{"class":"blocklyResizeLine",x1:2*e/3,y1:e-1,x2:e-1,y2:2*e/3},this.resizeGroup_)):this.resizeGroup_=null;this.bubbleGroup_.appendChild(c);return this.bubbleGroup_};
Blockly.Bubble.prototype.bubbleMouseDown_=function(c){this.promote_();Blockly.Bubble.unbindDragEvents_();!Blockly.isRightButton(c)&&!Blockly.isTargetInput_(c)&&(Blockly.setCursorHand_(!0),this.dragDeltaX=Blockly.RTL?this.relativeLeft_+c.clientX:this.relativeLeft_-c.clientX,this.dragDeltaY=this.relativeTop_-c.clientY,Blockly.Bubble.onMouseUpWrapper_=Blockly.bindEvent_(Blockly.svgDoc,"mouseup",this,Blockly.Bubble.unbindDragEvents_),Blockly.Bubble.onMouseMoveWrapper_=Blockly.bindEvent_(Blockly.svgDoc,
"mousemove",this,this.bubbleMouseMove_),Blockly.hideChaff(),c.stopPropagation())};Blockly.Bubble.prototype.bubbleMouseMove_=function(c){this.relativeLeft_=Blockly.RTL?this.dragDeltaX-c.clientX:this.dragDeltaX+c.clientX;this.relativeTop_=this.dragDeltaY+c.clientY;this.positionBubble_();this.renderArrow_()};
Blockly.Bubble.prototype.resizeMouseDown_=function(c){this.promote_();Blockly.Bubble.unbindDragEvents_();Blockly.isRightButton(c)||(Blockly.setCursorHand_(!0),this.resizeDeltaWidth=Blockly.RTL?this.width_+c.clientX:this.width_-c.clientX,this.resizeDeltaHeight=this.height_-c.clientY,Blockly.Bubble.onMouseUpWrapper_=Blockly.bindEvent_(Blockly.svgDoc,"mouseup",this,Blockly.Bubble.unbindDragEvents_),Blockly.Bubble.onMouseMoveWrapper_=Blockly.bindEvent_(Blockly.svgDoc,"mousemove",this,this.resizeMouseMove_),
Blockly.hideChaff(),c.stopPropagation())};Blockly.Bubble.prototype.resizeMouseMove_=function(c){var d=this.resizeDeltaWidth,e=this.resizeDeltaHeight+c.clientY,d=Blockly.RTL?d-c.clientX:d+c.clientX;this.setBubbleSize(d,e);Blockly.RTL&&this.positionBubble_()};Blockly.Bubble.prototype.registerResizeEvent=function(c,d){Blockly.bindEvent_(this.bubbleGroup_,"resize",c,d)};Blockly.Bubble.prototype.promote_=function(){this.bubbleGroup_.parentNode.appendChild(this.bubbleGroup_)};
Blockly.Bubble.prototype.setDisabled=function(c){c?this.bubbleGroup_.setAttribute("filter","url(#blocklyGrayscale)"):this.bubbleGroup_.removeAttribute("filter")};Blockly.Bubble.prototype.setAnchorLocation=function(c,d){this.anchorX_=c;this.anchorY_=d;this.rendered_&&this.positionBubble_()};Blockly.Bubble.prototype.getBubbleLocation=function(){return{x:this.relativeLeft_,y:this.relativeTop_}};
Blockly.Bubble.prototype.setBubbleLocation=function(c,d){this.relativeLeft_=c;this.relativeTop_=d;this.rendered_&&this.positionBubble_()};Blockly.Bubble.prototype.positionBubble_=function(){this.bubbleGroup_.setAttribute("transform","translate("+(Blockly.RTL?this.anchorX_-this.relativeLeft_-this.width_:this.anchorX_+this.relativeLeft_)+", "+(this.relativeTop_+this.anchorY_)+")")};Blockly.Bubble.prototype.getBubbleSize=function(){return{width:this.width_,height:this.height_}};
Blockly.Bubble.prototype.setBubbleSize=function(c,d){var e=2*Blockly.Bubble.BORDER_WIDTH,c=Math.max(c,e+45),d=Math.max(d,e+18);this.width_=c;this.height_=d;this.bubbleBack_.setAttribute("width",c);this.bubbleBack_.setAttribute("height",d);this.resizeGroup_&&(Blockly.RTL?this.resizeGroup_.setAttribute("transform","translate("+2*Blockly.Bubble.BORDER_WIDTH+", "+(d-e)+") scale(-1 1)"):this.resizeGroup_.setAttribute("transform","translate("+(c-e)+", "+(d-e)+")"));this.rendered_&&(Blockly.RTL&&this.positionBubble_(),
this.renderArrow_());Blockly.fireUiEvent(this.bubbleGroup_,"resize")};
Blockly.Bubble.prototype.renderArrow_=function(){var c=[],d=this.width_/2,e=this.height_/2,f=-this.relativeLeft_,g=-this.relativeTop_;if(d==f&&e==g)c.push("M "+d+","+e);else{g-=e;f-=d;Blockly.RTL&&(f*=-1);var h=Math.sqrt(g*g+f*f),i=Math.acos(f/h);0>g&&(i=2*Math.PI-i);var j=i+Math.PI/2;j>2*Math.PI&&(j-=2*Math.PI);var k=Math.sin(j),l=Math.cos(j),m=this.getBubbleSize(),j=(m.width+m.height)/Blockly.Bubble.ARROW_THICKNESS,j=Math.min(j,m.width,m.height)/2,m=1-Blockly.Bubble.ANCHOR_RADIUS/h,f=d+m*f,g=e+
m*g,m=d+j*l,q=e+j*k,d=d-j*l,e=e-j*k,k=i+this.arrow_radians_;k>2*Math.PI&&(k-=2*Math.PI);i=Math.sin(k)*h/Blockly.Bubble.ARROW_BEND;h=Math.cos(k)*h/Blockly.Bubble.ARROW_BEND;c.push("M"+m+","+q);c.push("C"+(m+h)+","+(q+i)+" "+f+","+g+" "+f+","+g);c.push("C"+f+","+g+" "+(d+h)+","+(e+i)+" "+d+","+e)}c.push("z");this.bubbleArrow_.setAttribute("d",c.join(" "))};Blockly.Bubble.prototype.setColour=function(c){this.bubbleBack_.setAttribute("fill",c);this.bubbleArrow_.setAttribute("fill",c)};
Blockly.Bubble.prototype.destroy=function(){Blockly.Bubble.unbindDragEvents_();this.bubbleGroup_.parentNode.removeChild(this.bubbleGroup_);this.content_=this.bubbleGroup_=null};Blockly.Comment=function(c){this.block_=c;this.createIcon_();this.setPinned(!1)};Blockly.Comment.ICON_RADIUS=8;Blockly.Comment.prototype.bubble_=null;Blockly.Comment.prototype.text_="";Blockly.Comment.prototype.iconX_=null;Blockly.Comment.prototype.iconY_=null;Blockly.Comment.prototype.relativeLeft_=-100;Blockly.Comment.prototype.relativeTop_=-120;Blockly.Comment.prototype.width_=160;Blockly.Comment.prototype.height_=80;Blockly.Comment.prototype.isPinned_=!1;
Blockly.Comment.prototype.createIcon_=function(){this.iconGroup_=Blockly.createSvgElement("g",{"class":"blocklyIconGroup"},null);Blockly.createSvgElement("circle",{"class":"blocklyIconShield",r:Blockly.Comment.ICON_RADIUS,cx:Blockly.Comment.ICON_RADIUS,cy:Blockly.Comment.ICON_RADIUS},this.iconGroup_);this.iconMark_=Blockly.createSvgElement("text",{"class":"blocklyIconMark",x:Blockly.Comment.ICON_RADIUS/2+0.5,y:2*Blockly.Comment.ICON_RADIUS-3},this.iconGroup_);this.iconMark_.appendChild(Blockly.svgDoc.createTextNode("?"));
this.block_.getSvgRoot().appendChild(this.iconGroup_);Blockly.bindEvent_(this.iconGroup_,"mouseup",this,this.iconClick_);Blockly.bindEvent_(this.iconGroup_,"mouseover",this,this.iconMouseOver_);Blockly.bindEvent_(this.iconGroup_,"mouseout",this,this.iconMouseOut_)};
Blockly.Comment.prototype.createEditor_=function(){this.foreignObject_=Blockly.createSvgElement("foreignObject",{x:Blockly.Bubble.BORDER_WIDTH,y:Blockly.Bubble.BORDER_WIDTH},null);var c=Blockly.svgDoc.createElementNS(Blockly.HTML_NS,"body");c.setAttribute("xmlns",Blockly.HTML_NS);c.className="blocklyMinimalBody";this.textarea_=Blockly.svgDoc.createElementNS(Blockly.HTML_NS,"textarea");this.textarea_.className="blocklyCommentTextarea";this.textarea_.setAttribute("dir",Blockly.RTL?"RTL":"LTR");c.appendChild(this.textarea_);
this.foreignObject_.appendChild(c);Blockly.bindEvent_(this.textarea_,"mouseup",this,this.textareaFocus_);return this.foreignObject_};Blockly.Comment.prototype.resizeBubble_=function(){var c=this.bubble_.getBubbleSize(),d=2*Blockly.Bubble.BORDER_WIDTH;this.foreignObject_.setAttribute("width",c.width-d);this.foreignObject_.setAttribute("height",c.height-d);this.textarea_.style.width=c.width-d-4+"px";this.textarea_.style.height=c.height-d-4+"px"};Blockly.Comment.prototype.isPinned=function(){return this.isPinned_};
Blockly.Comment.prototype.setPinned=function(c){this.isPinned_=c;this.iconMark_.style.fill=c?"#fff":"";this.bubble_&&this.bubble_.setDisabled(!this.isPinned_)};Blockly.Comment.prototype.isVisible_=function(){return!!this.bubble_};
Blockly.Comment.prototype.setVisible_=function(c){if(c!=this.isVisible_()){var d=this.getText(),e=this.getBubbleLocation(),f=this.getBubbleSize();c?(this.bubble_=new Blockly.Bubble(this.block_.workspace.getBubbleCanvas(),this.createEditor_(),this.iconX_,this.iconY_,this.relativeLeft_,this.relativeTop_,this.width_,this.height_),this.bubble_.registerResizeEvent(this,this.resizeBubble_),this.bubble_.setDisabled(!this.isPinned_),this.updateColour(),this.text_=null):(this.bubble_.destroy(),this.foreignObject_=
this.textarea_=this.bubble_=null);this.setText(d);this.setBubbleLocation(e.x,e.y);this.setBubbleSize(f.width,f.height)}};Blockly.Comment.prototype.iconClick_=function(){this.setPinned(!this.isPinned_)};Blockly.Comment.prototype.iconMouseOver_=function(){!this.isPinned_&&0==Blockly.Block.dragMode_&&this.setVisible_(!0)};Blockly.Comment.prototype.iconMouseOut_=function(){!this.isPinned_&&0==Blockly.Block.dragMode_&&this.setVisible_(!1)};
Blockly.Comment.prototype.textareaFocus_=function(){this.bubble_.promote_();this.textarea_.focus()};Blockly.Comment.prototype.getBubbleLocation=function(){return this.isVisible_()?this.bubble_.getBubbleLocation():{x:this.relativeLeft_,y:this.relativeTop_}};Blockly.Comment.prototype.setBubbleLocation=function(c,d){this.isVisible_()?this.bubble_.setBubbleLocation(c,d):(this.relativeLeft_=c,this.relativeTop_=d)};
Blockly.Comment.prototype.getBubbleSize=function(){return this.isVisible_()?this.bubble_.getBubbleSize():{width:this.width_,height:this.height_}};Blockly.Comment.prototype.setBubbleSize=function(c,d){this.isVisible_()?this.bubble_.setBubbleSize(c,d):(this.width_=c,this.height_=d)};Blockly.Comment.prototype.getText=function(){return this.isVisible_()?this.textarea_.value:this.text_};Blockly.Comment.prototype.setText=function(c){this.isVisible_()?this.textarea_.value=c:this.text_=c};
Blockly.Comment.prototype.updateColour=function(){if(this.isVisible_()){var c=Blockly.makeColour(this.block_.getColour());this.bubble_.setColour(c)}};Blockly.Comment.prototype.destroy=function(){this.iconGroup_.parentNode.removeChild(this.iconGroup_);this.iconGroup_=null;this.setVisible_(!1);this.block_=this.block_.comment=null};
Blockly.Comment.prototype.renderIcon=function(c){if(this.block_.collapsed)return this.iconGroup_.setAttribute("display","none"),0;this.iconGroup_.setAttribute("display","block");var d=2*Blockly.Comment.ICON_RADIUS;Blockly.RTL&&(c-=d);this.iconGroup_.setAttribute("transform","translate("+c+", 5)");this.computeIconLocation();return d};Blockly.Comment.prototype.setIconLocation=function(c,d){this.iconX_=c;this.iconY_=d;this.isVisible_()&&this.bubble_.setAnchorLocation(c,d)};
Blockly.Comment.prototype.computeIconLocation=function(){var c=this.block_.getRelativeToSurfaceXY(),d=Blockly.getRelativeXY_(this.iconGroup_),e=c.x+d.x+Blockly.Comment.ICON_RADIUS,c=c.y+d.y+Blockly.Comment.ICON_RADIUS;(e!==this.iconX_||c!==this.iconY_)&&this.setIconLocation(e,c)};Blockly.Comment.prototype.getIconLocation=function(){return{x:this.iconX_,y:this.iconY_}};Blockly.Connection=function(c,d,e){this.sourceBlock_=c;this.targetConnection=null;this.type=d;e?(e instanceof Array||(e=[e]),this.check_=e):this.check_=null;this.y_=this.x_=0;this.inDB_=!1;this.dbList_=this.sourceBlock_.workspace.connectionDBList};
Blockly.Connection.prototype.destroy=function(){if(this.targetConnection)throw"Disconnect connection before destroying it.";this.inDB_&&this.dbList_[this.type].removeConnection_(this);this.inDB_=!1;Blockly.highlightedConnection_==this&&(Blockly.highlightedConnection_=null);Blockly.localConnection_==this&&(Blockly.localConnection_=null)};Blockly.Connection.prototype.isSuperior=function(){return this.type==Blockly.INPUT_VALUE||this.type==Blockly.NEXT_STATEMENT};
Blockly.Connection.prototype.connect=function(c){if(this.sourceBlock_==c.sourceBlock_)throw"Attempted to connect a block to itself.";if(this.sourceBlock_.workspace!==c.sourceBlock_.workspace)throw"Blocks are on different workspaces.";if(Blockly.OPPOSITE_TYPE[this.type]!=c.type)throw"Attempt to connect incompatible types.";if(this.type==Blockly.INPUT_VALUE||this.type==Blockly.OUTPUT_VALUE){if(this.targetConnection)throw"Source connection already connected (value).";if(c.targetConnection){var d=c.targetBlock();
d.setParent(null);for(var e=function(c){for(var e=!1,f=0;f<c.inputList.length;f++){var j=c.inputList[f].connection;if(j&&j.type==Blockly.INPUT_VALUE&&d.outputConnection.checkType_(j)){if(e)return null;e=j}}return e},f=this.sourceBlock_;f=e(f);)if(f.targetBlock())f=f.targetBlock();else{f.connect(d.outputConnection);d=null;break}d&&window.setTimeout(function(){d.outputConnection.bumpAwayFrom_(c)},Blockly.BUMP_DELAY)}}else{if(this.targetConnection)throw"Source connection already connected (block).";
if(c.targetConnection){if(this.type!=Blockly.PREVIOUS_STATEMENT)throw"Can only do a mid-stack connection with the top of a block.";d=c.targetBlock();d.setParent(null);for(f=this.sourceBlock_;f.nextConnection;)if(f.nextConnection.targetConnection)f=f.nextConnection.targetBlock();else{f.nextConnection.connect(d.previousConnection);d=null;break}d&&window.setTimeout(function(){d.previousConnection.bumpAwayFrom_(c)},Blockly.BUMP_DELAY)}}this.isSuperior()?(e=this.sourceBlock_,f=c.sourceBlock_):(e=c.sourceBlock_,
f=this.sourceBlock_);this.targetConnection=c;c.targetConnection=this;f.setParent(e);e.rendered&&(e.svg_.updateDisabled(),e.render());f.rendered&&f.svg_.updateDisabled()};
Blockly.Connection.prototype.disconnect=function(){var c=this.targetConnection;if(c){if(c.targetConnection!=this)throw"Target connection not connected to source connection.";}else throw"Source connection not connected.";this.targetConnection=c.targetConnection=null;var d;this.isSuperior()?(d=this.sourceBlock_,c=c.sourceBlock_):(d=c.sourceBlock_,c=this.sourceBlock_);d.rendered&&d.render();c.rendered&&c.svg_.updateDisabled()};
Blockly.Connection.prototype.targetBlock=function(){return this.targetConnection?this.targetConnection.sourceBlock_:null};
Blockly.Connection.prototype.bumpAwayFrom_=function(c){if(0==Blockly.Block.dragMode_){var d=this.sourceBlock_.getRootBlock(),e=!1;if(!d.editable){d=c.sourceBlock_.getRootBlock();if(!d.editable)return;c=this;e=!0}d.getSvgRoot().parentNode.appendChild(d.getSvgRoot());var f=c.x_+Blockly.SNAP_RADIUS-this.x_,c=c.y_+2*Blockly.SNAP_RADIUS-this.y_;e&&(c=-c);Blockly.RTL&&(f=-f);d.moveBy(f,c)}};
Blockly.Connection.prototype.moveTo=function(c,d){this.inDB_&&this.dbList_[this.type].removeConnection_(this);this.x_=c;this.y_=d;this.dbList_[this.type].addConnection_(this)};Blockly.Connection.prototype.moveBy=function(c,d){this.moveTo(this.x_+c,this.y_+d)};
Blockly.Connection.prototype.highlight=function(){var c;this.type==Blockly.INPUT_VALUE||this.type==Blockly.OUTPUT_VALUE?(c=Blockly.RTL?-Blockly.BlockSvg.TAB_WIDTH:Blockly.BlockSvg.TAB_WIDTH,c="m 0,0 v 5 c 0,10 "+-c+",-8 "+-c+",7.5 s "+c+",-2.5 "+c+",7.5 v 5"):c=Blockly.RTL?"m 20,0 h -5 l -6,4 -3,0 -6,-4 h -5":"m -20,0 h 5 l 6,4 3,0 6,-4 h 5";var d=this.sourceBlock_.getRelativeToSurfaceXY();Blockly.Connection.highlightedPath_=Blockly.createSvgElement("path",{"class":"blocklyHighlightedConnectionPath",
d:c,transform:"translate("+(this.x_-d.x)+", "+(this.y_-d.y)+")"},this.sourceBlock_.getSvgRoot())};Blockly.Connection.prototype.unhighlight=function(){var c=Blockly.Connection.highlightedPath_;c.parentNode.removeChild(c);delete Blockly.Connection.highlightedPath_};
Blockly.Connection.prototype.tighten_=function(){var c=Math.round(this.targetConnection.x_-this.x_),d=Math.round(this.targetConnection.y_-this.y_);if(0!=c||0!=d){var e=this.targetBlock(),f=Blockly.getRelativeXY_(e.getSvgRoot());e.getSvgRoot().setAttribute("transform","translate("+(f.x-c)+", "+(f.y-d)+")");e.moveConnections_(-c,-d)}};
Blockly.Connection.prototype.closest=function(c,d,e){function f(d){var e=g[d];if((e.type==Blockly.OUTPUT_VALUE||e.type==Blockly.PREVIOUS_STATEMENT)&&e.targetConnection||!m.checkType_(e))return!0;e=e.sourceBlock_;do{if(l==e)return!0;e=e.getParent()}while(e);var f=h-g[d].x_,e=i-g[d].y_,f=Math.sqrt(f*f+e*e);f<=c&&(k=g[d],c=f);return e<c}if(this.targetConnection)return{connection:null,radius:c};for(var g=this.dbList_[Blockly.OPPOSITE_TYPE[this.type]],h=this.x_+d,i=this.y_+e,d=0,j=e=g.length-2;d<j;)g[j].y_<
i?d=j:e=j,j=Math.floor((d+e)/2);var e=d=j,k=null,l=this.sourceBlock_,m=this;if(g.length){for(;0<=d&&f(d);)d--;do e++;while(e<g.length&&f(e))}return{connection:k,radius:c}};Blockly.Connection.prototype.checkType_=function(c){if(!this.check_||!c.check_)return!0;for(var d=0;d<this.check_.length;d++)if(-1!=c.check_.indexOf(this.check_[d]))return!0;return!1};
Blockly.Connection.prototype.neighbours_=function(c){function d(d){var h=f-e[d].x_,i=g-e[d].y_;Math.sqrt(h*h+i*i)<=c&&k.push(e[d]);return i<c}for(var e=this.dbList_[Blockly.OPPOSITE_TYPE[this.type]],f=this.x_,g=this.y_,h=0,i=e.length-2,j=i;h<j;)e[j].y_<g?h=j:i=j,j=Math.floor((h+i)/2);var i=h=j,k=[];if(e.length){for(;0<=h&&d(h);)h--;do i++;while(i<e.length&&d(i))}return k};
Blockly.Connection.prototype.hideAll=function(){this.inDB_&&this.dbList_[this.type].removeConnection_(this);if(this.targetConnection)for(var c=this.targetBlock().getDescendants(),d=0;d<c.length;d++){for(var e=c[d],f=e.getConnections_(!0),g=0;g<f.length;g++){var h=f[g];h.inDB_&&this.dbList_[h.type].removeConnection_(h)}e.comment&&e.comment.setVisible_(!1)}};
Blockly.Connection.prototype.unhideAll=function(){this.inDB_||this.dbList_[this.type].addConnection_(this);var c=[];if(this.type!=Blockly.INPUT_VALUE&&this.type!=Blockly.NEXT_STATEMENT)return c;var d=this.targetBlock();if(d){var e;d.collapsed?(e=[],d.outputConnection&&e.push(d.outputConnection),d.nextConnection&&e.push(d.nextConnection),d.previousConnection&&e.push(d.previousConnection)):e=d.getConnections_(!0);for(var f=0;f<e.length;f++)c=c.concat(e[f].unhideAll());0==c.length&&(c[0]=d);d.comment&&
d.comment.isPinned()&&d.comment.setVisible_(!0)}return c};Blockly.ConnectionDB=function(){};Blockly.ConnectionDB.prototype=[];Blockly.ConnectionDB.prototype.addConnection_=function(c){if(c.inDB_)throw"Connection already in database.";for(var d=0,e=this.length;d<e;){var f=Math.floor((d+e)/2);if(this[f].y_<c.y_)d=f+1;else if(this[f].y_>c.y_)e=f;else{d=f;break}}this.splice(d,0,c);c.inDB_=!0};
Blockly.ConnectionDB.prototype.removeConnection_=function(c){if(!c.inDB_)throw"Connection not in database.";c.inDB_=!1;for(var d=0,e=this.length-2,f=e;d<f;)this[f].y_<c.y_?d=f:e=f,f=Math.floor((d+e)/2);for(e=d=f;0<=d&&this[d].y_==c.y_;){if(this[d]==c){this.splice(d,1);return}d--}do{if(this[e]==c){this.splice(e,1);return}e++}while(e<this.length&&this[e].y_==c.y_);throw"Unable to find connection in connectionDB.";};
Blockly.ConnectionDB.init=function(c){var d=[];d[Blockly.INPUT_VALUE]=new Blockly.ConnectionDB;d[Blockly.OUTPUT_VALUE]=new Blockly.ConnectionDB;d[Blockly.NEXT_STATEMENT]=new Blockly.ConnectionDB;d[Blockly.PREVIOUS_STATEMENT]=new Blockly.ConnectionDB;c.connectionDBList=d};Blockly.ContextMenu={};Blockly.ContextMenu.X_PADDING=20;Blockly.ContextMenu.Y_HEIGHT=20;Blockly.ContextMenu.visible=!1;
Blockly.ContextMenu.createDom=function(){var c=Blockly.createSvgElement("g",{"class":"blocklyHidden"},null);Blockly.ContextMenu.svgGroup=c;Blockly.ContextMenu.svgShadow=Blockly.createSvgElement("rect",{"class":"blocklyContextMenuShadow",x:2,y:-2,rx:4,ry:4},c);Blockly.ContextMenu.svgBackground=Blockly.createSvgElement("rect",{"class":"blocklyContextMenuBackground",y:-4,rx:4,ry:4},c);Blockly.ContextMenu.svgOptions=Blockly.createSvgElement("g",{"class":"blocklyContextMenuOptions"},c);return c};
Blockly.ContextMenu.show=function(c,d,e){if(0==e.length)Blockly.ContextMenu.hide();else{Blockly.removeChildren_(Blockly.ContextMenu.svgOptions);Blockly.ContextMenu.svgGroup.style.display="block";for(var f=0,g=[Blockly.ContextMenu.svgBackground,Blockly.ContextMenu.svgShadow],h=0,i;i=e[h];h++){var j=Blockly.ContextMenu.optionToDom(i.text),k=j.firstChild,l=j.lastChild;Blockly.ContextMenu.svgOptions.appendChild(j);j.setAttribute("transform","translate(0, "+h*Blockly.ContextMenu.Y_HEIGHT+")");g.push(k);
Blockly.bindEvent_(j,"mousedown",null,Blockly.noEvent);i.enabled?(Blockly.bindEvent_(j,"mouseup",null,i.callback),Blockly.bindEvent_(j,"mouseup",null,Blockly.ContextMenu.hide)):j.setAttribute("class","blocklyMenuDivDisabled");f=Math.max(f,l.getComputedTextLength())}f+=2*Blockly.ContextMenu.X_PADDING;for(h=0;h<g.length;h++)g[h].setAttribute("width",f);if(Blockly.RTL)for(h=0;j=Blockly.ContextMenu.svgOptions.childNodes[h];h++)l=j.lastChild,l.setAttribute("text-anchor","end"),l.setAttribute("x",f-Blockly.ContextMenu.X_PADDING);
Blockly.ContextMenu.svgBackground.setAttribute("height",e.length*Blockly.ContextMenu.Y_HEIGHT+8);Blockly.ContextMenu.svgShadow.setAttribute("height",e.length*Blockly.ContextMenu.Y_HEIGHT+10);d=Blockly.mouseToSvg(c,d);c=d.x;d=d.y;e=Blockly.ContextMenu.svgGroup.getBBox();f=Blockly.svgSize();d+e.height>f.height&&(d-=e.height-10);Blockly.RTL?0>=c-e.width?c++:c-=e.width:c+e.width>f.width?c-=e.width:c++;Blockly.ContextMenu.svgGroup.setAttribute("transform","translate("+c+", "+d+")");Blockly.ContextMenu.visible=
!0}};Blockly.ContextMenu.optionToDom=function(c){var d=Blockly.createSvgElement("g",{"class":"blocklyMenuDiv"},null);Blockly.createSvgElement("rect",{height:Blockly.ContextMenu.Y_HEIGHT},d);var e=Blockly.createSvgElement("text",{"class":"blocklyMenuText",x:Blockly.ContextMenu.X_PADDING,y:15},d),c=Blockly.svgDoc.createTextNode(c);e.appendChild(c);return d};
Blockly.ContextMenu.hide=function(){Blockly.ContextMenu.visible&&(Blockly.ContextMenu.svgGroup.style.display="none",Blockly.ContextMenu.visible=!1)};Blockly.Field=function(c){null!==c&&(this.sourceBlock_=null,this.group_=Blockly.createSvgElement("g",{},null),this.borderRect_=Blockly.createSvgElement("rect",{rx:4,ry:4},this.group_),this.textElement_=Blockly.createSvgElement("text",{"class":"blocklyText"},this.group_),this.CURSOR&&(this.group_.style.cursor=this.CURSOR),this.setText(c))};Blockly.Field.NBSP="\u00a0";Blockly.Field.prototype.EDITABLE=!0;
Blockly.Field.prototype.init=function(c){if(this.sourceBlock_)throw"Field has already been initialized once.";this.sourceBlock_=c;this.group_.setAttribute("class",c.editable?"blocklyEditableText":"blocklyNonEditableText");c.getSvgRoot().appendChild(this.group_);c.editable&&(this.mouseUpWrapper_=Blockly.bindEvent_(this.group_,"mouseup",this,this.onMouseUp_))};
Blockly.Field.prototype.destroy=function(){this.mouseUpWrapper_&&(Blockly.unbindEvent_(this.mouseUpWrapper_),this.mouseUpWrapper_=null);this.sourceBlock_=null;this.group_.parentNode.removeChild(this.group_);this.borderRect_=this.textElement_=this.group_=null};Blockly.Field.prototype.setVisible=function(c){this.getRootElement().style.display=c?"block":"none"};Blockly.Field.prototype.getRootElement=function(){return this.group_};
Blockly.Field.prototype.render=function(){try{var c=this.textElement_.getBBox()}catch(d){return null}0==c.height&&(c.height=18);var e=c.height,f=c.x-Blockly.BlockSvg.SEP_SPACE_X/2,g=c.y;this.borderRect_.setAttribute("width",c.width+Blockly.BlockSvg.SEP_SPACE_X);this.borderRect_.setAttribute("height",e);this.borderRect_.setAttribute("x",f);this.borderRect_.setAttribute("y",g);return c};Blockly.Field.prototype.width=function(){var c=this.render();return!c||-Infinity==c.width?0:c.width};
Blockly.Field.prototype.getText=function(){return this.text_};Blockly.Field.prototype.setText=function(c){this.text_=c;Blockly.removeChildren_(this.textElement_);c=c.replace(/\s/g,Blockly.Field.NBSP);c||(c=Blockly.Field.NBSP);c=Blockly.svgDoc.createTextNode(c);this.textElement_.appendChild(c);this.sourceBlock_&&this.sourceBlock_.rendered&&(this.sourceBlock_.render(),this.sourceBlock_.bumpNeighbours_(),this.sourceBlock_.workspace.fireChangeEvent())};Blockly.Field.prototype.getValue=function(){return this.getText()};
Blockly.Field.prototype.setValue=function(c){this.setText(c)};Blockly.Field.prototype.onMouseUp_=function(c){Blockly.isRightButton(c)||2!=Blockly.Block.dragMode_&&this.showEditor_()};Blockly.Field.prototype.setTooltip=function(){};Blockly.FieldDropdown=function(c,d){this.menuGenerator_=c;this.changeHandler_=d;var e=this.getOptions_()[0][0];Blockly.Field.call(this,e)};Blockly.FieldDropdown.prototype=new Blockly.Field(null);
Blockly.FieldDropdown.createDom=function(){var c=Blockly.createSvgElement("g",{"class":"blocklyHidden"},null);Blockly.FieldDropdown.svgGroup_=c;Blockly.FieldDropdown.svgShadow_=Blockly.createSvgElement("rect",{"class":"blocklyDropdownMenuShadow",x:0,y:1,rx:2,ry:2},c);Blockly.FieldDropdown.svgBackground_=Blockly.createSvgElement("rect",{x:-2,y:-1,rx:2,ry:2,filter:"url(#blocklyEmboss)"},c);Blockly.FieldDropdown.svgOptions_=Blockly.createSvgElement("g",{"class":"blocklyDropdownMenuOptions"},c);return c};
Blockly.FieldDropdown.prototype.destroy=function(){Blockly.FieldDropdown.openDropdown_==this&&Blockly.FieldDropdown.hideMenu();Blockly.Field.prototype.destroy.call(this)};Blockly.FieldDropdown.CORNER_RADIUS=2;Blockly.FieldDropdown.prototype.CURSOR="default";Blockly.FieldDropdown.openDropdown_=null;
Blockly.FieldDropdown.prototype.showEditor_=function(){function c(c){return function(d){this.changeHandler_?this.changeHandler_(c):this.setText(c);d.stopPropagation()}}var d=Blockly.FieldDropdown.svgGroup_,e=Blockly.FieldDropdown.svgOptions_,f=Blockly.FieldDropdown.svgBackground_,g=Blockly.FieldDropdown.svgShadow_;Blockly.removeChildren_(e);d.style.display="block";Blockly.FieldDropdown.openDropdown_=this;for(var h=0,i=[],j=null,k=this.getOptions_(),l=0;l<k.length;l++){var m=k[l][0],q=Blockly.ContextMenu.optionToDom(m),
r=q.firstChild,p=q.lastChild;e.appendChild(q);!j&&m==this.text_&&(j=Blockly.createSvgElement("text",{"class":"blocklyMenuText",y:15},null),q.insertBefore(j,p),j.appendChild(Blockly.svgDoc.createTextNode("\u2713")));q.setAttribute("transform","translate(0, "+l*Blockly.ContextMenu.Y_HEIGHT+")");i.push(r);Blockly.bindEvent_(q,"mousedown",null,Blockly.noEvent);Blockly.bindEvent_(q,"mouseup",this,c(m));Blockly.bindEvent_(q,"mouseup",null,Blockly.FieldDropdown.hideMenu);h=Math.max(h,p.getComputedTextLength())}h+=
2*Blockly.ContextMenu.X_PADDING;for(l=0;l<i.length;l++)i[l].setAttribute("width",h);if(Blockly.RTL)for(l=0;q=e.childNodes[l];l++)p=q.lastChild,p.setAttribute("text-anchor","end"),p.setAttribute("x",h-Blockly.ContextMenu.X_PADDING);j&&(Blockly.RTL?(j.setAttribute("text-anchor","end"),j.setAttribute("x",h-5)):j.setAttribute("x",5));l=h+2*Blockly.FieldDropdown.CORNER_RADIUS;k=k.length*Blockly.ContextMenu.Y_HEIGHT+Blockly.FieldDropdown.CORNER_RADIUS+1;g.setAttribute("width",l);g.setAttribute("height",
k);f.setAttribute("width",l);f.setAttribute("height",k);g=Blockly.makeColour(this.sourceBlock_.getColour());f.setAttribute("fill",g);f=Blockly.getAbsoluteXY_(this.borderRect_);g=this.borderRect_.getBBox();l=Blockly.RTL?f.x-h+Blockly.ContextMenu.X_PADDING+g.width-Blockly.BlockSvg.SEP_SPACE_X/2:f.x-Blockly.ContextMenu.X_PADDING+Blockly.BlockSvg.SEP_SPACE_X/2;d.setAttribute("transform","translate("+l+", "+(f.y+g.height)+")")};
Blockly.FieldDropdown.prototype.getOptions_=function(){return"function"==typeof this.menuGenerator_?this.menuGenerator_.call(this):this.menuGenerator_};Blockly.FieldDropdown.prototype.getValue=function(){for(var c=this.text_,d=this.getOptions_(),e=0;e<d.length;e++)if(d[e][0]==c)return d[e][1];throw'"'+c+'" not valid in dropdown.';};Blockly.FieldDropdown.prototype.setValue=function(c){for(var d=this.getOptions_(),e=0;e<d.length;e++)if(d[e][1]==c){this.setText(d[e][0]);return}this.setText(c)};
Blockly.FieldDropdown.hideMenu=function(){Blockly.FieldDropdown.svgGroup_.style.display="none";Blockly.FieldDropdown.openDropdown_=null};Blockly.FieldLabel=function(c){this.sourceBlock_=null;this.textElement_=Blockly.createSvgElement("text",{"class":"blocklyText"},null);this.setText(c)};Blockly.FieldLabel.prototype=new Blockly.Field(null);Blockly.FieldLabel.prototype.EDITABLE=!1;Blockly.FieldLabel.prototype.init=function(c){if(this.sourceBlock_)throw"Text has already been initialized once.";this.sourceBlock_=c;c.getSvgRoot().appendChild(this.textElement_);this.textElement_.tooltip=this.sourceBlock_;Blockly.Tooltip&&Blockly.Tooltip.bindMouseEvents(this.textElement_)};
Blockly.FieldLabel.prototype.destroy=function(){this.textElement_.parentNode.removeChild(this.textElement_);this.textElement_=null};Blockly.FieldLabel.prototype.getRootElement=function(){return this.textElement_};Blockly.FieldLabel.prototype.render=function(){try{var c=this.textElement_.getBBox()}catch(d){return null}0==c.height&&(c.height=18);return c};Blockly.FieldLabel.prototype.setTooltip=function(c){this.textElement_.tooltip=c};Blockly.FieldTextInput=function(c,d){Blockly.Field.call(this,c);this.validationFunc_=d};Blockly.FieldTextInput.prototype=new Blockly.Field(null);Blockly.FieldTextInput.prototype.setText=function(c){if(this.validationFunc_){var d=this.validationFunc_(c);null!==d&&(c=d)}Blockly.Field.prototype.setText.call(this,c)};
Blockly.FieldTextInput.injectDom_=function(c){c=Blockly.createSvgElement("foreignObject",{height:22},c);Blockly.FieldTextInput.svgForeignObject_=c;var d=Blockly.svgDoc.createElement("body");d.className="blocklyMinimalBody";var e=Blockly.svgDoc.createElement("input");e.className="blocklyHtmlInput";e.style.border="none";e.style.outline="none";Blockly.FieldTextInput.htmlInput_=e;d.appendChild(e);c.appendChild(d)};
Blockly.FieldTextInput.destroyDom_=function(){var c=Blockly.FieldTextInput.svgForeignObject_;c.parentNode.removeChild(c);Blockly.FieldTextInput.svgForeignObject_=null;Blockly.FieldTextInput.htmlInput_=null};Blockly.FieldTextInput.prototype.CURSOR="text";
Blockly.FieldTextInput.prototype.showEditor_=function(){if(window.opera){var c=window.prompt(Blockly.MSG_CHANGE_VALUE_TITLE,this.text_);this.validationFunc_&&(c=this.validationFunc_(c));null!==c&&this.setText(c)}else{var d=this.sourceBlock_.workspace.getCanvas();Blockly.FieldTextInput.injectDom_(d);c=Blockly.FieldTextInput.htmlInput_;c.value=c.defaultValue=this.text_;c.oldValue_=null;var e=Blockly.FieldTextInput.svgForeignObject_,f=Blockly.getAbsoluteXY_(this.borderRect_),d=Blockly.getAbsoluteXY_(d);
f.x-=d.x;f.y-=d.y;Blockly.RTL||e.setAttribute("x",f.x+1);-1!=window.navigator.userAgent.indexOf("Gecko/")?e.setAttribute("y",f.y-1):e.setAttribute("y",f.y-3);c.focus();c.select();c.onBlurWrapper_=Blockly.bindEvent_(c,"blur",this,this.onHtmlInputBlur_);c.onKeyUpWrapper_=Blockly.bindEvent_(c,"keyup",this,this.onHtmlInputKeyUp_);c.onKeyPressWrapper_=Blockly.bindEvent_(c,"keypress",this,this.resizeEditor_);this.resizeEditor_();this.validate_()}};Blockly.FieldTextInput.prototype.onHtmlInputBlur_=function(){this.closeEditor_(!0)};
Blockly.FieldTextInput.prototype.onHtmlInputKeyUp_=function(c){13==c.keyCode?this.closeEditor_(!0):27==c.keyCode?this.closeEditor_(!1):(this.resizeEditor_(),this.validate_())};Blockly.FieldTextInput.prototype.validate_=function(){var c=!0,d=Blockly.FieldTextInput.htmlInput_;this.validationFunc_&&(c=this.validationFunc_(d.value));c?Blockly.removeClass_(d,"blocklyInvalidInput"):Blockly.addClass_(d,"blocklyInvalidInput")};
Blockly.FieldTextInput.prototype.resizeEditor_=function(){var c=Blockly.FieldTextInput.htmlInput_,d=c.value;if(d!==c.oldValue_){c.oldValue_=d;this.setText(d);var e=this.group_.getBBox(),d=Blockly.FieldTextInput.svgForeignObject_;d.setAttribute("width",e.width);c.style.width=e.width-2+"px";Blockly.RTL&&(c=Blockly.getAbsoluteXY_(this.group_),e=this.sourceBlock_.workspace.getCanvas(),e=Blockly.getAbsoluteXY_(e),c.x-=e.x,d.setAttribute("x",c.x-4))}};
Blockly.FieldTextInput.prototype.closeEditor_=function(c){var d=Blockly.FieldTextInput.htmlInput_;Blockly.unbindEvent_(d.onBlurWrapper_);Blockly.unbindEvent_(d.onKeyUpWrapper_);Blockly.unbindEvent_(d.onKeyPressWrapper_);c?(c=d.value,this.validationFunc_&&(c=this.validationFunc_(c),null===c&&(c=d.defaultValue))):c=d.defaultValue;this.setText(c);Blockly.FieldTextInput.destroyDom_();this.sourceBlock_.render()};Blockly.FieldVariable=function(c){Blockly.FieldDropdown.call(this,Blockly.FieldVariable.dropdownCreate,Blockly.FieldVariable.dropdownChange);c?this.setText(c):this.setText(Blockly.Variables.generateUniqueName())};Blockly.FieldVariable.prototype=new Blockly.FieldDropdown([[null]]);Blockly.FieldVariable.prototype.getValue=function(){return this.getText()};Blockly.FieldVariable.prototype.setValue=function(c){this.setText(c)};
Blockly.FieldVariable.dropdownCreate=function(){var c=Blockly.Variables.allVariables(),d=this.getText();d&&-1==c.indexOf(d)&&c.push(d);c.sort(Blockly.caseInsensitiveComparator);c.push(Blockly.MSG_RENAME_VARIABLE);c.push(Blockly.MSG_NEW_VARIABLE);for(var d=[],e=0;e<c.length;e++)d[e]=[c[e],c[e]];return d};
Blockly.FieldVariable.dropdownChange=function(c){function d(c,d){Blockly.hideChaff();var e=window.prompt(c,d);return e&&e.replace(/[\s\xa0]+/g," ").replace(/^ | $/g,"")}if(c==Blockly.MSG_RENAME_VARIABLE){var e=this.getText();(c=d(Blockly.MSG_RENAME_VARIABLE_TITLE.replace("%1",e),e))&&Blockly.Variables.renameVariable(e,c)}else c==Blockly.MSG_NEW_VARIABLE&&(c=d(Blockly.MSG_NEW_VARIABLE_TITLE,""),Blockly.Variables.renameVariable(c,c)),c&&this.setText(c);window.setTimeout(Blockly.Variables.refreshFlyoutCategory,
1)};Blockly.Flyout=function(){this.workspace_=new Blockly.Workspace(!1)};Blockly.Flyout.prototype.autoClose=!0;Blockly.Flyout.prototype.CORNER_RADIUS=8;Blockly.Flyout.prototype.onResizeWrapper_=null;
Blockly.Flyout.prototype.createDom=function(){this.svgGroup_=Blockly.createSvgElement("g",{},null);this.svgBackground_=Blockly.createSvgElement("path",{"class":"blocklyFlyoutBackground"},this.svgGroup_);this.svgOptions_=Blockly.createSvgElement("g",{},this.svgGroup_);this.svgOptions_.appendChild(this.workspace_.createDom());return this.svgGroup_};
Blockly.Flyout.prototype.destroy=function(){this.onResizeWrapper_&&(Blockly.unbindEvent_(this.onResizeWrapper_),this.onResizeWrapper_=null);this.scrollbar_&&(this.scrollbar_.destroy(),this.scrollbar_=null);this.workspace_=null;this.svgGroup_&&(this.svgGroup_.parentNode.removeChild(this.svgGroup_),this.svgGroup_=null);this.buttons_=this.targetWorkspaceMetrics_=this.targetWorkspace_=this.svgOptions_=this.svgBackground_=null};
Blockly.Flyout.prototype.getMetrics=function(){if(!this.isVisible())return null;var c=this.height_-2*this.CORNER_RADIUS,d=this.width_;try{var e=this.svgOptions_.getBBox()}catch(f){e={height:0,y:0}}return{viewHeight:c,viewWidth:d,contentHeight:e.height+e.y,viewTop:-this.svgOptions_.scrollY,contentTop:0,absoluteTop:this.CORNER_RADIUS,absoluteLeft:0}};
Blockly.Flyout.prototype.setMetrics=function(c){var d=this.getMetrics();"number"==typeof c.y&&(this.svgOptions_.scrollY=-d.contentHeight*c.y-d.contentTop);this.svgOptions_.setAttribute("transform","translate(0,"+(this.svgOptions_.scrollY+d.absoluteTop)+")")};
Blockly.Flyout.prototype.init=function(c,d,e){this.targetWorkspace_=c;this.targetWorkspaceMetrics_=d;this.height_=this.width_=0;var f=this;e&&(this.scrollbar_=new Blockly.Scrollbar(this.svgOptions_,function(){return f.getMetrics()},function(c){return f.setMetrics(c)},!1,!1));this.buttons_=[];this.position_();this.hide();this.onResizeWrapper_=Blockly.bindEvent_(window,"resize",this,this.position_)};
Blockly.Flyout.prototype.position_=function(){var c=this.targetWorkspaceMetrics_();if(c){var d=this.width_-this.CORNER_RADIUS;Blockly.RTL&&(d*=-1);var e=["M "+(Blockly.RTL?this.width_:0)+",0"];e.push("h",d);e.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,Blockly.RTL?0:1,Blockly.RTL?-this.CORNER_RADIUS:this.CORNER_RADIUS,this.CORNER_RADIUS);e.push("v",Math.max(0,c.viewHeight-2*this.CORNER_RADIUS));e.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,Blockly.RTL?0:1,Blockly.RTL?this.CORNER_RADIUS:
-this.CORNER_RADIUS,this.CORNER_RADIUS);e.push("h",-d);e.push("z");this.svgBackground_.setAttribute("d",e.join(" "));d=c.absoluteLeft;Blockly.RTL&&(d-=this.width_);this.svgGroup_.setAttribute("transform","translate("+d+","+c.absoluteTop+")");this.height_=c.viewHeight}};Blockly.Flyout.prototype.isVisible=function(){return"none"!=this.svgGroup_.style.display};
Blockly.Flyout.prototype.hide=function(){this.svgGroup_.style.display="none";for(var c=this.workspace_.getTopBlocks(!1),d=0,e;e=c[d];d++)e.destroy(!1,!1);for(d=0;c=this.buttons_[d];d++)Blockly.unbindEvent_(c.wrapper_),c.parentNode.removeChild(c);this.buttons_=[]};
Blockly.Flyout.prototype.show=function(c){var d=this.CORNER_RADIUS;this.svgGroup_.style.display="block";var e=[],f=[];if(c==Blockly.MSG_VARIABLE_CATEGORY)Blockly.Variables.flyoutCategory(e,f,d,this.workspace_);else if(c==Blockly.MSG_PROCEDURE_CATEGORY)Blockly.Procedures.flyoutCategory(e,f,d,this.workspace_);else for(var g=0,h;h=c[g];g++)h=new Blockly.Block(this.workspace_,h),h.initSvg(),e[g]=h,f[g]=2*d;for(var c=0,i=d,g=0;h=e[g];g++){h.isInFlyout=!0;Blockly.Comment&&h.setCommentText(null);h.render();
var j=h.getSvgRoot().getBBox();h.moveBy(Blockly.RTL?0:d+Blockly.BlockSvg.TAB_WIDTH,i);c=Math.max(c,j.width);i+=j.height+f[g];Blockly.bindEvent_(h.getSvgRoot(),"mousedown",null,Blockly.Flyout.createBlockFunc_(this,h))}c+=d+Blockly.BlockSvg.TAB_WIDTH+d/2+Blockly.Scrollbar.scrollbarThickness;for(g=0;h=e[g];g++)Blockly.RTL&&h.moveBy(c-d-Blockly.BlockSvg.TAB_WIDTH,0),j=h.getSvgRoot().getBBox(),f=h.getRelativeToSurfaceXY(),f=Blockly.createSvgElement("rect",{width:j.width,height:j.height,x:f.x+j.x,y:f.y+
j.y,"fill-opacity":0},null),this.svgOptions_.insertBefore(f,this.svgOptions_.firstChild),f.wrapper_=Blockly.bindEvent_(f,"mousedown",null,Blockly.Flyout.createBlockFunc_(this,h)),this.buttons_[g]=f;this.width_=c;Blockly.fireUiEvent(window,"resize")};
Blockly.Flyout.createBlockFunc_=function(c,d){return function(e){if(!Blockly.isRightButton(e)){var f=Blockly.Xml.blockToDom_(d),f=Blockly.Xml.domToBlock_(c.targetWorkspace_,f),g=Blockly.getAbsoluteXY_(d.getSvgRoot()),h=Blockly.getAbsoluteXY_(c.targetWorkspace_.getCanvas());f.moveBy(g.x-h.x,g.y-h.y);f.render();c.autoClose&&c.hide();f.onMouseDown_(e)}}};Blockly.Generator={};Blockly.Generator.NAME_TYPE="generated_function";Blockly.Generator.languages={};
Blockly.Generator.get=function(c){c in Blockly.Generator.languages||(Blockly.Generator.languages[c]={blockToCode:function(d){if(!d)return"";var e=this[d.type];if(!e)throw'Language "'+c+'" does not know how to generate code for block type "'+d.type+'".';e=e.call(d);if(e instanceof Array)return d.disabled&&(e[0]=""),[this.scrub_(d,e[0]),e[1]];d.disabled&&(e="");return this.scrub_(d,e)},valueToCode:function(c,e,f){e=c.getInputTargetBlock(e);if(!e)return"";c=this.blockToCode(e);if(!(c instanceof Array))throw'Expecting tuple from value block "'+
e.type+'".';e=c[0];c=c[1];e&&f<=c&&(e="("+e+")");return e},statementToCode:function(c,e){var f=c.getInputTargetBlock(e),g=this.blockToCode(f);if("string"!=typeof g)throw'Expecting code from statement block "'+f.type+'".';g&&(g=Blockly.Generator.prefixLines(g,"  "));return g}});return Blockly.Generator.languages[c]};
Blockly.Generator.workspaceToCode=function(c){var d=[],c=Blockly.Generator.get(c);c.init();for(var e=Blockly.mainWorkspace.getTopBlocks(!0),f=0,g;g=e[f];f++){var h=c.blockToCode(g,!0);h instanceof Array&&(h=h[0]);h&&(g.outputConnection&&c.scrubNakedValue&&(h=c.scrubNakedValue(h)),d.push(h))}d=d.join("\n");d=c.finish(d);d=d.replace(/^\s+\n/,"");d=d.replace(/\n\s+$/,"\n");return d=d.replace(/[ \t]+\n/g,"\n")};Blockly.Generator.prefixLines=function(c,d){return d+c.replace(/\n(.)/g,"\n"+d+"$1")};
Blockly.Generator.allNestedComments=function(c){for(var d=[],c=c.getDescendants(),e=0;e<c.length;e++){var f=c[e].getCommentText();f&&d.push(f)}d.length&&d.push("");return d.join("\n")};Blockly.inject=function(c,d){d&&Blockly.parseOptions_(d);Blockly.createDom_(c);Blockly.init_()};Blockly.parseOptions_=function(c){Blockly.RTL=!!c.rtl;Blockly.editable=!c.readOnly;Blockly.pathToBlockly=c.path||"./"};
Blockly.createDom_=function(c){for(var d=c;d.parentNode;)d=d.parentNode;Blockly.svgDoc=d;var e=d.createElement("link");e.setAttribute("href",Blockly.pathToBlockly+"blockly.css");e.setAttribute("rel","stylesheet");e.setAttribute("type","text/css");e.setAttribute("onload","Blockly.cssLoaded()");d=d.head||d.getElementsByTagName("head")[0];if(!d)throw"No head in document.";d.appendChild(e);var e=Blockly.createSvgElement("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:html":"http://www.w3.org/1999/xhtml",
"xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1","class":"blocklySvg"},null),d=Blockly.createSvgElement("defs",{},e),f,g;f=Blockly.createSvgElement("filter",{id:"blocklyEmboss"},d);Blockly.createSvgElement("feGaussianBlur",{"in":"SourceAlpha",stdDeviation:1,result:"blur"},f);g=Blockly.createSvgElement("feSpecularLighting",{"in":"blur",surfaceScale:1,specularConstant:0.5,specularExponent:10,"lighting-color":"white",result:"specOut"},f);Blockly.createSvgElement("fePointLight",{x:-5E3,y:-1E4,
z:2E4},g);Blockly.createSvgElement("feComposite",{"in":"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"},f);Blockly.createSvgElement("feComposite",{"in":"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:0,k2:1,k3:1,k4:0},f);f=Blockly.createSvgElement("filter",{id:"blocklyTrashcanShadowFilter"},d);Blockly.createSvgElement("feGaussianBlur",{"in":"SourceAlpha",stdDeviation:2,result:"blur"},f);Blockly.createSvgElement("feOffset",{"in":"blur",dx:1,dy:1,result:"offsetBlur"},f);f=Blockly.createSvgElement("feMerge",
{},f);Blockly.createSvgElement("feMergeNode",{"in":"offsetBlur"},f);Blockly.createSvgElement("feMergeNode",{"in":"SourceGraphic"},f);f=Blockly.createSvgElement("filter",{id:"blocklyShadowFilter"},d);Blockly.createSvgElement("feGaussianBlur",{stdDeviation:2},f);f=Blockly.createSvgElement("filter",{id:"blocklyGrayscale"},d);Blockly.createSvgElement("feColorMatrix",{type:"matrix",values:".3 .3 .3 0 .2 .3 .3 .3 0 .2 .3 .3 .3 0 .2 0 0 0 1 0"},f);d=Blockly.createSvgElement("pattern",{id:"blocklyDisabledPattern",
patternUnits:"userSpaceOnUse",width:10,height:10},d);Blockly.createSvgElement("rect",{width:10,height:10,fill:"#aaa"},d);Blockly.createSvgElement("path",{d:"M 0 0 L 10 10 M 10 0 L 0 10",stroke:"#cc0"},d);Blockly.mainWorkspace=new Blockly.Workspace(Blockly.editable);e.appendChild(Blockly.mainWorkspace.createDom());Blockly.Toolbox&&Blockly.editable&&e.appendChild(Blockly.Toolbox.createDom());Blockly.Tooltip&&e.appendChild(Blockly.Tooltip.createDom());Blockly.editable&&e.appendChild(Blockly.FieldDropdown.createDom());
Blockly.ContextMenu&&e.appendChild(Blockly.ContextMenu.createDom());c.appendChild(e);Blockly.svg=e;Blockly.svgResize()};
Blockly.init_=function(){var c=Blockly.svgDoc;Blockly.bindEvent_(window,"resize",c,Blockly.svgResize);Blockly.bindEvent_(Blockly.svg,"mousedown",null,Blockly.onMouseDown_);Blockly.bindEvent_(c,"mouseup",null,Blockly.onMouseUp_);Blockly.bindEvent_(Blockly.svg,"mousemove",null,Blockly.onMouseMove_);Blockly.bindEvent_(Blockly.svg,"contextmenu",null,Blockly.onContextMenu_);Blockly.bindEvent_(c,"keydown",null,Blockly.onKeyDown_);Blockly.editable&&Blockly.Toolbox&&Blockly.Toolbox.init();Blockly.mainWorkspace.addTrashcan(Blockly.getMainWorkspaceMetrics);
Blockly.mainWorkspace.scrollbar=new Blockly.ScrollbarPair(Blockly.mainWorkspace.getBubbleCanvas(),Blockly.getMainWorkspaceMetrics,this.setMainWorkspaceMetrics);Blockly.loadAudio_("click");Blockly.loadAudio_("delete")};Blockly.Input=function(c,d,e,f){this.type=c;this.name=d;this.sourceBlock_=e;this.connection=f;this.titleRow=[]};Blockly.Input.prototype.appendTitle=function(c,d){"string"==typeof c&&(c=new Blockly.FieldLabel(c));this.sourceBlock_.svg_&&c.init(this.sourceBlock_);c.name=d;this.titleRow.push(c);this.sourceBlock_.rendered&&(this.sourceBlock_.render(),this.sourceBlock_.bumpNeighbours_());return c};Blockly.Input.prototype.init=function(){for(var c=0;c<this.titleRow.length;c++)this.titleRow[c].init(this.sourceBlock_)};
Blockly.Input.prototype.destroy=function(){for(var c=0,d;d=this.titleRow[c];c++)d.destroy();this.connection&&this.connection.destroy();this.sourceBlock_=null};Blockly.Mutator=function(c){this.block_=null;this.quarkNames_=c};Blockly.Mutator.ICON_SIZE=16;Blockly.Mutator.prototype.bubble_=null;Blockly.Mutator.prototype.iconX_=null;Blockly.Mutator.prototype.iconY_=null;Blockly.Mutator.prototype.relativeLeft_=-180;Blockly.Mutator.prototype.relativeTop_=-230;Blockly.Mutator.prototype.isPinned_=!1;Blockly.Mutator.prototype.workspaceWidth_=0;Blockly.Mutator.prototype.workspaceHeight_=0;
Blockly.Mutator.prototype.createIcon=function(){var c=Blockly.Mutator.ICON_SIZE/8;this.iconGroup_=Blockly.createSvgElement("g",{},null);this.block_.editable&&this.iconGroup_.setAttribute("class","blocklyIconGroup");Blockly.createSvgElement("rect",{"class":"blocklyIconShield",width:8*c,height:8*c,rx:2*c,ry:2*c},this.iconGroup_);if(!Blockly.Mutator.crossPath_){var d=[];d.push("M",3.5*c+","+3.5*c);d.push("v",-2*c,"h",c);d.push("v",2*c,"h",2*c);d.push("v",c,"h",-2*c);d.push("v",2*c,"h",-c);d.push("v",
-2*c,"h",-2*c);d.push("v",-c,"z");Blockly.Mutator.crossPath_=d.join(" ")}this.iconMark_=Blockly.createSvgElement("path",{"class":"blocklyIconMark",d:Blockly.Mutator.crossPath_},this.iconGroup_);this.block_.getSvgRoot().appendChild(this.iconGroup_);this.block_.editable&&(Blockly.bindEvent_(this.iconGroup_,"mouseup",this,this.iconClick_),Blockly.bindEvent_(this.iconGroup_,"mouseover",this,this.iconMouseOver_),Blockly.bindEvent_(this.iconGroup_,"mouseout",this,this.iconMouseOut_))};
Blockly.Mutator.prototype.createEditor_=function(){this.svgDialog_=Blockly.createSvgElement("svg",{x:Blockly.Bubble.BORDER_WIDTH,y:Blockly.Bubble.BORDER_WIDTH},null);this.svgBackground_=Blockly.createSvgElement("rect",{"class":"blocklyMutatorBackground",height:"100%",width:"100%"},this.svgDialog_);this.workspace_=new Blockly.Workspace(!0);this.flyout_=new Blockly.Flyout;this.flyout_.autoClose=!1;this.svgDialog_.appendChild(this.flyout_.createDom());this.svgDialog_.appendChild(this.workspace_.createDom());
return this.svgDialog_};
Blockly.Mutator.prototype.resizeBubble_=function(){var c=2*Blockly.Bubble.BORDER_WIDTH,d=this.workspace_.getCanvas().getBBox(),e=this.flyout_.getMetrics(),f;f=Blockly.RTL?-d.x:d.width+d.x;d=Math.max(d.height+3*c,e.contentHeight);f+=3*c;if(Math.abs(this.workspaceWidth_-f)>c||Math.abs(this.workspaceHeight_-d)>c)this.workspaceWidth_=f,this.workspaceHeight_=d,this.bubble_.setBubbleSize(f+c,d+c),this.svgDialog_.setAttribute("width",this.workspaceWidth_),this.svgDialog_.setAttribute("height",this.workspaceHeight_);
Blockly.RTL&&(c="translate("+this.workspaceWidth_+",0)",this.workspace_.getCanvas().setAttribute("transform",c))};Blockly.Mutator.prototype.isPinned=function(){return this.isPinned_};Blockly.Mutator.prototype.setPinned=function(c){this.isPinned_=c;this.iconMark_.style.fill=c?"#fff":"";this.bubble_&&this.bubble_.setDisabled(!this.isPinned_)};Blockly.Mutator.prototype.isVisible_=function(){return!!this.bubble_};
Blockly.Mutator.prototype.setVisible_=function(c){if(c!=this.isVisible_()){var d=this.getBubbleLocation();if(c){this.bubble_=new Blockly.Bubble(this.block_.workspace.getBubbleCanvas(),this.createEditor_(),this.iconX_,this.iconY_,this.relativeLeft_,this.relativeTop_,null,null);var e=this;this.flyout_.init(this.workspace_,function(){return e.getFlyoutMetrics_()},!1);this.flyout_.show(this.quarkNames_);this.rootBlock_=this.block_.decompose(this.workspace_);for(var c=this.rootBlock_.getDescendants(),
f=0,g;g=c[f];f++)g.render();this.rootBlock_.editable=!1;c=2*this.flyout_.CORNER_RADIUS;f=this.flyout_.width_+c;Blockly.RTL&&(f=-f);this.rootBlock_.moveBy(f,c);this.block_.saveConnections&&(this.block_.saveConnections(this.rootBlock_),this.sourceListener_=Blockly.bindEvent_(this.block_.workspace.getCanvas(),"blocklyWorkspaceChange",this.block_,function(){e.block_.saveConnections(e.rootBlock_)}));this.resizeBubble_();Blockly.bindEvent_(this.workspace_.getCanvas(),"blocklyWorkspaceChange",this.block_,
function(){e.workspaceChanged_()});this.bubble_.setDisabled(!this.isPinned_);this.updateColour()}else this.svgBackground_=this.svgDialog_=null,this.flyout_.destroy(),this.flyout_=null,this.workspace_.destroy(),this.rootBlock_=this.workspace_=null,this.bubble_.destroy(),this.bubble_=null,this.workspaceHeight_=this.workspaceWidth_=0,this.sourceListener_&&(Blockly.unbindEvent_(this.sourceListener_),this.sourceListener_=null);this.setBubbleLocation(d.x,d.y)}};
Blockly.Mutator.prototype.workspaceChanged_=function(){if(0==Blockly.Block.dragMode_)for(var c=this.workspace_.getTopBlocks(!1),d=0,e;e=c[d];d++){var f=e.getRelativeToSurfaceXY();(0>f.y||(Blockly.RTL?f.x>-this.flyout_.width_:f.x<this.flyout_.width_))&&e.destroy(!1,!1)}this.rootBlock_.workspace==this.workspace_&&(this.resizeBubble_(),c=this.block_.rendered,this.block_.rendered=!1,this.block_.compose(this.rootBlock_),this.block_.rendered=c,this.block_.rendered&&this.block_.render(),this.block_.workspace.fireChangeEvent())};
Blockly.Mutator.prototype.getFlyoutMetrics_=function(){var c=0;Blockly.RTL&&(c+=this.workspaceWidth_);return{viewHeight:this.workspaceHeight_,absoluteTop:0,absoluteLeft:c}};Blockly.Mutator.prototype.iconClick_=function(){this.setPinned(!this.isPinned_)};Blockly.Mutator.prototype.iconMouseOver_=function(){!this.isPinned_&&0==Blockly.Block.dragMode_&&this.setVisible_(!0)};Blockly.Mutator.prototype.iconMouseOut_=function(){!this.isPinned_&&0==Blockly.Block.dragMode_&&this.setVisible_(!1)};
Blockly.Mutator.prototype.getBubbleLocation=function(){return this.isVisible_()?this.bubble_.getBubbleLocation():{x:this.relativeLeft_,y:this.relativeTop_}};Blockly.Mutator.prototype.setBubbleLocation=function(c,d){this.isVisible_()?this.bubble_.setBubbleLocation(c,d):(this.relativeLeft_=c,this.relativeTop_=d)};Blockly.Mutator.prototype.updateColour=function(){if(this.isVisible_()){var c=Blockly.makeColour(this.block_.getColour());this.bubble_.setColour(c)}};
Blockly.Mutator.prototype.destroy=function(){this.iconGroup_.parentNode.removeChild(this.iconGroup_);this.iconGroup_=null;this.setVisible_(!1);this.block_=this.block_.mutator=null};Blockly.Mutator.prototype.renderIcon=function(c){if(this.block_.collapsed)return this.iconGroup_.setAttribute("display","none"),0;this.iconGroup_.setAttribute("display","block");Blockly.RTL&&(c-=Blockly.Mutator.ICON_SIZE);this.iconGroup_.setAttribute("transform","translate("+c+", 5)");this.computeIconLocation();return Blockly.Mutator.ICON_SIZE};
Blockly.Mutator.prototype.setIconLocation=function(c,d){this.iconX_=c;this.iconY_=d;this.isVisible_()&&this.bubble_.setAnchorLocation(c,d)};Blockly.Mutator.prototype.computeIconLocation=function(){var c=this.block_.getRelativeToSurfaceXY(),d=Blockly.getRelativeXY_(this.iconGroup_),e=c.x+d.x+Blockly.Mutator.ICON_SIZE/2,c=c.y+d.y+Blockly.Mutator.ICON_SIZE/2;(e!==this.iconX_||c!==this.iconY_)&&this.setIconLocation(e,c)};Blockly.Mutator.prototype.getIconLocation=function(){return{x:this.iconX_,y:this.iconY_}};Blockly.Names=function(c){this.reservedDict_={};if(c)for(var d=0;d<c.length;d++)this.reservedDict_[Blockly.Names.PREFIX_+c[d]]=!0;this.reset()};Blockly.Names.PREFIX_="v_";Blockly.Names.prototype.reset=function(){this.db_={};this.dbReverse_={}};Blockly.Names.prototype.getName=function(c,d){var e=Blockly.Names.PREFIX_+c.toLowerCase()+"X"+d;return e in this.db_?this.db_[e]:this.getDistinctName(c,d)};
Blockly.Names.prototype.getDistinctName=function(c,d){for(var e=this.safeName_(c),f="";this.dbReverse_[Blockly.Names.PREFIX_+e+f]||Blockly.Names.PREFIX_+e+f in this.reservedDict_;)f=f?f+1:2;e+=f;this.db_[Blockly.Names.PREFIX_+c.toLowerCase()+"X"+d]=e;this.dbReverse_[Blockly.Names.PREFIX_+e]=!0;return e};Blockly.Names.prototype.safeName_=function(c){c?(c=encodeURI(c.replace(/ /g,"_")).replace(/[^\w]/g,"_"),-1!="0123456789".indexOf(c.charAt(0))&&(c="my_"+c)):c="unnamed";return c};
Blockly.Names.equals=function(c,d){return c.toLowerCase()==d.toLowerCase()};Blockly.Procedures={};Blockly.Procedures.NAME_TYPE="procedure";Blockly.Procedures.allProcedures=function(){function c(c,d){a=c[0].toLowerCase();b=d[0].toLowerCase();return a>b?1:a<b?-1:0}for(var d=Blockly.mainWorkspace.getAllBlocks(!1),e=[],f=[],g=0;g<d.length;g++){var h=d[g].getProcedureDef;h&&(h=h.call(d[g]))&&(h[2]?e.push(h):f.push(h))}f.sort(c);e.sort(c);return[f,e]};
Blockly.Procedures.findLegalName=function(c,d){if(!d.workspace.editable)return c;for(;!Blockly.Procedures.isLegalName(c,d.workspace,d);)var e=c.match(/^(.*?)(\d+)$/),c=e?e[1]+(parseInt(e[2],10)+1):c+"2";return c};Blockly.Procedures.isLegalName=function(c,d,e){for(var d=d.getAllBlocks(!1),f=0;f<d.length;f++)if(d[f]!=e){var g=d[f].getProcedureDef;if(g&&(g=g.call(d[f]),Blockly.Names.equals(g[0],c)))return!1}return!0};
Blockly.Procedures.rename=function(c){if(!this.sourceBlock_.editable)return c;c=c.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"");if(!c)return null;for(var c=Blockly.Procedures.findLegalName(c,this.sourceBlock_),d=this.sourceBlock_.workspace.getAllBlocks(!1),e=0;e<d.length;e++){var f=d[e].renameProcedure;f&&f.call(d[e],this.text_,c)}window.setTimeout(Blockly.Procedures.refreshFlyoutCategory,1);return c};
Blockly.Procedures.flyoutCategory=function(c,d,e,f){function g(g,h){for(var k=0;k<g.length;k++){var l=new Blockly.Block(f,h);l.setTitleValue(g[k][0],"NAME");for(var m=[],q=0;q<g[k][1].length;q++)m[q]="ARG"+q;l.setProcedureParameters(g[k][1],m);l.initSvg();c.push(l);d.push(2*e)}}if(Blockly.Language.procedures_defnoreturn){var h=new Blockly.Block(f,"procedures_defnoreturn");h.initSvg();c.push(h);d.push(2*e)}Blockly.Language.procedures_defreturn&&(h=new Blockly.Block(f,"procedures_defreturn"),h.initSvg(),
c.push(h),d.push(2*e));h=Blockly.Procedures.allProcedures();g(h[0],"procedures_callnoreturn");g(h[1],"procedures_callreturn")};Blockly.Procedures.refreshFlyoutCategory=function(){Blockly.Toolbox&&(Blockly.Toolbox.flyout_.isVisible()&&Blockly.Toolbox.selectedOption_.cat==Blockly.MSG_PROCEDURE_CATEGORY)&&(Blockly.Toolbox.flyout_.hide(),Blockly.Toolbox.flyout_.show(Blockly.MSG_PROCEDURE_CATEGORY))};
Blockly.Procedures.getCallers=function(c,d){callers=[];for(var e=d.getAllBlocks(!1),f=0;f<e.length;f++){var g=e[f].getProcedureCall;g&&(g=g.call(e[f]))&&Blockly.Names.equals(g,c)&&callers.push(e[f])}return callers};Blockly.Procedures.destroyCallers=function(c,d){for(var e=Blockly.Procedures.getCallers(c,d),f=0;f<e.length;f++)e[f].destroy(!0,!1);window.setTimeout(Blockly.Procedures.refreshFlyoutCategory,1)};
Blockly.Procedures.mutateCallers=function(c,d,e,f){c=Blockly.Procedures.getCallers(c,d);for(d=0;d<c.length;d++)c[d].setProcedureParameters(e,f)};Blockly.ScrollbarPair=function(c,d,e){this.element_=c;this.getMetrics_=d;this.setMetrics_=e;this.oldHostMetrics_={};this.hScroll=new Blockly.Scrollbar(c,d,e,!0,!0);this.vScroll=new Blockly.Scrollbar(c,d,e,!1,!0);this.corner_=this.addCorner_(c);this.resize();var f=this;this.onResizeWrapper_=Blockly.bindEvent_(window,"resize",f,function(){f.resize()})};
Blockly.ScrollbarPair.prototype.destroy=function(){Blockly.unbindEvent_(this.onResizeWrapper_);this.onResizeWrapper_=null;this.corner_.parentNode.removeChild(this.corner_);this.oldHostMetrics_=this.setMetrics_=this.getMetrics_=this.element_=this.corner_=null;this.hScroll.destroy();this.hScroll=null;this.vScroll.destroy();this.vScroll=null};
Blockly.ScrollbarPair.prototype.addCorner_=function(c){var d=Blockly.createSvgElement("rect",{height:Blockly.Scrollbar.scrollbarThickness,width:Blockly.Scrollbar.scrollbarThickness,style:"fill: #fff"},null);Blockly.Scrollbar.insertAfter_(d,c);return d};
Blockly.ScrollbarPair.prototype.resize=function(){var c=this.getMetrics_();if(c){var d=!1,e=!1;if(this.oldHostMetrics_.viewWidth!=c.viewWidth||this.oldHostMetrics_.viewHeight!=c.viewHeight||this.oldHostMetrics_.absoluteTop!=c.absoluteTop||this.oldHostMetrics_.absoluteLeft!=c.absoluteLeft)e=d=!0;else{if(this.oldHostMetrics_.contentWidth!=c.contentWidth||this.oldHostMetrics_.viewLeft!=c.viewLeft||this.oldHostMetrics_.contentLeft!=c.contentLeft)d=!0;if(this.oldHostMetrics_.contentHeight!=c.contentHeight||
this.oldHostMetrics_.viewTop!=c.viewTop||this.oldHostMetrics_.contentTop!=c.contentTop)e=!0}d&&this.hScroll.resize(c);e&&this.vScroll.resize(c);(this.oldHostMetrics_.viewWidth!=c.viewWidth||this.oldHostMetrics_.absoluteLeft!=c.absoluteLeft)&&this.corner_.setAttribute("x",this.vScroll.xCoordinate);(this.oldHostMetrics_.viewHeight!=c.viewHeight||this.oldHostMetrics_.absoluteTop!=c.absoluteTop)&&this.corner_.setAttribute("y",this.hScroll.yCoordinate);this.oldHostMetrics_=c}};
Blockly.ScrollbarPair.prototype.set=function(c,d){if(Blockly.Scrollbar===Blockly.ScrollbarNative){this.hScroll.set(c,!1);this.vScroll.set(d,!1);var e={};e.x=this.hScroll.outerDiv_.scrollLeft/this.hScroll.innerImg_.offsetWidth||0;e.y=this.vScroll.outerDiv_.scrollTop/this.vScroll.innerImg_.offsetHeight||0;this.setMetrics_(e)}else this.hScroll.set(c,!0),this.vScroll.set(d,!0)};
Blockly.ScrollbarNative=function(c,d,e,f,g){this.element_=c;this.getMetrics_=d;this.setMetrics_=e;this.pair_=g||!1;this.horizontal_=f;this.createDom_(c);if(null!==f){Blockly.ScrollbarNative.scrollbarThickness||Blockly.ScrollbarNative.measureScrollbarThickness_(c);f?(this.foreignObject_.setAttribute("height",Blockly.ScrollbarNative.scrollbarThickness),this.outerDiv_.style.height=Blockly.ScrollbarNative.scrollbarThickness+"px",this.outerDiv_.style.overflowX="scroll",this.outerDiv_.style.overflowY="hidden",
this.innerImg_.style.height="1px"):(this.foreignObject_.setAttribute("width",Blockly.ScrollbarNative.scrollbarThickness),this.outerDiv_.style.width=Blockly.ScrollbarNative.scrollbarThickness+"px",this.outerDiv_.style.overflowX="hidden",this.outerDiv_.style.overflowY="scroll",this.innerImg_.style.width="1px");var h=this;this.onScrollWrapper_=Blockly.bindEvent_(this.outerDiv_,"scroll",h,function(){h.onScroll_()});Blockly.bindEvent_(this.foreignObject_,"mousedown",null,Blockly.noEvent);this.pair_||(this.resize(),
this.onResizeWrapper_=Blockly.bindEvent_(window,"resize",h,function(){h.resize()}))}};Blockly.ScrollbarNative.prototype.destroy=function(){Blockly.unbindEvent_(this.onResizeWrapper_);this.onResizeWrapper_=null;Blockly.unbindEvent_(this.onScrollWrapper_);this.onScrollWrapper_=null;this.foreignObject_.parentNode.removeChild(this.foreignObject_);this.innerImg_=this.outerDiv_=this.setMetrics_=this.getMetrics_=this.element_=this.foreignObject_=null};
Blockly.ScrollbarNative.prototype.resize=function(c){if(!c&&(c=this.getMetrics_(),!c))return;if(this.horizontal_){var d=c.viewWidth;this.pair_?d-=Blockly.ScrollbarNative.scrollbarThickness:this.setVisible(d<c.contentHeight);this.ratio_=d/c.viewWidth;var e=this.ratio_*c.contentWidth,f=(c.viewLeft-c.contentLeft)*this.ratio_;this.outerDiv_.style.width=d+"px";this.innerImg_.style.width=e+"px";this.xCoordinate=c.absoluteLeft;this.pair_&&Blockly.RTL&&(this.xCoordinate+=Blockly.ScrollbarNative.scrollbarThickness);
this.yCoordinate=c.absoluteTop+c.viewHeight-Blockly.ScrollbarNative.scrollbarThickness;this.foreignObject_.setAttribute("x",this.xCoordinate);this.foreignObject_.setAttribute("y",this.yCoordinate);this.foreignObject_.setAttribute("width",Math.max(0,d));this.outerDiv_.scrollLeft=Math.round(f)}else d=c.viewHeight,this.pair_?d-=Blockly.ScrollbarNative.scrollbarThickness:this.setVisible(d<c.contentHeight),this.ratio_=d/c.viewHeight,e=this.ratio_*c.contentHeight,f=(c.viewTop-c.contentTop)*this.ratio_,
this.outerDiv_.style.height=d+"px",this.innerImg_.style.height=e+"px",this.xCoordinate=c.absoluteLeft,Blockly.RTL||(this.xCoordinate+=c.viewWidth-Blockly.ScrollbarNative.scrollbarThickness),this.yCoordinate=c.absoluteTop,this.foreignObject_.setAttribute("x",this.xCoordinate),this.foreignObject_.setAttribute("y",this.yCoordinate),this.foreignObject_.setAttribute("height",Math.max(0,d)),this.outerDiv_.scrollTop=Math.round(f)};
Blockly.ScrollbarNative.prototype.createDom_=function(c){this.foreignObject_=Blockly.createSvgElement("foreignObject",{},null);var d=Blockly.svgDoc.createElementNS(Blockly.HTML_NS,"body");d.setAttribute("xmlns",Blockly.HTML_NS);d.setAttribute("class","blocklyMinimalBody");var e=Blockly.svgDoc.createElementNS(Blockly.HTML_NS,"div");this.outerDiv_=e;var f=Blockly.svgDoc.createElementNS(Blockly.HTML_NS,"img");f.setAttribute("src",Blockly.pathToBlockly+"1x1.gif");this.innerImg_=f;e.appendChild(f);d.appendChild(e);
this.foreignObject_.appendChild(d);Blockly.Scrollbar.insertAfter_(this.foreignObject_,c)};Blockly.ScrollbarNative.prototype.isVisible=function(){return"none"!=this.foreignObject_.style.display};Blockly.ScrollbarNative.prototype.setVisible=function(c){if(c!=this.isVisible()){if(this.pair_)throw"Unable to toggle visibility of paired scrollbars.";c?(this.foreignObject_.style.display="block",this.getMetrics_()):(this.setMetrics_({x:0,y:0}),this.foreignObject_.style.display="none")}};
Blockly.ScrollbarNative.prototype.onScroll_=function(){var c={};this.horizontal_?c.x=this.outerDiv_.scrollLeft/this.innerImg_.offsetWidth||0:c.y=this.outerDiv_.scrollTop/this.innerImg_.offsetHeight||0;this.setMetrics_(c)};
Blockly.ScrollbarNative.prototype.set=function(c,d){if(!d){var e=this.onScrollWrapper_[0][2];Blockly.unbindEvent_(this.onScrollWrapper_)}this.horizontal_?this.outerDiv_.scrollLeft=c*this.ratio_:this.outerDiv_.scrollTop=c*this.ratio_;d||(this.onScrollWrapper_=Blockly.bindEvent_(this.outerDiv_,"scroll",this,e))};Blockly.ScrollbarNative.scrollbarThickness=0;
Blockly.ScrollbarNative.measureScrollbarThickness_=function(c){var d=new Blockly.ScrollbarNative(c,null,null,null,!1);d.outerDiv_.style.width="100px";d.outerDiv_.style.height="100px";d.innerImg_.style.width="100%";d.innerImg_.style.height="200px";d.foreignObject_.setAttribute("width",1);d.foreignObject_.setAttribute("height",1);d.outerDiv_.style.overflowY="scroll";var e=d.innerImg_.offsetWidth;d.outerDiv_.style.overflowY="hidden";var f=d.innerImg_.offsetWidth;c.parentNode.removeChild(d.foreignObject_);
c=f-e;0>=c&&(c=15);Blockly.ScrollbarNative.scrollbarThickness=c};
Blockly.ScrollbarSvg=function(c,d,e,f,g){this.element_=c;this.getMetrics_=d;this.setMetrics_=e;this.pair_=g||!1;this.horizontal_=f;this.createDom_(c);f?(this.svgBackground_.setAttribute("height",Blockly.ScrollbarSvg.scrollbarThickness),this.svgKnob_.setAttribute("height",Blockly.ScrollbarSvg.scrollbarThickness-6),this.svgKnob_.setAttribute("y",3)):(this.svgBackground_.setAttribute("width",Blockly.ScrollbarSvg.scrollbarThickness),this.svgKnob_.setAttribute("width",Blockly.ScrollbarSvg.scrollbarThickness-
6),this.svgKnob_.setAttribute("x",3));var h=this;this.pair_||(this.resize(),this.onResizeWrapper_=Blockly.bindEvent_(window,"resize",h,function(){h.resize()}));this.onMouseDownBarWrapper_=Blockly.bindEvent_(this.svgBackground_,"mousedown",h,h.onMouseDownBar_);this.onMouseDownKnobWrapper_=Blockly.bindEvent_(this.svgKnob_,"mousedown",h,h.onMouseDownKnob_)};
Blockly.ScrollbarSvg.prototype.destroy=function(){this.onMouseUpKnob_();this.onResizeWrapper_&&(Blockly.unbindEvent_(this.onResizeWrapper_),this.onResizeWrapper_=null);Blockly.unbindEvent_(this.onMouseDownBarWrapper_);this.onMouseDownBarWrapper_=null;Blockly.unbindEvent_(this.onMouseDownKnobWrapper_);this.onMouseDownKnobWrapper_=null;this.svgGroup_.parentNode.removeChild(this.svgGroup_);this.setMetrics_=this.getMetrics_=this.element_=this.svgKnob_=this.svgBackground_=this.svgGroup_=null};
Blockly.ScrollbarSvg.prototype.resize=function(c){if(!c&&(c=this.getMetrics_(),!c))return;if(this.horizontal_){var d=c.viewWidth;this.pair_?d-=Blockly.ScrollbarSvg.scrollbarThickness:this.setVisible(d<c.contentHeight);this.ratio_=d/c.contentWidth;if(-Infinity===this.ratio_||Infinity===this.ratio_||isNaN(this.ratio_))this.ratio_=0;var e=c.viewWidth*this.ratio_,f=(c.viewLeft-c.contentLeft)*this.ratio_;this.svgKnob_.setAttribute("width",Math.max(0,e));this.xCoordinate=c.absoluteLeft;this.pair_&&Blockly.RTL&&
(this.xCoordinate+=c.absoluteLeft+Blockly.ScrollbarSvg.scrollbarThickness);this.yCoordinate=c.absoluteTop+c.viewHeight-Blockly.ScrollbarSvg.scrollbarThickness;this.svgGroup_.setAttribute("transform","translate("+this.xCoordinate+", "+this.yCoordinate+")");this.svgBackground_.setAttribute("width",Math.max(0,d));this.svgKnob_.setAttribute("x",this.constrainKnob_(f))}else{d=c.viewHeight;this.pair_?d-=Blockly.ScrollbarSvg.scrollbarThickness:this.setVisible(d<c.contentHeight);this.ratio_=d/c.contentHeight;
if(-Infinity===this.ratio_||Infinity===this.ratio_||isNaN(this.ratio_))this.ratio_=0;e=c.viewHeight*this.ratio_;f=(c.viewTop-c.contentTop)*this.ratio_;this.svgKnob_.setAttribute("height",Math.max(0,e));this.xCoordinate=c.absoluteLeft;Blockly.RTL||(this.xCoordinate+=c.viewWidth-Blockly.ScrollbarSvg.scrollbarThickness);this.yCoordinate=c.absoluteTop;this.svgGroup_.setAttribute("transform","translate("+this.xCoordinate+", "+this.yCoordinate+")");this.svgBackground_.setAttribute("height",Math.max(0,d));
this.svgKnob_.setAttribute("y",this.constrainKnob_(f))}this.onScroll_()};
Blockly.ScrollbarSvg.prototype.createDom_=function(c){this.svgGroup_=Blockly.createSvgElement("g",{},null);this.svgBackground_=Blockly.createSvgElement("rect",{"class":"blocklyScrollbarBackground"},this.svgGroup_);var d=Math.floor((Blockly.ScrollbarSvg.scrollbarThickness-6)/2);this.svgKnob_=Blockly.createSvgElement("rect",{"class":"blocklyScrollbarKnob",rx:d,ry:d},this.svgGroup_);Blockly.Scrollbar.insertAfter_(this.svgGroup_,c)};Blockly.ScrollbarSvg.prototype.isVisible=function(){return"none"!=this.svgGroup_.getAttribute("display")};
Blockly.ScrollbarSvg.prototype.setVisible=function(c){if(c!=this.isVisible()){if(this.pair_)throw"Unable to toggle visibility of paired scrollbars.";c?this.svgGroup_.setAttribute("display","block"):(this.setMetrics_({x:0,y:0}),this.svgGroup_.setAttribute("display","none"))}};
Blockly.ScrollbarSvg.prototype.onMouseDownBar_=function(c){Blockly.hideChaff(!0);if(!Blockly.isRightButton(c)){Blockly.svgResize();var d=Blockly.svgSize(),d=this.horizontal_?c.x-d.left:c.y-d.top,e=Blockly.getAbsoluteXY_(this.svgKnob_),e=this.horizontal_?e.x:e.y,f=parseFloat(this.svgKnob_.getAttribute(this.horizontal_?"width":"height")),g=parseFloat(this.svgKnob_.getAttribute(this.horizontal_?"x":"y")),h=0.95*f;d<=e?g-=h:d>=e+f&&(g+=h);this.svgKnob_.setAttribute(this.horizontal_?"x":"y",this.constrainKnob_(g));
this.onScroll_()}c.stopPropagation()};
Blockly.ScrollbarSvg.prototype.onMouseDownKnob_=function(c){Blockly.hideChaff(!0);this.onMouseUpKnob_();Blockly.isRightButton(c)||(this.startDragKnob=parseFloat(this.svgKnob_.getAttribute(this.horizontal_?"x":"y")),this.startDragMouse=this.horizontal_?c.clientX:c.clientY,Blockly.ScrollbarSvg.onMouseUpWrapper_=Blockly.bindEvent_(Blockly.svgDoc,"mouseup",this,this.onMouseUpKnob_),Blockly.ScrollbarSvg.onMouseMoveWrapper_=Blockly.bindEvent_(Blockly.svgDoc,"mousemove",this,this.onMouseMoveKnob_));c.stopPropagation()};
Blockly.ScrollbarSvg.prototype.onMouseMoveKnob_=function(c){this.svgKnob_.setAttribute(this.horizontal_?"x":"y",this.constrainKnob_(this.startDragKnob+((this.horizontal_?c.clientX:c.clientY)-this.startDragMouse)));this.onScroll_()};
Blockly.ScrollbarSvg.prototype.onMouseUpKnob_=function(){Blockly.ScrollbarSvg.onMouseUpWrapper_&&(Blockly.unbindEvent_(Blockly.ScrollbarSvg.onMouseUpWrapper_),Blockly.ScrollbarSvg.onMouseUpWrapper_=null);Blockly.ScrollbarSvg.onMouseMoveWrapper_&&(Blockly.unbindEvent_(Blockly.ScrollbarSvg.onMouseMoveWrapper_),Blockly.ScrollbarSvg.onMouseMoveWrapper_=null)};
Blockly.ScrollbarSvg.prototype.constrainKnob_=function(c){if(0>=c||isNaN(c))c=0;else var d=this.horizontal_?"width":"height",e=parseFloat(this.svgBackground_.getAttribute(d)),d=parseFloat(this.svgKnob_.getAttribute(d)),c=Math.min(c,e-d);return c};
Blockly.ScrollbarSvg.prototype.onScroll_=function(){var c=parseFloat(this.svgKnob_.getAttribute(this.horizontal_?"x":"y")),d=parseFloat(this.svgBackground_.getAttribute(this.horizontal_?"width":"height")),c=c/d;isNaN(c)&&(c=0);d={};this.horizontal_?d.x=c:d.y=c;this.setMetrics_(d)};Blockly.ScrollbarSvg.prototype.set=function(c,d){this.svgKnob_.setAttribute(this.horizontal_?"x":"y",c*this.ratio_);if(d)this.onScroll_()};Blockly.ScrollbarSvg.scrollbarThickness=15;Blockly.Scrollbar={};
(function(){var c=!1,d=-1!=window.navigator.userAgent.indexOf("Gecko/"),e="MacIntel"==window.navigator.platform,f=-1!=window.navigator.platform.indexOf("Linux");if(d&&(e||f))c=!0;Blockly.Scrollbar=c?Blockly.ScrollbarNative:Blockly.ScrollbarSvg})();Blockly.Scrollbar.insertAfter_=function(c,d){var e=d.nextSibling,f=d.parentNode;if(!f)throw"Reference node has no parent.";e?f.insertBefore(c,e):f.appendChild(c)};Blockly.Toolbox={};Blockly.Toolbox.width=0;Blockly.Toolbox.selectedOption_=null;
Blockly.Toolbox.createDom=function(){Blockly.Toolbox.flyout_=new Blockly.Flyout;var c=Blockly.createSvgElement("g",{},null);Blockly.Toolbox.svgGroup_=c;var d=Blockly.Toolbox.flyout_.createDom();c.appendChild(d);Blockly.Toolbox.svgBackground_=Blockly.createSvgElement("rect",{"class":"blocklyToolboxBackground",height:"100%"},c);Blockly.Toolbox.svgOptions_=Blockly.createSvgElement("g",{"class":"blocklyToolboxOptions"},c);return c};
Blockly.Toolbox.getMetrics=function(){var c=Blockly.svgSize().height,d=Blockly.Toolbox.width;try{var e=Blockly.Toolbox.svgOptions_.getBBox()}catch(f){return null}return{viewHeight:c,viewWidth:d,contentHeight:e.height+e.y,viewTop:-Blockly.Toolbox.svgOptions_.scrollY,contentTop:0,absoluteTop:0,absoluteLeft:Blockly.RTL?-1:1}};
Blockly.Toolbox.setMetrics=function(c){var d=Blockly.Toolbox.getMetrics();"number"==typeof c.y&&(Blockly.Toolbox.svgOptions_.scrollY=-d.contentHeight*c.y-d.contentTop);Blockly.Toolbox.svgOptions_.setAttribute("transform","translate(0,"+(Blockly.Toolbox.svgOptions_.scrollY+d.absoluteTop)+")")};
Blockly.Toolbox.init=function(){Blockly.Toolbox.flyout_.init(Blockly.mainWorkspace,Blockly.getMainWorkspaceMetrics,!0);Blockly.Toolbox.languageTree=Blockly.Toolbox.buildTree_();Blockly.Toolbox.redraw();new Blockly.Scrollbar(Blockly.Toolbox.svgOptions_,Blockly.Toolbox.getMetrics,Blockly.Toolbox.setMetrics,!1,!1);Blockly.Toolbox.position_();Blockly.bindEvent_(window,"resize",null,Blockly.Toolbox.position_)};
Blockly.Toolbox.position_=function(){var c=Blockly.svgSize();Blockly.RTL&&Blockly.Toolbox.svgGroup_.setAttribute("transform","translate("+(c.width-Blockly.Toolbox.width)+",0)")};Blockly.Toolbox.PREFIX_="cat_";Blockly.Toolbox.buildTree_=function(){var c={},d;for(d in Blockly.Language){var e=Blockly.Language[d];e.category&&(e=Blockly.Toolbox.PREFIX_+window.encodeURI(e.category),e in c?c[e].push(d):c[e]=[d])}return c};
Blockly.Toolbox.redraw=function(){function c(c){return function(d){var e=Blockly.Toolbox.selectedOption_;Blockly.hideChaff();e==c?Blockly.Toolbox.clearSelection():Blockly.Toolbox.selectOption_(c);d.stopPropagation()}}var d=[],e;for(e in Blockly.Toolbox.languageTree){var f={};f.text=window.decodeURI(e.substring(Blockly.Toolbox.PREFIX_.length));f.cat=e;d.push(f)}f={};(Blockly.Language.variables_get||Blockly.Language.variables_set)&&d.push({text:Blockly.MSG_VARIABLE_CATEGORY,cat:Blockly.MSG_VARIABLE_CATEGORY});
(Blockly.Language.procedures_defnoreturn||Blockly.Language.procedures_defreturn)&&d.push({text:Blockly.MSG_PROCEDURE_CATEGORY,cat:Blockly.MSG_PROCEDURE_CATEGORY});Blockly.removeChildren_(Blockly.Toolbox.svgOptions_);e=0;for(var g=[Blockly.Toolbox.svgBackground_],h=0;f=d[h];h++){var i=Blockly.ContextMenu.optionToDom(f.text),j=i.firstChild,k=i.lastChild;Blockly.Toolbox.svgOptions_.appendChild(i);i.setAttribute("transform","translate(0, "+(h*Blockly.ContextMenu.Y_HEIGHT+4)+")");i.cat=f.cat;Blockly.bindEvent_(i,
"mousedown",null,c(i));g.push(j);e=Math.max(e,k.getComputedTextLength())}e+=2*Blockly.ContextMenu.X_PADDING;for(h=0;h<g.length;h++)g[h].setAttribute("width",e);if(Blockly.RTL)for(h=0;i=Blockly.Toolbox.svgOptions_.childNodes[h];h++)k=i.lastChild,k.setAttribute("text-anchor","end"),k.setAttribute("x",e-Blockly.ContextMenu.X_PADDING);Blockly.Toolbox.width=e;Blockly.bindEvent_(Blockly.Toolbox.svgGroup_,"mousedown",null,function(c){Blockly.isRightButton(c)&&(Blockly.hideChaff(!0),c.stopPropagation())});
Blockly.fireUiEvent(window,"resize")};Blockly.Toolbox.selectOption_=function(c){Blockly.Toolbox.clearSelection();if(Blockly.Toolbox.selectedOption_=c)Blockly.addClass_(c,"blocklyMenuSelected"),c=c.cat,Blockly.Toolbox.flyout_.show(Blockly.Toolbox.languageTree[c]||c)};Blockly.Toolbox.clearSelection=function(){var c=Blockly.Toolbox.selectedOption_;c&&(Blockly.removeClass_(c,"blocklyMenuSelected"),Blockly.Toolbox.selectedOption_=null);Blockly.Toolbox.flyout_.hide()};Blockly.Tooltip={};Blockly.Tooltip.mouseOutPid=0;Blockly.Tooltip.showPid=0;Blockly.Tooltip.lastX=0;Blockly.Tooltip.lastY=0;Blockly.Tooltip.visible=!1;Blockly.Tooltip.element=null;Blockly.Tooltip.poisonedElement=null;Blockly.Tooltip.svgGroup_=null;Blockly.Tooltip.svgText_=null;Blockly.Tooltip.svgBackground_=null;Blockly.Tooltip.svgShadow_=null;Blockly.Tooltip.OFFSET_X=0;Blockly.Tooltip.OFFSET_Y=10;Blockly.Tooltip.RADIUS_OK=10;Blockly.Tooltip.HOVER_MS=1E3;Blockly.Tooltip.MARGINS=5;
Blockly.Tooltip.createDom=function(){var c=Blockly.createSvgElement("g",{"class":"blocklyHidden"},null);Blockly.Tooltip.svgGroup_=c;Blockly.Tooltip.svgShadow_=Blockly.createSvgElement("rect",{"class":"blocklyTooltipShadow",x:2,y:2},c);Blockly.Tooltip.svgBackground_=Blockly.createSvgElement("rect",{"class":"blocklyTooltipBackground"},c);Blockly.Tooltip.svgText_=Blockly.createSvgElement("text",{"class":"blocklyTooltipText"},c);return c};
Blockly.Tooltip.bindMouseEvents=function(c){Blockly.bindEvent_(c,"mouseover",null,Blockly.Tooltip.onMouseOver_);Blockly.bindEvent_(c,"mouseout",null,Blockly.Tooltip.onMouseOut_);Blockly.bindEvent_(c,"mousemove",null,Blockly.Tooltip.onMouseMove_)};Blockly.Tooltip.onMouseOver_=function(c){for(c=c.target;"object"==typeof c.tooltip;)c=c.tooltip;Blockly.Tooltip.element!=c&&(Blockly.Tooltip.hide(),Blockly.Tooltip.poisonedElement=null,Blockly.Tooltip.element=c);window.clearTimeout(Blockly.Tooltip.mouseOutPid)};
Blockly.Tooltip.onMouseOut_=function(){Blockly.Tooltip.mouseOutPid=window.setTimeout(function(){Blockly.Tooltip.element=null;Blockly.Tooltip.poisonedElement=null;Blockly.Tooltip.hide()},1);window.clearTimeout(Blockly.Tooltip.showPid)};
Blockly.Tooltip.onMouseMove_=function(c){if(Blockly.Tooltip.element&&Blockly.Tooltip.element.tooltip&&!(Blockly.ContextMenu&&Blockly.ContextMenu.visible||0!=Blockly.Block.dragMode_))if(Blockly.Tooltip.visible){var d=Blockly.Tooltip.lastY-c.clientY;Math.sqrt(Math.pow(Blockly.Tooltip.lastX-c.clientX,2)+Math.pow(d,2))>Blockly.Tooltip.RADIUS_OK&&Blockly.Tooltip.hide()}else Blockly.Tooltip.poisonedElement!=Blockly.Tooltip.element&&(window.clearTimeout(Blockly.Tooltip.showPid),Blockly.Tooltip.lastX=c.clientX,
Blockly.Tooltip.lastY=c.clientY,Blockly.Tooltip.showPid=window.setTimeout(Blockly.Tooltip.show_,Blockly.Tooltip.HOVER_MS))};Blockly.Tooltip.hide=function(){Blockly.Tooltip.visible&&(Blockly.Tooltip.visible=!1,Blockly.Tooltip.svgGroup_&&(Blockly.Tooltip.svgGroup_.style.display="none"));window.clearTimeout(Blockly.Tooltip.showPid)};
Blockly.Tooltip.show_=function(){Blockly.Tooltip.poisonedElement=Blockly.Tooltip.element;if(Blockly.Tooltip.svgGroup_){Blockly.removeChildren_(Blockly.Tooltip.svgText_);var c=Blockly.Tooltip.element.tooltip;"function"==typeof c&&(c=c());for(var c=c.split("\n"),d=0;d<c.length;d++){var e=Blockly.createSvgElement("tspan",{dy:"1em",x:Blockly.Tooltip.MARGINS},Blockly.Tooltip.svgText_),f=Blockly.svgDoc.createTextNode(c[d]);e.appendChild(f)}Blockly.Tooltip.visible=!0;Blockly.Tooltip.svgGroup_.style.display=
"block";c=Blockly.Tooltip.svgText_.getBBox();d=2*Blockly.Tooltip.MARGINS+c.width;e=c.height;Blockly.Tooltip.svgBackground_.setAttribute("width",d);Blockly.Tooltip.svgBackground_.setAttribute("height",e);Blockly.Tooltip.svgShadow_.setAttribute("width",d);Blockly.Tooltip.svgShadow_.setAttribute("height",e);if(Blockly.RTL)for(var e=c.width,f=0,g;g=Blockly.Tooltip.svgText_.childNodes[f];f++)g.setAttribute("text-anchor","end"),g.setAttribute("x",e+Blockly.Tooltip.MARGINS);e=Blockly.Tooltip.lastX;e=Blockly.RTL?
e-(Blockly.Tooltip.OFFSET_X+d):e+Blockly.Tooltip.OFFSET_X;d=Blockly.Tooltip.lastY+Blockly.Tooltip.OFFSET_Y;d=Blockly.mouseToSvg(e,d);e=d.x;d=d.y;f=Blockly.svgSize();d+c.height>f.height&&(d-=c.height+2*Blockly.Tooltip.OFFSET_Y);Blockly.RTL?e=Math.max(Blockly.Tooltip.MARGINS,e):e+c.width>f.width-2*Blockly.Tooltip.MARGINS&&(e=f.width-c.width-2*Blockly.Tooltip.MARGINS);Blockly.Tooltip.svgGroup_.setAttribute("transform","translate("+e+","+d+")")}};Blockly.Trashcan=function(c){this.getMetrics_=c};Blockly.Trashcan.prototype.BODY_URL_="media/trashbody.png";Blockly.Trashcan.prototype.LID_URL_="media/trashlid.png";Blockly.Trashcan.prototype.WIDTH_=47;Blockly.Trashcan.prototype.BODY_HEIGHT_=45;Blockly.Trashcan.prototype.LID_HEIGHT_=15;Blockly.Trashcan.prototype.MARGIN_BOTTOM_=35;Blockly.Trashcan.prototype.MARGIN_SIDE_=35;Blockly.Trashcan.prototype.isOpen=!1;Blockly.Trashcan.prototype.svgGroup_=null;Blockly.Trashcan.prototype.svgBody_=null;
Blockly.Trashcan.prototype.svgLid_=null;Blockly.Trashcan.prototype.lidTask_=0;Blockly.Trashcan.prototype.lidAngle_=0;Blockly.Trashcan.prototype.left_=0;Blockly.Trashcan.prototype.top_=0;
Blockly.Trashcan.prototype.createDom=function(){this.svgGroup_=Blockly.createSvgElement("g",{filter:"url(#blocklyTrashcanShadowFilter)"},null);this.svgBody_=Blockly.createSvgElement("image",{width:this.WIDTH_,height:this.BODY_HEIGHT_},this.svgGroup_);this.svgBody_.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",Blockly.pathToBlockly+this.BODY_URL_);this.svgBody_.setAttribute("y",this.LID_HEIGHT_);this.svgLid_=Blockly.createSvgElement("image",{width:this.WIDTH_,height:this.LID_HEIGHT_},
this.svgGroup_);this.svgLid_.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",Blockly.pathToBlockly+this.LID_URL_);return this.svgGroup_};Blockly.Trashcan.prototype.init=function(){this.setOpen_(!1);this.position_();Blockly.bindEvent_(window,"resize",this,this.position_)};Blockly.Trashcan.prototype.destroy=function(){this.svgGroup_&&(this.svgGroup_.parentNode.removeChild(this.svgGroup_),this.svgGroup_=null);this.getMetrics_=this.svgLid_=this.svgBody_=null;window.clearTimeout(this.lidTask_)};
Blockly.Trashcan.prototype.position_=function(){var c=this.getMetrics_();c&&(this.left_=Blockly.RTL?this.MARGIN_SIDE_:c.viewWidth+c.absoluteLeft-this.WIDTH_-this.MARGIN_SIDE_,this.top_=c.viewHeight+c.absoluteTop-(this.BODY_HEIGHT_+this.LID_HEIGHT_)-this.MARGIN_BOTTOM_,this.svgGroup_.setAttribute("transform","translate("+this.left_+","+this.top_+")"))};
Blockly.Trashcan.prototype.onMouseMove=function(c){if(this.svgGroup_){var d=Blockly.getAbsoluteXY_(this.svgGroup_),e=d.x,f=d.y,d=Blockly.mouseToSvg(c.clientX,c.clientY),c=d.x,d=d.y,e=c>e&&c<e+this.WIDTH_&&d>f&&d<f+this.BODY_HEIGHT_+this.LID_HEIGHT_;this.isOpen!=e&&this.setOpen_(e)}};Blockly.Trashcan.prototype.setOpen_=function(c){this.isOpen!=c&&(window.clearTimeout(this.lidTask_),this.isOpen=c,Blockly.Trashcan.animateLid_(this))};
Blockly.Trashcan.animateLid_=function(c){c.lidAngle_+=c.isOpen?10:-10;c.lidAngle_=Math.max(0,c.lidAngle_);c.svgLid_.setAttribute("transform","rotate("+(Blockly.RTL?-c.lidAngle_:c.lidAngle_)+", "+(Blockly.RTL?4:c.WIDTH_-4)+", "+(c.LID_HEIGHT_-2)+")");if(c.isOpen?45>c.lidAngle_:0<c.lidAngle_)this.lidTask_=window.setTimeout(function(){Blockly.Trashcan.animateLid_(c)},5)};Blockly.Trashcan.close=function(c){c.setOpen_(!1)};Blockly.removeChildren_=function(c){for(var d;d=c.firstChild;)c.removeChild(d)};Blockly.addClass_=function(c,d){var e=c.getAttribute("class")||"";-1==(" "+e+" ").indexOf(" "+d+" ")&&(e&&(e+=" "),c.setAttribute("class",e+d))};Blockly.removeClass_=function(c,d){var e=c.getAttribute("class");if(-1!=(" "+e+" ").indexOf(" "+d+" ")){for(var e=e.split(/\s+/),f=0;f<e.length;f++)if(!e[f]||e[f]==d)e.splice(f,1),f--;e.length?c.setAttribute("class",e.join(" ")):c.removeAttribute("class")}};
Blockly.bindEvent_=function(c,d,e,f){var g=[],h;if(c.addEventListener)h=function(c){f.apply(e,arguments)},c.addEventListener(d,h,!1),g.push([c,d,h]),d in Blockly.bindEvent_.TOUCH_MAP&&(h=function(c){if(1==c.changedTouches.length){var d=c.changedTouches[0];c.clientX=d.clientX;c.clientY=d.clientY}f.apply(e,arguments);c.preventDefault()},c.addEventListener(Blockly.bindEvent_.TOUCH_MAP[d],h,!1),g.push([c,Blockly.bindEvent_.TOUCH_MAP[d],h]));else if(c.attachEvent)h=function(c){f.apply(e,arguments);c.stopPropagation()},
c.attachEvent("on"+d,h),g.push([c,d,h]);else throw"Element is not a DOM node.";return g};Blockly.bindEvent_.TOUCH_MAP="ontouchstart"in document.documentElement?{mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"}:{};Blockly.unbindEvent_=function(c){for(;c.length;){var d=c.pop(),e=d[0],f=d[1],d=d[2];e.removeEventListener?e.removeEventListener(f,d,!1):e.detachEvent("on"+f,d)}};
Blockly.fireUiEvent=function(c,d){var e=Blockly.svgDoc;if(e.createEvent)e=e.createEvent("UIEvents"),e.initEvent(d,!0,!0),c.dispatchEvent(e);else if(e.createEventObject)e=e.createEventObject(),c.fireEvent("on"+d,e);else throw"FireEvent: No event creation mechanism.";};Blockly.noEvent=function(c){c.preventDefault();c.stopPropagation()};
Blockly.getRelativeXY_=function(c){var d={x:0,y:0},e=c.getAttribute("x");e&&(d.x=parseInt(e,10));if(e=c.getAttribute("y"))d.y=parseInt(e,10);if(c=(c=c.getAttribute("transform"))&&c.match(/translate\(\s*([-\d.]+)(,\s*([-\d.]+)\s*\))?/))d.x+=parseInt(c[1],10),c[3]&&(d.y+=parseInt(c[3],10));return d};Blockly.getAbsoluteXY_=function(c){var d=0,e=0;do var f=Blockly.getRelativeXY_(c),d=d+f.x,e=e+f.y,c=c.parentNode;while(c&&c!=Blockly.svgDoc);return{x:d,y:e}};
Blockly.createSvgElement=function(c,d,e){var c=Blockly.svgDoc.createElementNS(Blockly.SVG_NS,c),f;for(f in d)c.setAttribute(f,d[f]);e&&e.appendChild(c);return c};Blockly.caseInsensitiveComparator=function(c,d){c=c.toLowerCase();d=d.toLowerCase();return c>d?1:c<d?-1:0};Blockly.uniqueId=function(){for(var c="abcdefghijklmnopqrstuvwxyz",d=c.charAt(Math.random()*c.length),c=c+"0123456789-_:.",e=1;8>e;e++)d+=c.charAt(Math.random()*c.length);-1!=d.indexOf("--")&&(d=Blockly.uniqueId());return d};
Blockly.isRightButton=function(c){return 2==c.button||c.ctrlKey};Blockly.mouseToSvg=function(c,d){var e=Blockly.svg.createSVGPoint();e.x=c;e.y=d;var f=Blockly.svg.getScreenCTM().inverse();return e.matrixTransform(f)};Blockly.Variables={};Blockly.Variables.NAME_TYPE="variable";Blockly.Variables.allVariables=function(c){var d;d=c?c.getDescendants():Blockly.mainWorkspace.getAllBlocks();for(var c={},e=0;e<d.length;e++){var f=d[e].getVars;if(f)for(var f=f.call(d[e]),g=0;g<f.length;g++){var h=f[g];h&&(c[Blockly.Names.PREFIX_+h.toLowerCase()]=h)}}d=[];for(var i in c)d.push(c[i]);return d};
Blockly.Variables.renameVariable=function(c,d){for(var e=Blockly.mainWorkspace.getAllBlocks(),f=0;f<e.length;f++){var g=e[f].renameVar;g&&g.call(e[f],c,d)}};
Blockly.Variables.flyoutCategory=function(c,d,e,f){var g=Blockly.Variables.allVariables();g.sort(Blockly.caseInsensitiveComparator);g.unshift(null);for(var h=void 0,i=0;i<g.length;i++)if(g[i]!==h){var j=Blockly.Language.variables_get?new Blockly.Block(f,"variables_get"):null;j&&j.initSvg();var k=Blockly.Language.variables_set?new Blockly.Block(f,"variables_set"):null;k&&k.initSvg();null===g[i]?h=(j||k).getVars()[0]:(j&&j.setTitleValue(g[i],"VAR"),k&&k.setTitleValue(g[i],"VAR"));k&&c.push(k);j&&c.push(j);
j&&k?d.push(e,3*e):d.push(2*e)}};Blockly.Variables.refreshFlyoutCategory=function(){Blockly.Toolbox&&(Blockly.Toolbox.flyout_.isVisible()&&Blockly.Toolbox.selectedOption_.cat==Blockly.MSG_VARIABLE_CATEGORY)&&(Blockly.Toolbox.flyout_.hide(),Blockly.Toolbox.flyout_.show(Blockly.MSG_VARIABLE_CATEGORY))};
Blockly.Variables.generateUniqueName=function(){var c=Blockly.Variables.allVariables(),d="";if(c.length){c.sort(Blockly.caseInsensitiveComparator);for(var e=0,f="i",g=0,h=!1;!d;){g=0;for(h=!1;g<c.length&&!h;)c[g].toLowerCase()==f&&(h=!0),g++;h?("z"===f.charAt(0)?(e++,f="i"):(f=String.fromCharCode(f.charCodeAt(0)+1),"l"==f.charAt(0)&&(f=String.fromCharCode(f.charCodeAt(0)+1))),0<e&&(f+=e)):d=f}}else d="i";return d};Blockly.Warning=function(c){this.block_=c;this.createIcon_();this.setPinned(!1)};Blockly.Warning.ICON_RADIUS=8;Blockly.Warning.prototype.bubble_=null;Blockly.Warning.prototype.text_="";Blockly.Warning.prototype.iconX_=null;Blockly.Warning.prototype.iconY_=null;Blockly.Warning.prototype.relativeLeft_=-100;Blockly.Warning.prototype.relativeTop_=-120;Blockly.Warning.prototype.isPinned_=!1;
Blockly.Warning.prototype.createIcon_=function(){this.iconGroup_=Blockly.createSvgElement("g",{"class":"blocklyIconGroup"},null);Blockly.createSvgElement("path",{"class":"blocklyIconShield",d:"M 2,15 Q -1,15 0.5,12 L 6.5,1.7 Q 8,-1 9.5,1.7 L 15.5,12 Q 17,15 14,15 z"},this.iconGroup_);this.iconMark_=Blockly.createSvgElement("text",{"class":"blocklyIconMark",x:Blockly.Warning.ICON_RADIUS/2+2,y:2*Blockly.Warning.ICON_RADIUS-3},this.iconGroup_);this.iconMark_.appendChild(Blockly.svgDoc.createTextNode("!"));
this.block_.getSvgRoot().appendChild(this.iconGroup_);Blockly.bindEvent_(this.iconGroup_,"mouseup",this,this.iconClick_);Blockly.bindEvent_(this.iconGroup_,"mouseover",this,this.iconMouseOver_);Blockly.bindEvent_(this.iconGroup_,"mouseout",this,this.iconMouseOut_)};
Blockly.Warning.prototype.textToDom_=function(c){for(var d=Blockly.createSvgElement("text",{"class":"blocklyText",y:Blockly.Bubble.BORDER_WIDTH},null),c=c.split("\n"),e=0;e<c.length;e++){var f=Blockly.createSvgElement("tspan",{dy:"1em",x:Blockly.Bubble.BORDER_WIDTH},d),g=Blockly.svgDoc.createTextNode(c[e]);f.appendChild(g)}return d};Blockly.Warning.prototype.isPinned=function(){return this.isPinned_};
Blockly.Warning.prototype.setPinned=function(c){this.isPinned_=c;this.iconMark_.style.fill=c?"#fff":"";this.bubble_&&this.bubble_.setDisabled(!this.isPinned_)};Blockly.Warning.prototype.isVisible_=function(){return!!this.bubble_};
Blockly.Warning.prototype.setVisible_=function(c){if(c!=this.isVisible_())if(c){c=this.textToDom_(this.text_);this.bubble_=new Blockly.Bubble(this.block_.workspace.getBubbleCanvas(),c,this.iconX_,this.iconY_,this.relativeLeft_,this.relativeTop_,null,null);if(Blockly.RTL)for(var d=c.getBBox().width,e=0,f;f=c.childNodes[e];e++)f.setAttribute("text-anchor","end"),f.setAttribute("x",d+Blockly.Bubble.BORDER_WIDTH);this.bubble_.setDisabled(!this.isPinned_);this.updateColour()}else this.bubble_.destroy(),
this.foreignObject_=this.body_=this.bubble_=null};Blockly.Warning.prototype.iconClick_=function(){this.setPinned(!this.isPinned_)};Blockly.Warning.prototype.iconMouseOver_=function(){!this.isPinned_&&0==Blockly.Block.dragMode_&&this.setVisible_(!0)};Blockly.Warning.prototype.iconMouseOut_=function(){!this.isPinned_&&0==Blockly.Block.dragMode_&&this.setVisible_(!1)};Blockly.Warning.prototype.bodyFocus_=function(){this.bubble_.promote_()};
Blockly.Warning.prototype.setBubbleLocation=function(c,d){this.isVisible_()?this.bubble_.setBubbleLocation(c,d):(this.relativeLeft_=c,this.relativeTop_=d)};Blockly.Warning.prototype.setText=function(c){this.text_=c;this.isVisible_()&&(this.setVisible_(!1),this.setVisible_(!0))};Blockly.Warning.prototype.updateColour=function(){if(this.isVisible_()){var c=Blockly.makeColour(this.block_.getColour());this.bubble_.setColour(c)}};
Blockly.Warning.prototype.destroy=function(){this.iconGroup_.parentNode.removeChild(this.iconGroup_);this.iconGroup_=null;this.setVisible_(!1);this.block_=this.block_.warning=null};
Blockly.Warning.prototype.renderIcon=function(c){if(this.block_.collapsed)return this.iconGroup_.setAttribute("display","none"),0;this.iconGroup_.setAttribute("display","block");var d=2*Blockly.Warning.ICON_RADIUS;Blockly.RTL&&(c-=d);this.iconGroup_.setAttribute("transform","translate("+c+", 5)");this.computeIconLocation();return d};Blockly.Warning.prototype.setIconLocation=function(c,d){this.iconX_=c;this.iconY_=d;this.isVisible_()&&this.bubble_.setAnchorLocation(c,d)};
Blockly.Warning.prototype.computeIconLocation=function(){var c=this.block_.getRelativeToSurfaceXY(),d=Blockly.getRelativeXY_(this.iconGroup_),e=c.x+d.x+Blockly.Warning.ICON_RADIUS,c=c.y+d.y+Blockly.Warning.ICON_RADIUS;(e!==this.iconX_||c!==this.iconY_)&&this.setIconLocation(e,c)};Blockly.Warning.prototype.getIconLocation=function(){return{x:this.iconX_,y:this.iconY_}};Blockly.Workspace=function(c){this.editable=c;this.topBlocks_=[];Blockly.ConnectionDB.init(this)};Blockly.Workspace.prototype.dragMode=!1;Blockly.Workspace.prototype.scrollX=0;Blockly.Workspace.prototype.scrollY=0;Blockly.Workspace.prototype.trashcan=null;Blockly.Workspace.prototype.fireChangeEventPid_=null;
Blockly.Workspace.prototype.createDom=function(){this.svgGroup_=Blockly.createSvgElement("g",{},null);this.svgBlockCanvas_=Blockly.createSvgElement("g",{},this.svgGroup_);this.svgBubbleCanvas_=Blockly.createSvgElement("g",{},this.svgGroup_);this.fireChangeEvent();return this.svgGroup_};
Blockly.Workspace.prototype.destroy=function(){this.svgGroup_&&(this.svgGroup_.parentNode.removeChild(this.svgGroup_),this.svgGroup_=null);this.svgBubbleCanvas_=this.svgBlockCanvas_=null;this.trashcan&&(this.trashcan.destroy(),this.trashcan=null)};Blockly.Workspace.prototype.addTrashcan=function(c){Blockly.Trashcan&&this.editable&&(this.trashcan=new Blockly.Trashcan(c),c=this.trashcan.createDom(),this.svgGroup_.insertBefore(c,this.svgBlockCanvas_),this.trashcan.init())};
Blockly.Workspace.prototype.getCanvas=function(){return this.svgBlockCanvas_};Blockly.Workspace.prototype.getBubbleCanvas=function(){return this.svgBubbleCanvas_};Blockly.Workspace.prototype.addTopBlock=function(c){this.topBlocks_.push(c);this.fireChangeEvent()};Blockly.Workspace.prototype.removeTopBlock=function(c){for(var d=!1,e,f=0;e=this.topBlocks_[f];f++)if(e==c){this.topBlocks_.splice(f,1);d=!0;break}if(!d)throw"Block not present in workspace's list of top-most blocks.";this.fireChangeEvent()};
Blockly.Workspace.prototype.getTopBlocks=function(c){var d=[].concat(this.topBlocks_);c&&1<d.length&&d.sort(function(c,d){return c.getRelativeToSurfaceXY().y-d.getRelativeToSurfaceXY().y});return d};Blockly.Workspace.prototype.getAllBlocks=function(){for(var c=this.getTopBlocks(!1),d=0;d<c.length;d++)c=c.concat(c[d].getChildren());return c};Blockly.Workspace.prototype.clear=function(){for(Blockly.hideChaff();this.topBlocks_.length;)this.topBlocks_[0].destroy()};
Blockly.Workspace.prototype.render=function(){for(var c=this.getAllBlocks(),d=0,e;e=c[d];d++)e.getChildren().length||e.render()};Blockly.Workspace.prototype.getBlockById=function(c){for(var d=this.getAllBlocks(),e=0,f;f=d[e];e++)if(f.id==c)return f;return null};
Blockly.Workspace.prototype.traceOn=function(c){this.traceOn_=c;this.traceWrapper_&&(Blockly.unbindEvent_(this.traceWrapper_),this.traceWrapper_=null);c&&(this.traceWrapper_=Blockly.bindEvent_(this.svgBlockCanvas_,"blocklySelectChange",this,function(){this.traceOn_=!1}))};Blockly.Workspace.prototype.highlightBlock=function(c){if(this.traceOn_&&(c=this.getBlockById(c)))this.traceOn(!1),c.select(),this.traceOn(!0)};
Blockly.Workspace.prototype.fireChangeEvent=function(){this.fireChangeEventPid_&&window.clearTimeout(this.fireChangeEventPid_);var c=this.svgBlockCanvas_;c&&(this.fireChangeEventPid_=window.setTimeout(function(){Blockly.fireUiEvent(c,"blocklyWorkspaceChange")},0))};
Blockly.Workspace.prototype.paste=function(c){var d=Blockly.Xml.domToBlock_(this,c),e=parseInt(c.getAttribute("x"),10),c=parseInt(c.getAttribute("y"),10);if(!isNaN(e)&&!isNaN(c)){Blockly.RTL&&(e=-e);do for(var f=!1,g=this.getAllBlocks(),h=0,i;i=g[h];h++)i=i.getRelativeToSurfaceXY(),1>=Math.abs(e-i.x)&&1>=Math.abs(c-i.y)&&(e=Blockly.RTL?e-Blockly.SNAP_RADIUS:e+Blockly.SNAP_RADIUS,c+=2*Blockly.SNAP_RADIUS,f=!0);while(f);d.moveBy(e,c)}d.select()};Blockly.Xml={};Blockly.Xml.workspaceToDom=function(c){for(var d=document.createElement("xml"),c=c.getTopBlocks(!1),e=0,f;f=c[e];e++){var g=Blockly.Xml.blockToDom_(f);f=f.getRelativeToSurfaceXY();g.setAttribute("x",Blockly.RTL?-f.x:f.x);g.setAttribute("y",f.y);d.appendChild(g)}return d};
Blockly.Xml.blockToDom_=function(c){function d(c){if(c.name&&c.EDITABLE){var d=document.createElement("title");d.setAttribute("name",c.name);c=document.createTextNode(c.getValue());d.appendChild(c);e.appendChild(d)}}var e=document.createElement("block");e.setAttribute("type",c.type);if(c.mutationToDom){var f=c.mutationToDom();f&&e.appendChild(f)}for(var g=0,h;h=c.titleRow[g];g++)d(h);for(g=0;f=c.inputList[g];g++)for(var i=0;h=f.titleRow[i];i++)d(h);c.comment&&(f=document.createElement("comment"),
g=document.createTextNode(c.comment.getText()),f.appendChild(g),f.setAttribute("pinned",c.comment.isPinned()),g=c.comment.getBubbleLocation(),f.setAttribute("x",g.x),f.setAttribute("y",g.y),g=c.comment.getBubbleSize(),f.setAttribute("h",g.height),f.setAttribute("w",g.width),e.appendChild(f));h=!1;for(g=0;f=c.inputList[g];g++){var j,i=!0;if(f.type!=Blockly.DUMMY_INPUT){var k=f.connection.targetBlock();f.type==Blockly.INPUT_VALUE?(j=document.createElement("value"),h=!0):f.type==Blockly.NEXT_STATEMENT&&
(j=document.createElement("statement"));k&&(j.appendChild(Blockly.Xml.blockToDom_(k)),i=!1);j.setAttribute("name",f.name);i||e.appendChild(j)}}h&&e.setAttribute("inline",c.inputsInline);c.collapsed&&e.setAttribute("collapsed",!0);c.disabled&&e.setAttribute("disabled",!0);if(c.nextConnection&&(c=c.nextConnection.targetBlock()))j=document.createElement("next"),j.appendChild(Blockly.Xml.blockToDom_(c)),e.appendChild(j);return e};Blockly.Xml.domToText=function(c){return(new XMLSerializer).serializeToString(c)};
Blockly.Xml.domToPrettyText=function(c){for(var c=Blockly.Xml.domToText(c).split("<"),d="",e=1;e<c.length;e++){var f=c[e][0];"/"==f&&(d=d.substring(2));c[e]=d+"<"+c[e];"/"!=f&&(d+="  ")}c=c.join("\n");c=c.replace(/(<(\w+)[^>]*>[^\n]*)\n *<\/\2>/g,"$1</$2>");return c.replace(/^\n/,"")};
Blockly.Xml.textToDom=function(c){c=(new DOMParser).parseFromString(c,"text/xml");if(!c||!c.firstChild||"xml"!=c.firstChild.tagName||c.firstChild!==c.lastChild)throw"Blockly.Xml.textToDom did not obtain a valid XML tree.";return c.firstChild};
Blockly.Xml.domToWorkspace=function(c,d){for(var e=0,f;f=d.childNodes[e];e++)if(f.nodeName&&"block"==f.nodeName.toLowerCase()){var g=Blockly.Xml.domToBlock_(c,f),h=parseInt(f.getAttribute("x"),10);f=parseInt(f.getAttribute("y"),10);!isNaN(h)&&!isNaN(f)&&g.moveBy(Blockly.RTL?-h:h,f)}};
Blockly.Xml.domToBlock_=function(c,d){var e=d.getAttribute("type"),e=new Blockly.Block(c,e);e.initSvg();for(var f=0,g;g=d.childNodes[f];f++)if(!(3==g.nodeType&&g.data.match(/^\s*$/))){for(var h=null,h=null,i=0,j;j=g.childNodes[i];i++)if(3!=j.nodeType||!j.data.match(/^\s*$/))h=j;i=g.getAttribute("name");switch(g.tagName.toLowerCase()){case "mutation":e.domToMutation&&e.domToMutation(g);break;case "comment":e.setCommentText(g.textContent);(h=g.getAttribute("pinned"))&&e.comment.setPinned("true"==h);
h=parseInt(g.getAttribute("x"),10);i=parseInt(g.getAttribute("y"),10);!isNaN(h)&&!isNaN(i)&&e.comment.setBubbleLocation(h,i,!1);h=parseInt(g.getAttribute("w"),10);g=parseInt(g.getAttribute("h"),10);!isNaN(h)&&!isNaN(g)&&e.comment.setBubbleSize(h,g);break;case "title":e.setTitleValue(g.textContent,i);break;case "variable":console.log("Obsolete variable tag.  Please regenerate XML.");g=g.getAttribute("data");null!==g&&e.setTitleValue(g,i);break;case "value":case "statement":g=e.getInput(i);if(!g)throw"Input does not exist: "+
i;if(h&&h.tagName&&"block"==h.tagName.toLowerCase())if(h=Blockly.Xml.domToBlock_(c,h),h.outputConnection)g.connection.connect(h.outputConnection);else if(h.previousConnection)g.connection.connect(h.previousConnection);else throw"Child block does not have output or previous statement.";break;case "next":if(h&&h.tagName&&"block"==h.tagName.toLowerCase()){if(e.nextConnection){if(e.nextConnection.targetConnection)throw"Next statement is already connected.";}else throw"Next statement does not exist.";
h=Blockly.Xml.domToBlock_(c,h);if(!h.previousConnection)throw"Next block does not have previous statement.";e.nextConnection.connect(h.previousConnection)}}}(f=d.getAttribute("inline"))&&e.setInputsInline("true"==f);(f=d.getAttribute("collapsed"))&&e.setCollapsed("true"==f);(f=d.getAttribute("disabled"))&&e.setDisabled("true"==f);e.render();return e};
Blockly.Xml.isFirstRealChild_=function(c,d){for(var e=0,f;f=c.childNodes[e];e++)if(3!=f.nodeType||!f.data.match(/^\s*$/))return f.tagName&&f.tagName.toLowerCase()==d;return!1};Blockly.Xml.deleteNext=function(c){for(var d=0,e;e=c.childNodes[d];d++)if("next"==e.tagName.toLowerCase()){c.removeChild(e);break}};